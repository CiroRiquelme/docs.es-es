---
title: 'Tutorial: Hospedar objetos visuales en una aplicación Win32'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- visual objects in Win32 code [WPF]
- Win32 code [WPF], visual objects in
- hosting [WPF], visual objects in Win32 code
ms.assetid: f0e1600c-3217-43d5-875d-1864fa7fe628
ms.openlocfilehash: 621684e14f9d1b599c4ef60e3731f0f58f31aacd
ms.sourcegitcommit: 9a97c76e141333394676bc5d264c6624b6f45bcf
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2020
ms.locfileid: "75740164"
---
# <a name="tutorial-hosting-visual-objects-in-a-win32-application"></a><span data-ttu-id="93c7e-102">Tutorial: Hospedar objetos visuales en una aplicación Win32</span><span class="sxs-lookup"><span data-stu-id="93c7e-102">Tutorial: Hosting Visual Objects in a Win32 Application</span></span>
[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] <span data-ttu-id="93c7e-103">proporciona un entorno rico para crear aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="93c7e-103">provides a rich environment for creating applications.</span></span> <span data-ttu-id="93c7e-104">Sin embargo, si tiene una inversión sustancial en código Win32, podría ser más eficaz agregar [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] funcionalidad a la aplicación en lugar de volver a escribir el código.</span><span class="sxs-lookup"><span data-stu-id="93c7e-104">However, when you have a substantial investment in Win32 code, it might be more effective to add [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] functionality to your application rather than rewrite your code.</span></span> <span data-ttu-id="93c7e-105">Para proporcionar compatibilidad con Win32 y [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] subsistemas de gráficos utilizados simultáneamente en una aplicación, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] proporciona un mecanismo para hospedar objetos en una ventana de Win32.</span><span class="sxs-lookup"><span data-stu-id="93c7e-105">To provide support for Win32 and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] graphics subsystems used concurrently in an application, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] provides a mechanism for hosting objects in a Win32 window.</span></span>  
  
 <span data-ttu-id="93c7e-106">En este tutorial se describe cómo escribir una aplicación de ejemplo, una [prueba de posicionamiento con el ejemplo de interoperación de Win32](https://go.microsoft.com/fwlink/?LinkID=159995), que hospeda [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] objetos visuales en una ventana de Win32.</span><span class="sxs-lookup"><span data-stu-id="93c7e-106">This tutorial describes how to write a sample application, [Hit Test with Win32 Interoperation Sample](https://go.microsoft.com/fwlink/?LinkID=159995), that hosts [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] visual objects in a Win32 window.</span></span>  

<a name="requirements"></a>   
## <a name="requirements"></a><span data-ttu-id="93c7e-107">Requisitos de</span><span class="sxs-lookup"><span data-stu-id="93c7e-107">Requirements</span></span>  
 <span data-ttu-id="93c7e-108">En este tutorial se da por supuesto que está familiarizado con la programación de [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] y Win32.</span><span class="sxs-lookup"><span data-stu-id="93c7e-108">This tutorial assumes a basic familiarity with both [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and Win32 programming.</span></span> <span data-ttu-id="93c7e-109">Para obtener una introducción básica a la programación de [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], vea [Tutorial: mi primera aplicación de escritorio WPF](../getting-started/walkthrough-my-first-wpf-desktop-application.md).</span><span class="sxs-lookup"><span data-stu-id="93c7e-109">For a basic introduction to [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] programming, see [Walkthrough: My first WPF desktop application](../getting-started/walkthrough-my-first-wpf-desktop-application.md).</span></span> <span data-ttu-id="93c7e-110">Para ver una introducción a la programación de Win32, consulte cualquiera de los numerosos libros sobre el tema, en determinadas *ventanas de programación* , de Charles Petzold.</span><span class="sxs-lookup"><span data-stu-id="93c7e-110">For an introduction to Win32 programming, see any of the numerous books on the subject, in particular *Programming Windows* by Charles Petzold.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="93c7e-111">En el tutorial se incluye una serie de ejemplos de código del ejemplo asociado.</span><span class="sxs-lookup"><span data-stu-id="93c7e-111">This tutorial includes a number of code examples from the associated sample.</span></span> <span data-ttu-id="93c7e-112">Sin embargo, para una mejor lectura, no se incluye el código de ejemplo completo.</span><span class="sxs-lookup"><span data-stu-id="93c7e-112">However, for readability, it does not include the complete sample code.</span></span> <span data-ttu-id="93c7e-113">Para obtener el código de ejemplo completo, vea [prueba de posicionamiento con el ejemplo de interoperación de Win32](https://go.microsoft.com/fwlink/?LinkID=159995).</span><span class="sxs-lookup"><span data-stu-id="93c7e-113">For the complete sample code, see [Hit Test with Win32 Interoperation Sample](https://go.microsoft.com/fwlink/?LinkID=159995).</span></span>  
  
<a name="creating_the_host_win32_window"></a>   
## <a name="creating-the-host-win32-window"></a><span data-ttu-id="93c7e-114">Crear la ventana host de Win32</span><span class="sxs-lookup"><span data-stu-id="93c7e-114">Creating the Host Win32 Window</span></span>  
 <span data-ttu-id="93c7e-115">La clave para hospedar objetos de [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] en una ventana de Win32 es la clase <xref:System.Windows.Interop.HwndSource>.</span><span class="sxs-lookup"><span data-stu-id="93c7e-115">The key to hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] objects in a Win32 window is the <xref:System.Windows.Interop.HwndSource> class.</span></span> <span data-ttu-id="93c7e-116">Esta clase ajusta el [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] objetos en una ventana de Win32, lo que permite que se incorporen en el [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] como una ventana secundaria.</span><span class="sxs-lookup"><span data-stu-id="93c7e-116">This class wraps the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] objects in a Win32 window, allowing them to be incorporated into your [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] as a child window.</span></span>  
  
 <span data-ttu-id="93c7e-117">En el ejemplo siguiente se muestra el código para crear el objeto <xref:System.Windows.Interop.HwndSource> como la ventana contenedor de Win32 para los objetos visuales.</span><span class="sxs-lookup"><span data-stu-id="93c7e-117">The following example shows the code for creating the <xref:System.Windows.Interop.HwndSource> object as the Win32 container window for the visual objects.</span></span> <span data-ttu-id="93c7e-118">Para establecer el estilo, la posición y otros parámetros de la ventana de Win32, use el objeto <xref:System.Windows.Interop.HwndSourceParameters>.</span><span class="sxs-lookup"><span data-stu-id="93c7e-118">To set the window style, position, and other parameters for the Win32 window, use the <xref:System.Windows.Interop.HwndSourceParameters> object.</span></span>  
  
 [!code-csharp[VisualsHitTesting#101](~/samples/snippets/csharp/VS_Snippets_Wpf/VisualsHitTesting/CSharp/MyWindow.cs#101)]
 [!code-vb[VisualsHitTesting#101](~/samples/snippets/visualbasic/VS_Snippets_Wpf/VisualsHitTesting/VisualBasic/MyWindow.vb#101)]  
  
> [!NOTE]
> <span data-ttu-id="93c7e-119">No se puede establecer el valor de la propiedad <xref:System.Windows.Interop.HwndSourceParameters.ExtendedWindowStyle%2A> en WS_EX_TRANSPARENT.</span><span class="sxs-lookup"><span data-stu-id="93c7e-119">The value of the <xref:System.Windows.Interop.HwndSourceParameters.ExtendedWindowStyle%2A> property cannot be set to WS_EX_TRANSPARENT.</span></span> <span data-ttu-id="93c7e-120">Esto significa que la ventana de Win32 de host no puede ser transparente.</span><span class="sxs-lookup"><span data-stu-id="93c7e-120">This means that the host Win32 window cannot be transparent.</span></span> <span data-ttu-id="93c7e-121">Por esta razón, el color de fondo de la ventana de Win32 del host se establece en el mismo color de fondo que su ventana primaria.</span><span class="sxs-lookup"><span data-stu-id="93c7e-121">For this reason, the background color of the host Win32 window is set to the same background color as its parent window.</span></span>  
  
<a name="adding_visual_objects_to_the_host_win32_window"></a>   
## <a name="adding-visual-objects-to-the-host-win32-window"></a><span data-ttu-id="93c7e-122">Agregar objetos visuales a la ventana host de Win32</span><span class="sxs-lookup"><span data-stu-id="93c7e-122">Adding Visual Objects to the Host Win32 Window</span></span>  
 <span data-ttu-id="93c7e-123">Una vez que haya creado una ventana contenedor de Win32 de host para los objetos visuales, puede agregarle objetos visuales.</span><span class="sxs-lookup"><span data-stu-id="93c7e-123">Once you have created a host Win32 container window for the visual objects, you can add visual objects to it.</span></span> <span data-ttu-id="93c7e-124">Querrá asegurarse de que las transformaciones de los objetos visuales, como las animaciones, no se extienden más allá de los límites del rectángulo delimitador de la ventana de Win32 del host.</span><span class="sxs-lookup"><span data-stu-id="93c7e-124">You will want to ensure that any transformations of the visual objects, such as animations, do not extend beyond the bounds of the host Win32 window's bounding rectangle.</span></span>  
  
 <span data-ttu-id="93c7e-125">En el ejemplo siguiente se muestra el código para crear el objeto de <xref:System.Windows.Interop.HwndSource> y agregarle objetos visuales.</span><span class="sxs-lookup"><span data-stu-id="93c7e-125">The following example shows the code for creating the <xref:System.Windows.Interop.HwndSource> object and adding visual objects to it.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="93c7e-126">La propiedad <xref:System.Windows.Interop.HwndSource.RootVisual%2A> del objeto <xref:System.Windows.Interop.HwndSource> se establece en el primer objeto visual agregado a la ventana host de Win32.</span><span class="sxs-lookup"><span data-stu-id="93c7e-126">The <xref:System.Windows.Interop.HwndSource.RootVisual%2A> property of the <xref:System.Windows.Interop.HwndSource> object is set to the first visual object added to the host Win32 window.</span></span> <span data-ttu-id="93c7e-127">El objeto visual raíz define el nodo de nivel superior del árbol de objetos visuales.</span><span class="sxs-lookup"><span data-stu-id="93c7e-127">The root visual object defines the top-most node of the visual object tree.</span></span> <span data-ttu-id="93c7e-128">Los objetos visuales subsiguientes agregados a la ventana de Win32 de host se agregan como objetos secundarios.</span><span class="sxs-lookup"><span data-stu-id="93c7e-128">Any subsequent visual objects added to the host Win32 window are added as child objects.</span></span>  
  
 [!code-csharp[VisualsHitTesting#100](~/samples/snippets/csharp/VS_Snippets_Wpf/VisualsHitTesting/CSharp/MyWindow.cs#100)]
 [!code-vb[VisualsHitTesting#100](~/samples/snippets/visualbasic/VS_Snippets_Wpf/VisualsHitTesting/VisualBasic/MyWindow.vb#100)]  
  
<a name="implementing_the_win32_message_filter"></a>   
## <a name="implementing-the-win32-message-filter"></a><span data-ttu-id="93c7e-129">Implementar el filtro de mensajes de Win32</span><span class="sxs-lookup"><span data-stu-id="93c7e-129">Implementing the Win32 Message Filter</span></span>  
 <span data-ttu-id="93c7e-130">La ventana host de Win32 para los objetos visuales requiere un procedimiento de filtro de mensajes de ventana para controlar los mensajes que se envían a la ventana desde la cola de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="93c7e-130">The host Win32 window for the visual objects requires a window message filter procedure to handle messages that are sent to the window from the application queue.</span></span> <span data-ttu-id="93c7e-131">El procedimiento de ventana recibe mensajes del sistema Win32.</span><span class="sxs-lookup"><span data-stu-id="93c7e-131">The window procedure receives messages from the Win32 system.</span></span> <span data-ttu-id="93c7e-132">Pueden ser mensajes de entrada o mensajes de administración de ventanas.</span><span class="sxs-lookup"><span data-stu-id="93c7e-132">These may be input messages or window-management messages.</span></span> <span data-ttu-id="93c7e-133">Si lo desea, puede administrar un mensaje en el procedimiento de ventana o bien pasar el mensaje al sistema para su procesamiento predeterminado.</span><span class="sxs-lookup"><span data-stu-id="93c7e-133">You can optionally handle a message in your window procedure or pass the message to the system for default processing.</span></span>  
  
 <span data-ttu-id="93c7e-134">El objeto <xref:System.Windows.Interop.HwndSource> que definió como elemento primario de los objetos visuales debe hacer referencia al procedimiento de filtro de mensajes de ventana que proporcione.</span><span class="sxs-lookup"><span data-stu-id="93c7e-134">The <xref:System.Windows.Interop.HwndSource> object that you defined as the parent for the visual objects must reference the window message filter procedure you provide.</span></span> <span data-ttu-id="93c7e-135">Al crear el objeto de <xref:System.Windows.Interop.HwndSource>, establezca la propiedad <xref:System.Windows.Interop.HwndSourceParameters.HwndSourceHook%2A> para hacer referencia al procedimiento de ventana.</span><span class="sxs-lookup"><span data-stu-id="93c7e-135">When you create the <xref:System.Windows.Interop.HwndSource> object, set the <xref:System.Windows.Interop.HwndSourceParameters.HwndSourceHook%2A> property to reference the window procedure.</span></span>  
  
 [!code-csharp[VisualsHitTesting#102](~/samples/snippets/csharp/VS_Snippets_Wpf/VisualsHitTesting/CSharp/MyWindow.cs#102)]
 [!code-vb[VisualsHitTesting#102](~/samples/snippets/visualbasic/VS_Snippets_Wpf/VisualsHitTesting/VisualBasic/MyWindow.vb#102)]  
  
 <span data-ttu-id="93c7e-136">En el ejemplo siguiente se muestra el código para controlar los mensajes que se emiten al soltar el botón primario y secundario del ratón.</span><span class="sxs-lookup"><span data-stu-id="93c7e-136">The following example shows the code for handling the left and right mouse button up messages.</span></span> <span data-ttu-id="93c7e-137">El valor de la coordenada de la posición de posicionamiento del mouse se encuentra en el valor del parámetro `lParam`.</span><span class="sxs-lookup"><span data-stu-id="93c7e-137">The coordinate value of the mouse hit position is contained in the value of the `lParam` parameter.</span></span>  
  
 [!code-csharp[VisualsHitTesting#103](~/samples/snippets/csharp/VS_Snippets_Wpf/VisualsHitTesting/CSharp/MyWindow.cs#103)]
 [!code-vb[VisualsHitTesting#103](~/samples/snippets/visualbasic/VS_Snippets_Wpf/VisualsHitTesting/VisualBasic/MyWindow.vb#103)]  
  
<a name="processing_the_win32_messages"></a>   
## <a name="processing-the-win32-messages"></a><span data-ttu-id="93c7e-138">Procesar mensajes de Win32</span><span class="sxs-lookup"><span data-stu-id="93c7e-138">Processing the Win32 Messages</span></span>  
 <span data-ttu-id="93c7e-139">El código del ejemplo siguiente muestra cómo se realiza una prueba de posicionamiento en la jerarquía de objetos visuales contenidos en la ventana host de Win32.</span><span class="sxs-lookup"><span data-stu-id="93c7e-139">The code in the following example shows how a hit test is performed against the hierarchy of visual objects contained in the host Win32 window.</span></span> <span data-ttu-id="93c7e-140">Puede identificar si un punto está dentro de la geometría de un objeto visual, utilizando el método <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> para especificar el objeto visual raíz y el valor de la coordenada con respecto a la prueba de posicionamiento.</span><span class="sxs-lookup"><span data-stu-id="93c7e-140">You can identify whether a point is within the geometry of a visual object, by using the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method to specify the root visual object and the coordinate value to hit test against.</span></span> <span data-ttu-id="93c7e-141">En este caso, el objeto visual raíz es el valor de la propiedad <xref:System.Windows.Interop.HwndSource.RootVisual%2A> del objeto <xref:System.Windows.Interop.HwndSource>.</span><span class="sxs-lookup"><span data-stu-id="93c7e-141">In this case, the root visual object is the value of the <xref:System.Windows.Interop.HwndSource.RootVisual%2A> property of the <xref:System.Windows.Interop.HwndSource> object.</span></span>  
  
 [!code-csharp[VisualsHitTesting#104](~/samples/snippets/csharp/VS_Snippets_Wpf/VisualsHitTesting/CSharp/MyCircle.cs#104)]
 [!code-vb[VisualsHitTesting#104](~/samples/snippets/visualbasic/VS_Snippets_Wpf/VisualsHitTesting/VisualBasic/MyCircle.vb#104)]  
  
 <span data-ttu-id="93c7e-142">Para obtener más información sobre las pruebas de posicionamiento en objetos visuales, vea [pruebas de posicionamiento en la capa visual](hit-testing-in-the-visual-layer.md).</span><span class="sxs-lookup"><span data-stu-id="93c7e-142">For more information on hit testing against visual objects, see [Hit Testing in the Visual Layer](hit-testing-in-the-visual-layer.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="93c7e-143">Vea también</span><span class="sxs-lookup"><span data-stu-id="93c7e-143">See also</span></span>

- <xref:System.Windows.Interop.HwndSource>
- [<span data-ttu-id="93c7e-144">Prueba de posicionamiento con el ejemplo de interoperación de Win32</span><span class="sxs-lookup"><span data-stu-id="93c7e-144">Hit Test with Win32 Interoperation Sample</span></span>](https://go.microsoft.com/fwlink/?LinkID=159995)
- [<span data-ttu-id="93c7e-145">Realizar pruebas de posicionamiento en la capa visual</span><span class="sxs-lookup"><span data-stu-id="93c7e-145">Hit Testing in the Visual Layer</span></span>](hit-testing-in-the-visual-layer.md)
