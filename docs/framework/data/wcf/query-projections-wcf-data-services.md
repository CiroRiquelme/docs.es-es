---
title: Proyecciones de consultas (Data Services de WCF)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- projection [WCF Data Services]
- WCF Data Services, projection
- query projection [WCF Data Services]
- WCF Data Services, querying
ms.assetid: a09f4985-9f0d-48c8-b183-83d67a3dfe5f
ms.openlocfilehash: 764ea6a77ba267e691d48bc72d17c02f6b3c18ca
ms.sourcegitcommit: 7088f87e9a7da144266135f4b2397e611cf0a228
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/11/2020
ms.locfileid: "75900970"
---
# <a name="query-projections-wcf-data-services"></a><span data-ttu-id="05717-102">Proyecciones de consultas (Data Services de WCF)</span><span class="sxs-lookup"><span data-stu-id="05717-102">Query Projections (WCF Data Services)</span></span>

<span data-ttu-id="05717-103">La proyección proporciona un mecanismo en el Open Data Protocol (OData) para reducir la cantidad de datos en la fuente devuelta por una consulta especificando que solo se devuelvan determinadas propiedades de una entidad en la respuesta.</span><span class="sxs-lookup"><span data-stu-id="05717-103">Projection provides a mechanism in the Open Data Protocol (OData) to reduce the amount of data in the feed returned by a query by specifying that only certain properties of an entity are returned in the response.</span></span> <span data-ttu-id="05717-104">Para obtener más información, vea la sección 4,8.</span><span class="sxs-lookup"><span data-stu-id="05717-104">For more information, see section 4.8.</span></span> <span data-ttu-id="05717-105">Seleccione la opción de consulta del sistema ($select) en [convenciones de URI (versión 2,0 de oData)](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/).</span><span class="sxs-lookup"><span data-stu-id="05717-105">Select System Query Option ($select) in [URI Conventions (OData Version 2.0)](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/).</span></span>

<span data-ttu-id="05717-106">En este tema se describen la definición de la proyección de una consulta, cuáles son los requisitos para los tipos con entidad y sin ella, la realización de actualizaciones en los resultados proyectados, la creación de tipos proyectados y la enumeración de algunas consideraciones de proyecciones.</span><span class="sxs-lookup"><span data-stu-id="05717-106">This topic describes how to define a query projection, what the requirements are for entity and non-entity types, making updates to projected results, creating projected types, and lists some projection considerations.</span></span>

## <a name="defining-a-query-projection"></a><span data-ttu-id="05717-107">Definir una proyección de consultas</span><span class="sxs-lookup"><span data-stu-id="05717-107">Defining a Query Projection</span></span>

<span data-ttu-id="05717-108">Puede Agregar una cláusula de proyección a una consulta mediante la opción de consulta `$select` en un URI o mediante la cláusula [Select](../../../csharp/language-reference/keywords/select-clause.md) ([Select](../../../visual-basic/language-reference/queries/select-clause.md) en Visual Basic) en una consulta LINQ.</span><span class="sxs-lookup"><span data-stu-id="05717-108">You can add a projection clause to a query either by using the `$select` query option in a URI or by using the [select](../../../csharp/language-reference/keywords/select-clause.md) clause ([Select](../../../visual-basic/language-reference/queries/select-clause.md) in Visual Basic) in a LINQ query.</span></span> <span data-ttu-id="05717-109">Los datos de entidad devueltos se pueden proyectar en tipos de entidad o en tipos que no son de entidad en el cliente.</span><span class="sxs-lookup"><span data-stu-id="05717-109">Returned entity data can be projected into either entity types or non-entity types on the client.</span></span> <span data-ttu-id="05717-110">Los ejemplos de este tema muestran cómo usar la cláusula `select` en una consulta LINQ.</span><span class="sxs-lookup"><span data-stu-id="05717-110">Examples in this topic demonstrate how to use the `select` clause in a LINQ query.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="05717-111">Se puede producir una pérdida de datos en el servicio de datos cuando se guardan actualizaciones efectuadas en tipos proyectados.</span><span class="sxs-lookup"><span data-stu-id="05717-111">Data loss might occur in the data service when you save updates that were made to projected types.</span></span> <span data-ttu-id="05717-112">Para obtener más información, consulte [consideraciones de proyección](#considerations).</span><span class="sxs-lookup"><span data-stu-id="05717-112">For more information, see [Projection Considerations](#considerations).</span></span>

## <a name="requirements-for-entity-and-non-entity-types"></a><span data-ttu-id="05717-113">Requisitos para tipos con entidad y sin ella</span><span class="sxs-lookup"><span data-stu-id="05717-113">Requirements for Entity and Non-Entity Types</span></span>

<span data-ttu-id="05717-114">Los tipos de entidad deben tener una o varias propiedades de entidad que constituyen la clave de la entidad.</span><span class="sxs-lookup"><span data-stu-id="05717-114">Entity types must have one or more identity properties that make up the entity key.</span></span> <span data-ttu-id="05717-115">Los tipos de entidad se definen en clientes de una de las siguientes formas:</span><span class="sxs-lookup"><span data-stu-id="05717-115">Entity types are defined on clients in one of the following ways:</span></span>

- <span data-ttu-id="05717-116">Aplicando las clases <xref:System.Data.Services.Common.DataServiceKeyAttribute> o <xref:System.Data.Services.Common.DataServiceEntityAttribute> al tipo.</span><span class="sxs-lookup"><span data-stu-id="05717-116">By applying the <xref:System.Data.Services.Common.DataServiceKeyAttribute> or <xref:System.Data.Services.Common.DataServiceEntityAttribute> to the type.</span></span>

- <span data-ttu-id="05717-117">Cuando el tipo tiene una propiedad denominada `ID`.</span><span class="sxs-lookup"><span data-stu-id="05717-117">When the type has a property named `ID`.</span></span>

- <span data-ttu-id="05717-118">Cuando el tipo tiene una propiedad denominada *type*`ID`, donde *Type* es el nombre del tipo.</span><span class="sxs-lookup"><span data-stu-id="05717-118">When the type has a property named *type*`ID`, where *type* is the name of the type.</span></span>

<span data-ttu-id="05717-119">De forma predeterminada, cuando proyecte los resultados de la consulta en un tipo definido en el cliente, las propiedades solicitadas en la proyección deben existir en el tipo de cliente.</span><span class="sxs-lookup"><span data-stu-id="05717-119">By default, when you project query results into a type defined at the client, the properties requested in the projection must exist in the client type.</span></span> <span data-ttu-id="05717-120">Sin embargo, cuando especifica un valor de `true` para la propiedad <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> de la clase <xref:System.Data.Services.Client.DataServiceContext>, es necesario que se produzcan las propiedades especificadas en la proyección en el tipo de cliente.</span><span class="sxs-lookup"><span data-stu-id="05717-120">However, when you specify a value of `true` for the <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> property of the <xref:System.Data.Services.Client.DataServiceContext>, properties specified in the projection are not required to occur in the client type.</span></span>

### <a name="making-updates-to-projected-results"></a><span data-ttu-id="05717-121">Realizar actualizaciones en los resultados proyectados</span><span class="sxs-lookup"><span data-stu-id="05717-121">Making Updates to Projected Results</span></span>

<span data-ttu-id="05717-122">Cuando proyecte los resultados de la consulta en tipos de entidad en el cliente, la clase <xref:System.Data.Services.Client.DataServiceContext> puede realizar el seguimiento de esos objetos con las actualizaciones que se van a devolver al servicio de datos cuando se llame al método <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A>.</span><span class="sxs-lookup"><span data-stu-id="05717-122">When you project query results into entity types on the client, the <xref:System.Data.Services.Client.DataServiceContext> can track those objects with updates to be sent back to the data service when the <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> method is called.</span></span> <span data-ttu-id="05717-123">No obstante, las actualizaciones efectuadas en datos proyectados en entidades sin tipo en el cliente no se pueden devolver al servicio de datos.</span><span class="sxs-lookup"><span data-stu-id="05717-123">However, updates that are made to data projected into non-entity types on the client cannot be sent back to the data service.</span></span> <span data-ttu-id="05717-124">Esto se debe a que el servicio de datos no puede actualizar la entidad correcta en el origen de datos sin ninguna clave que identifique la instancia de la entidad.</span><span class="sxs-lookup"><span data-stu-id="05717-124">This is because without a key to identify the entity instance, the data service cannot update the correct entity in the data source.</span></span> <span data-ttu-id="05717-125">Los tipos sin identidad no se adjunta a la clase <xref:System.Data.Services.Client.DataServiceContext>.</span><span class="sxs-lookup"><span data-stu-id="05717-125">Non-entity types are not attached to the <xref:System.Data.Services.Client.DataServiceContext>.</span></span>

<span data-ttu-id="05717-126">Cuando una o varias propiedades de un tipo de entidad definido en el servicio de datos no se producen en el tipo de cliente en el que se proyecta la entidad, las inserciones de nuevas entidades no contendrán estas propiedades que faltan.</span><span class="sxs-lookup"><span data-stu-id="05717-126">When one or more properties of an entity type defined in the data service do not occur in the client type into which the entity is projected, inserts of new entities will not contain these missing properties.</span></span> <span data-ttu-id="05717-127">En este caso, las actualizaciones que se realicen en las entidades existentes **tampoco** incluirán estas propiedades que faltan.</span><span class="sxs-lookup"><span data-stu-id="05717-127">In this case, updates that are made to existing entities will **also** not include these missing properties.</span></span> <span data-ttu-id="05717-128">Cuando un valor existe para tal propiedad, la actualización la restablece en el valor predeterminado de la propiedad, de la forma definida en el origen de datos.</span><span class="sxs-lookup"><span data-stu-id="05717-128">When a value exists for such a property, the update resets it to the default value for the property, as defined in the data source.</span></span>

### <a name="creating-projected-types"></a><span data-ttu-id="05717-129">Crear tipos proyectados</span><span class="sxs-lookup"><span data-stu-id="05717-129">Creating Projected Types</span></span>

<span data-ttu-id="05717-130">En el siguiente ejemplo se usa una consulta LINQ anónima que proyecta propiedades de relacionadas con la dirección del tipo `Customers` en un nuevo tipo `CustomerAddress`, que se define en el cliente y al que se le puede dar el atributo de tipo de entidad:</span><span class="sxs-lookup"><span data-stu-id="05717-130">The following example uses an anonymous LINQ query that projects the address-related properties of the `Customers` type into a new `CustomerAddress` type, which is defined on the client and is attributed as an entity type:</span></span>

[!code-csharp[Astoria Northwind Client#SelectCustomerAddressSpecific](~/samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#selectcustomeraddressspecific)]
[!code-vb[Astoria Northwind Client#SelectCustomerAddressSpecific](~/samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#selectcustomeraddressspecific)]

<span data-ttu-id="05717-131">En este ejemplo, se usa el patrón de inicializador de objeto para crear una nueva instancia del tipo `CustomerAddress` en vez de llamar a un constructor.</span><span class="sxs-lookup"><span data-stu-id="05717-131">In this example, the object initializer pattern is used to create a new instance of the `CustomerAddress` type instead of calling a constructor.</span></span> <span data-ttu-id="05717-132">No se admiten constructores cuando se realizan proyecciones en tipos de entidad, pero se pueden usar al realizar proyecciones en tipos sin entidad y anónimos.</span><span class="sxs-lookup"><span data-stu-id="05717-132">Constructors are not supported when projecting into entity types, but they can be used when projecting into non-entity and anonymous types.</span></span> <span data-ttu-id="05717-133">Puesto que `CustomerAddress` es un tipo de entidad, los cambios se pueden efectuar en el servicio de datos y devolvérselos a él.</span><span class="sxs-lookup"><span data-stu-id="05717-133">Because `CustomerAddress` is an entity type, changes can be made and sent back to the data service.</span></span>

<span data-ttu-id="05717-134">Asimismo, los datos de tipo `Customer` se proyectan en una instancia del tipo de entidad `CustomerAddress` en vez de en un tipo anónimo.</span><span class="sxs-lookup"><span data-stu-id="05717-134">Also, the data from the `Customer` type is projected into an instance of the `CustomerAddress` entity type instead of an anonymous type.</span></span> <span data-ttu-id="05717-135">Se admiten las proyecciones en tipos anónimos, pero los datos son de solo lectura porque los tipos anónimos se tratan como tipos sin entidad.</span><span class="sxs-lookup"><span data-stu-id="05717-135">Projection into anonymous types is supported, but the data is read-only because anonymous types are treated as non-entity types.</span></span>

<span data-ttu-id="05717-136">La configuración de la enumeración <xref:System.Data.Services.Client.MergeOption> de la clase <xref:System.Data.Services.Client.DataServiceContext> se usa para identificar la resolución durante la proyección de la consulta.</span><span class="sxs-lookup"><span data-stu-id="05717-136">The <xref:System.Data.Services.Client.MergeOption> settings of the <xref:System.Data.Services.Client.DataServiceContext> are used for identity resolution during query projection.</span></span> <span data-ttu-id="05717-137">Es decir, si una instancia del tipo `Customer` ya existe en la clase <xref:System.Data.Services.Client.DataServiceContext>, una instancia de `CustomerAddress` con la misma identidad seguirá las reglas de resolución de entidades establecidas por la enumeración <xref:System.Data.Services.Client.MergeOption>.</span><span class="sxs-lookup"><span data-stu-id="05717-137">This means that if an instance of the `Customer` type already exists in the <xref:System.Data.Services.Client.DataServiceContext>, an instance of `CustomerAddress` with the same identity will follow the identity resolution rules set by the <xref:System.Data.Services.Client.MergeOption></span></span>

<span data-ttu-id="05717-138">A continuación se describen los comportamientos al proyectar los resultados en tipos de entidad y que no son de entidad:</span><span class="sxs-lookup"><span data-stu-id="05717-138">The following describes the behaviors when projecting results into entity and non-entity types:</span></span>

<span data-ttu-id="05717-139">**Crear una nueva instancia proyectada mediante inicializadores**</span><span class="sxs-lookup"><span data-stu-id="05717-139">**Creating a new projected instance by using initializers**</span></span>

- <span data-ttu-id="05717-140">Ejemplo:</span><span class="sxs-lookup"><span data-stu-id="05717-140">Example:</span></span>

   [!code-csharp[Astoria Northwind Client#ProjectWithInitializer](~/samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#projectwithinitializer)]
   [!code-vb[Astoria Northwind Client#ProjectWithInitializer](~/samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#projectwithinitializer)]

- <span data-ttu-id="05717-141">Tipo de entidad: compatible</span><span class="sxs-lookup"><span data-stu-id="05717-141">Entity type: Supported</span></span>

- <span data-ttu-id="05717-142">Tipo que no es de entidad: compatible</span><span class="sxs-lookup"><span data-stu-id="05717-142">Non-entity type: Supported</span></span>

<span data-ttu-id="05717-143">**Crear una nueva instancia proyectada mediante constructores**</span><span class="sxs-lookup"><span data-stu-id="05717-143">**Creating a new projected instance by using constructors**</span></span>

- <span data-ttu-id="05717-144">Ejemplo:</span><span class="sxs-lookup"><span data-stu-id="05717-144">Example:</span></span>

   [!code-csharp[Astoria Northwind Client#ProjectWithConstructor](~/samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#projectwithconstructor)]
   [!code-vb[Astoria Northwind Client#ProjectWithConstructor](~/samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#projectwithconstructor)]

- <span data-ttu-id="05717-145">Tipo de entidad: se genera un <xref:System.NotSupportedException>.</span><span class="sxs-lookup"><span data-stu-id="05717-145">Entity type: A <xref:System.NotSupportedException> is raised.</span></span>

- <span data-ttu-id="05717-146">Tipo que no es de entidad: compatible</span><span class="sxs-lookup"><span data-stu-id="05717-146">Non-entity type: Supported</span></span>

<span data-ttu-id="05717-147">**Usar proyección para transformar un valor de propiedad**</span><span class="sxs-lookup"><span data-stu-id="05717-147">**Using projection to transform a property value**</span></span>

- <span data-ttu-id="05717-148">Ejemplo:</span><span class="sxs-lookup"><span data-stu-id="05717-148">Example:</span></span>

   [!code-csharp[Astoria Northwind Client#ProjectWithTransform](~/samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#projectwithtransform)]
   [!code-vb[Astoria Northwind Client#ProjectWithTransform](~/samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#projectwithtransform)]

- <span data-ttu-id="05717-149">Tipo de entidad: esta transformación no se admite para los tipos de entidad porque puede provocar confusión y sobrescribir potencialmente los datos en el origen de datos que pertenecen a otra entidad.</span><span class="sxs-lookup"><span data-stu-id="05717-149">Entity type: This transformation is not supported for entity types because it can lead to confusion and potentially overwriting the data in the data source that belongs to another entity.</span></span> <span data-ttu-id="05717-150">Se inicia una clase <xref:System.NotSupportedException>.</span><span class="sxs-lookup"><span data-stu-id="05717-150">A <xref:System.NotSupportedException> is raised.</span></span>

- <span data-ttu-id="05717-151">Tipo que no es de entidad: compatible</span><span class="sxs-lookup"><span data-stu-id="05717-151">Non-entity type: Supported</span></span>

<a name="considerations"></a>

## <a name="projection-considerations"></a><span data-ttu-id="05717-152">Consideraciones sobre proyecciones</span><span class="sxs-lookup"><span data-stu-id="05717-152">Projection Considerations</span></span>

<span data-ttu-id="05717-153">Se aplican las siguientes consideraciones adicionales cuando se define una proyección de consultas.</span><span class="sxs-lookup"><span data-stu-id="05717-153">The following additional considerations apply when defining a query projection.</span></span>

- <span data-ttu-id="05717-154">Cuando defina las fuentes personalizadas para el formato Atom, debe asegurarse de que se incluyan todas las propiedades de entidad con asignaciones personalizadas en la proyección.</span><span class="sxs-lookup"><span data-stu-id="05717-154">When you define custom feeds for the Atom format, you must make sure that all entity properties that have custom mappings defined are included in the projection.</span></span> <span data-ttu-id="05717-155">Cuando no se incluya ninguna propiedad de entidad asignada en la proyección, se puede producir la pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="05717-155">When a mapped entity property is not included in the projection, data loss might occur.</span></span> <span data-ttu-id="05717-156">Para obtener más información, vea [Personalización de fuentes](feed-customization-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="05717-156">For more information, see [Feed Customization](feed-customization-wcf-data-services.md).</span></span>

- <span data-ttu-id="05717-157">Cuando se realicen inserciones en un tipo proyectado que no contenga todas las propiedades de la entidad en el modelo de datos del servicio de datos, las propiedades no incluidas en la proyección en el cliente se establecen en sus valores predeterminados.</span><span class="sxs-lookup"><span data-stu-id="05717-157">When inserts are made to a projected type that does not contain all of the properties of the entity in the data model of the data service, the properties not included in the projection at the client are set to their default values.</span></span>

- <span data-ttu-id="05717-158">Cuando se realicen actualizaciones en un tipo proyectado que no contenga todas las propiedades de la entidad en el modelo de datos del servicio de datos, los valores existentes no incluidos en la proyección en el cliente se sobrescribirán con valores predeterminados sin inicializar.</span><span class="sxs-lookup"><span data-stu-id="05717-158">When updates are made to a projected type that does not contain all of the properties of the entity in the data model of the data service, existing values not included in the projection on the client will be overwritten with uninitialized default values.</span></span>

- <span data-ttu-id="05717-159">Cuando una proyección incluya una propiedad compleja, se debe devolver todo el objeto complejo.</span><span class="sxs-lookup"><span data-stu-id="05717-159">When a projection includes a complex property, the entire complex object must be returned.</span></span>

- <span data-ttu-id="05717-160">Cuando una proyección incluya una propiedad de navegación, los objetos relacionados se cargan implícitamente sin tener que llamar al método <xref:System.Data.Services.Client.DataServiceQuery%601.Expand%2A>.</span><span class="sxs-lookup"><span data-stu-id="05717-160">When a projection includes a navigation property, the related objects are loaded implicitly without having to call the <xref:System.Data.Services.Client.DataServiceQuery%601.Expand%2A> method.</span></span> <span data-ttu-id="05717-161">No se admite el método <xref:System.Data.Services.Client.DataServiceQuery%601.Expand%2A> para su uso en una consulta proyectada.</span><span class="sxs-lookup"><span data-stu-id="05717-161">The <xref:System.Data.Services.Client.DataServiceQuery%601.Expand%2A> method is not supported for use in a projected query.</span></span>

- <span data-ttu-id="05717-162">Las consultas de proyecciones de consultas en el cliente se traducen para usar la opción de consulta `$select` en el URI de solicitud.</span><span class="sxs-lookup"><span data-stu-id="05717-162">Query projections queries on the client are translated to use the `$select` query option in the request URI.</span></span> <span data-ttu-id="05717-163">Cuando se ejecuta una consulta con proyección en una versión anterior de WCF Data Services que no admite la opción de consulta `$select`, se devuelve un error.</span><span class="sxs-lookup"><span data-stu-id="05717-163">When a query with projection is executed against a previous version of WCF Data Services that does not support the `$select` query option, an error is returned.</span></span> <span data-ttu-id="05717-164">Esto también puede ocurrir cuando se establece la propiedad <xref:System.Data.Services.DataServiceBehavior.MaxProtocolVersion%2A> de la clase <xref:System.Data.Services.DataServiceBehavior> para el servicio de datos en el valor de la enumeración <xref:System.Data.Services.Common.DataServiceProtocolVersion.V1>.</span><span class="sxs-lookup"><span data-stu-id="05717-164">This can also happen when the <xref:System.Data.Services.DataServiceBehavior.MaxProtocolVersion%2A> of the <xref:System.Data.Services.DataServiceBehavior> for the data service is set to a value of <xref:System.Data.Services.Common.DataServiceProtocolVersion.V1>.</span></span> <span data-ttu-id="05717-165">Para obtener más información, vea [control de versiones del servicio de datos](data-service-versioning-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="05717-165">For more information, see [Data Service Versioning](data-service-versioning-wcf-data-services.md).</span></span>

<span data-ttu-id="05717-166">Para obtener más información, vea [Cómo: proyectar los resultados](how-to-project-query-results-wcf-data-services.md)de una consulta.</span><span class="sxs-lookup"><span data-stu-id="05717-166">For more information, see [How to: Project Query Results](how-to-project-query-results-wcf-data-services.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="05717-167">Vea también</span><span class="sxs-lookup"><span data-stu-id="05717-167">See also</span></span>

- [<span data-ttu-id="05717-168">Consultar el servicio de datos</span><span class="sxs-lookup"><span data-stu-id="05717-168">Querying the Data Service</span></span>](querying-the-data-service-wcf-data-services.md)
