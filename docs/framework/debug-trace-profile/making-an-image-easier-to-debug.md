---
title: Facilitar la depuración de una imagen en .NET
description: Aprenda a configurar una imagen ejecutable para facilitar la depuración mediante conmutadores IDE y opciones de línea de comandos.
ms.date: 08/30/2018
helpviewer_keywords:
- images [.NET Framework], debugging
- executable image for debugging
- debugging [.NET Framework], executable images for
ms.assetid: 7d90ea7a-150f-4f97-98a7-f9c26541b9a3
ms.openlocfilehash: 44d512a8ebec0e21e33f51c07428331e5e22b7bf
ms.sourcegitcommit: 9c54866bcbdc49dbb981dd55be9bbd0443837aa2
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/14/2020
ms.locfileid: "77217343"
---
# <a name="making-an-image-easier-to-debug-in-net"></a><span data-ttu-id="9b5cb-103">Facilitar la depuración de una imagen en .NET</span><span class="sxs-lookup"><span data-stu-id="9b5cb-103">Making an image easier to debug in .NET</span></span>

<span data-ttu-id="9b5cb-104">Al compilar código no administrado, puede configurar una imagen ejecutable para depurarla si establece algunos modificadores IDE u opciones de línea de comandos.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-104">When compiling unmanaged code, you can configure an executable image for debugging by setting IDE switches or command-line options.</span></span> <span data-ttu-id="9b5cb-105">Por ejemplo, puede usar la opción de línea de comandos /**Zi** en Visual C++ para solicitarle que emita archivos de símbolo de depuración (con la extensión de archivo .pdb).</span><span class="sxs-lookup"><span data-stu-id="9b5cb-105">For example, you can use the /**Zi** command-line option in Visual C++ to ask it to emit debug symbol files (file extension .pdb).</span></span> <span data-ttu-id="9b5cb-106">De forma similar, la opción de línea de comandos /**Od** indica al compilador que deshabilite la optimización.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-106">Similarly, the /**Od** command-line option tells the compiler to disable optimization.</span></span> <span data-ttu-id="9b5cb-107">El código resultante se ejecuta más lentamente, pero es más fácil de depurar, en caso de que sea necesario.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-107">The resulting code runs more slowly, but it's easier to debug, should this be necessary.</span></span>

<span data-ttu-id="9b5cb-108">Al compilar .NET Framework código administrado, compiladores como C++Visual, Visual Basic y C# compilar su programa de origen en lenguaje intermedio de Microsoft (MSIL).</span><span class="sxs-lookup"><span data-stu-id="9b5cb-108">When compiling .NET Framework managed code, compilers such as Visual C++, Visual Basic, and C# compile their source program into Microsoft intermediate language (MSIL).</span></span> <span data-ttu-id="9b5cb-109">Después, MSIL se compila con JIT, justo antes de la ejecución, en código máquina nativo.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-109">MSIL is then JIT-compiled, just before execution, into native machine code.</span></span> <span data-ttu-id="9b5cb-110">Al igual que con el código no administrado, puede configurar una imagen ejecutable para depurarla si establece algunos modificadores IDE u opciones de línea de comandos.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-110">As with unmanaged code, you can configure an executable image for debugging by setting IDE switches or command-line options.</span></span> <span data-ttu-id="9b5cb-111">También puede configurar la compilación JIT para la depuración de la misma manera.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-111">You can also configure the JIT compilation for debugging in much the same way.</span></span>

<span data-ttu-id="9b5cb-112">Esta configuración JIT tiene dos aspectos:</span><span class="sxs-lookup"><span data-stu-id="9b5cb-112">This JIT configuration has two aspects:</span></span>

- <span data-ttu-id="9b5cb-113">Puede solicitar al compilador JIT que genere información de seguimiento.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-113">You can request the JIT compiler to generate tracking information.</span></span> <span data-ttu-id="9b5cb-114">Esto permite que el depurador empareje una cadena de MSIL con su equivalente de código administrado y realizar un seguimiento de dónde se almacenan las variables locales y los argumentos de función.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-114">This makes it possible for the debugger to match up a chain of MSIL with its machine code counterpart, and to track where local variables and function arguments are stored.</span></span> <span data-ttu-id="9b5cb-115">A partir de la versión 2,0 de .NET Framework, el compilador JIT genera siempre información de seguimiento, por lo que no es necesario solicitarla.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-115">Starting with the .NET Framework version 2.0, the JIT compiler always generates tracking information, so there is no need to request it.</span></span>

- <span data-ttu-id="9b5cb-116">Puede solicitar al compilador JIT que no optimice el código de equipo resultante.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-116">You can request the JIT compiler to not optimize the resulting machine code.</span></span>

<span data-ttu-id="9b5cb-117">Normalmente, el compilador que genera el MSIL establece estas opciones del compilador JIT correctamente, en función de los modificadores IDE o las opciones de la línea de comandos que se especifiquen, por ejemplo,/**OD**.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-117">Normally, the compiler that generates the MSIL sets these JIT compiler options appropriately, based upon the IDE switches or command-line options you specify, for example, /**Od**.</span></span>

<span data-ttu-id="9b5cb-118">En algunos casos, puede cambiar el comportamiento del compilador JIT de forma que el código máquina que genera sea más fácil de depurar.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-118">In some cases, you might want to change the behavior of the JIT compiler so that the machine code it generates is easier to debug.</span></span> <span data-ttu-id="9b5cb-119">Por ejemplo, cuando desee generar información de seguimiento JIT para una compilación comercial o la optimización de controles.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-119">For example, you might want to generate JIT tracking information for a retail build or control optimization.</span></span> <span data-ttu-id="9b5cb-120">Puede hacer esto con un archivo de inicialización (.ini).</span><span class="sxs-lookup"><span data-stu-id="9b5cb-120">You can do so with an initialization (.ini) file.</span></span>

<span data-ttu-id="9b5cb-121">Por ejemplo, si el ensamblado que desea depurar se denomina *MyApp. exe*, puede crear un archivo de texto denominado *MyApp. ini*, en la misma carpeta que *MyApp. exe*, que contiene estas tres líneas:</span><span class="sxs-lookup"><span data-stu-id="9b5cb-121">For example, if the assembly you want to debug is called *MyApp.exe*, then you can create a text file named *MyApp.ini*, in the same folder as *MyApp.exe*, which contains these three lines:</span></span>

```ini
[.NET Framework Debugging Control]
GenerateTrackingInfo=1
AllowOptimize=0
```

<span data-ttu-id="9b5cb-122">Puede establecer el valor de cada opción en 0 o 1. Cualquier opción que no se encuentre presente tiene el valor predeterminado 0.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-122">You can set the value of each option to 0 or 1, and any absent option defaults to 0.</span></span> <span data-ttu-id="9b5cb-123">Si se establece el valor de `GenerateTrackingInfo` en 1 y el valor de `AllowOptimize` en 0, se obtiene la depuración más fácil.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-123">Setting `GenerateTrackingInfo` to 1 and `AllowOptimize` to 0 provides the easiest debugging.</span></span>

<span data-ttu-id="9b5cb-124">A partir de la versión 2,0 de .NET Framework, el compilador JIT genera siempre información de seguimiento independientemente del valor de `GenerateTrackingInfo`; sin embargo, el valor de `AllowOptimize` todavía tiene un efecto.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-124">Starting with the .NET Framework version 2.0, the JIT compiler always generates tracking information regardless of the value for `GenerateTrackingInfo`; however, the `AllowOptimize` value still has an effect.</span></span> <span data-ttu-id="9b5cb-125">Al usar [Ngen.exe (generador de imágenes nativo)](../tools/ngen-exe-native-image-generator.md) para precompilar la imagen nativa sin la optimización, el archivo .ini debe estar presente en la carpeta de destino con `AllowOptimize=0` cuando se ejecuta Ngen.exe.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-125">When using the [Ngen.exe (Native Image Generator)](../tools/ngen-exe-native-image-generator.md) to precompile the native image without optimization, the .ini file must be present in the target folder with `AllowOptimize=0` when Ngen.exe executes.</span></span> <span data-ttu-id="9b5cb-126">Si ha precompilado un ensamblado sin la optimización, debe quitar el código precompilado mediante la opción **/Uninstall** de Ngen. exe antes de volver a ejecutar Ngen. exe para precompilar el código como optimizado.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-126">If you have precompiled an assembly without optimization, you must remove the precompiled code using NGen.exe **/uninstall** option before rerunning Ngen.exe to precompile the code as optimized.</span></span> <span data-ttu-id="9b5cb-127">Si el archivo. ini no está presente en la carpeta, Ngen. exe precompila de forma predeterminada el código como optimizado.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-127">If the .ini file isn't present in the folder, by default Ngen.exe precompiles the code as optimized.</span></span>

<span data-ttu-id="9b5cb-128"><xref:System.Diagnostics.DebuggableAttribute?displayProperty=nameWithType> controla los valores de un ensamblado.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-128">The <xref:System.Diagnostics.DebuggableAttribute?displayProperty=nameWithType> controls the settings for an assembly.</span></span> <span data-ttu-id="9b5cb-129">**DebuggableAttribute** incluye dos campos que controlan si el compilador JIT debe optimizar y/o generar información de seguimiento.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-129">**DebuggableAttribute** includes two fields that control whether the JIT compiler should optimize and/or generate tracking information.</span></span> <span data-ttu-id="9b5cb-130">A partir de la versión 2,0 de .NET Framework, el compilador JIT genera siempre información de seguimiento.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-130">Starting with the .NET Framework version 2.0, the JIT compiler always generates tracking information.</span></span>

<span data-ttu-id="9b5cb-131">En una compilación comercial, los compiladores no establecen ningún **atributo DebuggableAttribute**.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-131">For a retail build, compilers don't set any **DebuggableAttribute**.</span></span> <span data-ttu-id="9b5cb-132">De forma predeterminada, el compilador JIT genera el mayor rendimiento, es más difícil de depurar código máquina.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-132">By default, the JIT compiler generates the highest performance, hardest to debug machine code.</span></span> <span data-ttu-id="9b5cb-133">Si se habilita el seguimiento JIT, disminuye un poco el rendimiento; si se deshabilita, disminuye mucho.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-133">Enabling JIT tracking lowers performance a little, and disabling optimization lowers performance a lot.</span></span>

<span data-ttu-id="9b5cb-134">**DebuggableAttribute** se aplica a un ensamblado completo cada vez, no a módulos individuales dentro del ensamblado.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-134">The **DebuggableAttribute** applies to a whole assembly at a time, not to individual modules within the assembly.</span></span> <span data-ttu-id="9b5cb-135">Por tanto, las herramientas de desarrollo deben asociar los atributos personalizados al token de metadatos del ensamblado, si ya se ha creado un ensamblado, o a la clase denominada **System.Runtime.CompilerServices.AssemblyAttributesGoHere**.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-135">Development tools must therefore attach custom attributes to the assembly metadata token, if an assembly has already been created, or to the class called **System.Runtime.CompilerServices.AssemblyAttributesGoHere**.</span></span> <span data-ttu-id="9b5cb-136">A continuación, la herramienta ALink promueve estos atributos **DebuggableAttribute** desde cada módulo al ensamblado del que forman parte.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-136">The ALink tool then promotes these **DebuggableAttribute** attributes from each module to the assembly they become a part of.</span></span> <span data-ttu-id="9b5cb-137">Si hay un conflicto, se produce un error en la operación ALink.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-137">If there's a conflict, the ALink operation fails.</span></span>

> [!NOTE]
> <span data-ttu-id="9b5cb-138">En el caso de la versión 1.0 de .NET Framework, el compilador de Microsoft Visual C++ agrega el atributo **DebuggableAttribute** cuando se especifican las opciones del compilador **/clr** y **/Zi**.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-138">In version 1.0 of the .NET Framework, the Microsoft Visual C++ compiler adds the **DebuggableAttribute** when the **/clr** and **/Zi** compiler options are specified.</span></span> <span data-ttu-id="9b5cb-139">En la versión 1,1 del .NET Framework, debe agregar el **atributo DebuggableAttribute** manualmente en el código o usar la opción **/AssemblyDebug** del vinculador.</span><span class="sxs-lookup"><span data-stu-id="9b5cb-139">In version 1.1 of the .NET Framework, you must either add the **DebuggableAttribute** manually in your code or use the **/ASSEMBLYDEBUG** linker option.</span></span>

## <a name="see-also"></a><span data-ttu-id="9b5cb-140">Consulte también</span><span class="sxs-lookup"><span data-stu-id="9b5cb-140">See also</span></span>

- [<span data-ttu-id="9b5cb-141">Depurar, trazar y generar perfiles</span><span class="sxs-lookup"><span data-stu-id="9b5cb-141">Debugging, Tracing, and Profiling</span></span>](index.md)
- [<span data-ttu-id="9b5cb-142">Habilitar la depuración de adjuntos JIT</span><span class="sxs-lookup"><span data-stu-id="9b5cb-142">Enabling JIT-Attach Debugging</span></span>](enabling-jit-attach-debugging.md)
- <span data-ttu-id="9b5cb-143">[Habilitar la generación de perfiles](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/s5ec0es1(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="9b5cb-143">[Enabling Profiling](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/s5ec0es1(v=vs.100))</span></span>
