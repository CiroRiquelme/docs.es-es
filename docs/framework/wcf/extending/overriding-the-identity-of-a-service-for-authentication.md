---
title: Invalidación de la identidad de un servicio para la autenticación
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: d613a22b-07d7-41a4-bada-1adc653b9b5d
ms.openlocfilehash: d1c0cc487d8deea7045ee9653d1eae9b73ec864f
ms.sourcegitcommit: 7e2128d4a4c45b4274bea3b8e5760d4694569ca1
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/14/2020
ms.locfileid: "75938018"
---
# <a name="overriding-the-identity-of-a-service-for-authentication"></a><span data-ttu-id="d1ecb-102">Invalidación de la identidad de un servicio para la autenticación</span><span class="sxs-lookup"><span data-stu-id="d1ecb-102">Overriding the Identity of a Service for Authentication</span></span>
<span data-ttu-id="d1ecb-103">Normalmente, no tiene que establecer la identidad en un servicio porque la selección de un tipo de credencial de cliente dicta el tipo de identidad expuesto en los metadatos del servicio.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-103">Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata.</span></span> <span data-ttu-id="d1ecb-104">Por ejemplo, el código de configuración siguiente usa el elemento [\<wsHttpBinding >](../../configure-apps/file-schema/wcf/wshttpbinding.md) y establece el atributo `clientCredentialType` en Windows.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-104">For example, the following configuration code uses the [\<wsHttpBinding>](../../configure-apps/file-schema/wcf/wshttpbinding.md) element and sets the `clientCredentialType` attribute to Windows.</span></span>  

 <span data-ttu-id="d1ecb-105">El fragmento siguiente de Lenguaje de descripción de servicios Web (WSDL) muestra la identidad para el punto de conexión previamente definido.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-105">The following Web Services Description Language (WSDL) fragment shows the identity for the endpoint previously defined.</span></span> <span data-ttu-id="d1ecb-106">En este ejemplo, el servicio se ejecuta como un servicio autohospedado en una cuenta de usuario determinada (username@contoso.com) y, por lo tanto, la identidad del nombre principal del usuario (UPN) contiene el nombre de la cuenta.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-106">In this example, the service is running as a self-hosted service under a particular user account (username@contoso.com) and therefore the user principal name (UPN) identity contains the account name.</span></span> <span data-ttu-id="d1ecb-107">El UPN también se conoce como el nombre de inicio de sesión de usuario en un dominio de Windows.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-107">The UPN is also known as the user logon name in a Windows domain.</span></span>  

 <span data-ttu-id="d1ecb-108">Para obtener una aplicación de ejemplo que muestra la configuración de identidad, vea [ejemplo de identidad de servicio](../samples/service-identity-sample.md).</span><span class="sxs-lookup"><span data-stu-id="d1ecb-108">For a sample application that demonstrates identity setting, see [Service Identity Sample](../samples/service-identity-sample.md).</span></span> <span data-ttu-id="d1ecb-109">Para obtener más información acerca de la identidad de servicio, consulte [identidad de servicio y autenticación](../feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="d1ecb-109">For more information about service identity, see [Service Identity and Authentication](../feature-details/service-identity-and-authentication.md).</span></span>  
  
## <a name="kerberos-authentication-and-identity"></a><span data-ttu-id="d1ecb-110">Autenticación e identidad de Kerberos</span><span class="sxs-lookup"><span data-stu-id="d1ecb-110">Kerberos Authentication and Identity</span></span>  
 <span data-ttu-id="d1ecb-111">De forma predeterminada, cuando un servicio se configura para usar una credencial de Windows, se genera un elemento [\<identity >](../../configure-apps/file-schema/wcf/identity.md) que contiene un elemento [\<userPrincipalName >](../../configure-apps/file-schema/wcf/userprincipalname.md) o [\<elemento servicePrincipalName >](../../configure-apps/file-schema/wcf/serviceprincipalname.md) en el WSDL.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-111">By default, when a service is configured to use a Windows credential, an [\<identity>](../../configure-apps/file-schema/wcf/identity.md) element that contains a [\<userPrincipalName>](../../configure-apps/file-schema/wcf/userprincipalname.md) or [\<servicePrincipalName>](../../configure-apps/file-schema/wcf/serviceprincipalname.md) element is generated in the WSDL.</span></span> <span data-ttu-id="d1ecb-112">Si el servicio se ejecuta bajo la cuenta `LocalSystem`, `LocalService`o `NetworkService`, se genera de forma predeterminada un nombre de entidad de seguridad de servicio (SPN) en forma de `host/`\<nombre de *host*> porque esas cuentas tienen acceso a los datos de SPN del equipo.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-112">If the service is running under the `LocalSystem`, `LocalService`, or `NetworkService` account, a service principal name (SPN) is generated by default in the form of `host/`\<*hostname*> because those accounts have access to the computer's SPN data.</span></span> <span data-ttu-id="d1ecb-113">Si el servicio se ejecuta en una cuenta diferente, Windows Communication Foundation (WCF) genera un UPN con el formato \<*nombre de usuario*>@<*domainname*`>`.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-113">If the service is running under a different account, Windows Communication Foundation (WCF) generates a UPN in the form of \<*username*>@<*domainName*`>`.</span></span> <span data-ttu-id="d1ecb-114">Esto ocurre porque la autenticación Kerberos requiere que se proporcione un UPN o SPN al cliente para autenticar el servicio.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-114">This occurs because Kerberos authentication requires that a UPN or SPN be supplied to the client to authenticate the service.</span></span>  
  
 <span data-ttu-id="d1ecb-115">También puede utilizar la herramienta Setspn.exe para registrar un SPN adicional con la cuenta de un servicio en un dominio.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-115">You can also use the Setspn.exe tool to register an additional SPN with a service's account in a domain.</span></span> <span data-ttu-id="d1ecb-116">Puede utilizar a continuación el SPN como la identidad del servicio.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-116">You can then use the SPN as the identity of the service.</span></span> <span data-ttu-id="d1ecb-117">Para descargar la herramienta, consulte [herramienta del kit de recursos de Windows 2000: setspn. exe](https://go.microsoft.com/fwlink/?LinkId=91752).</span><span class="sxs-lookup"><span data-stu-id="d1ecb-117">To download the tool, see [Windows 2000 Resource Kit Tool : Setspn.exe](https://go.microsoft.com/fwlink/?LinkId=91752).</span></span> <span data-ttu-id="d1ecb-118">Para obtener más información acerca de la herramienta, consulte [información general sobre setspn](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc773257(v=ws.10)).</span><span class="sxs-lookup"><span data-stu-id="d1ecb-118">For more information about the tool, see [Setspn Overview](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc773257(v=ws.10)).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d1ecb-119">Para usar el tipo de credencial de Windows sin negociación, la cuenta de usuario del servicio debe tener acceso al nombre de entidad de seguridad de servicio (SPN) registrado en el dominio de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-119">To use the Windows credential type without negotiation, the service's user account must have access to the SPN that is registered with the Active Directory domain.</span></span> <span data-ttu-id="d1ecb-120">Puede hacer esto de las siguientes maneras:</span><span class="sxs-lookup"><span data-stu-id="d1ecb-120">You can do this in the following ways:</span></span>  
  
- <span data-ttu-id="d1ecb-121">Use la cuenta NetworkService o LocalSystem para ejecutar el servicio.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-121">Use the NetworkService or LocalSystem account to run your service.</span></span> <span data-ttu-id="d1ecb-122">Dado que esas cuentas tienen acceso al SPN del equipo que se establece cuando el equipo se une al dominio de Active Directory, WCF genera automáticamente el elemento SPN apropiado dentro del punto de conexión del servicio en los metadatos del servicio (WSDL).</span><span class="sxs-lookup"><span data-stu-id="d1ecb-122">Because those accounts have access to the machine SPN that is established when the machine joins the Active Directory domain, WCF automatically generates the proper SPN element inside the service's endpoint in the service's metadata (WSDL).</span></span>  
  
- <span data-ttu-id="d1ecb-123">Utilice una cuenta de dominio arbitraria de Active Directory para ejecutar el servicio.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-123">Use an arbitrary Active Directory domain account to run your service.</span></span> <span data-ttu-id="d1ecb-124">En este caso, establezca un SPN para esa cuenta de dominio, lo cual puede llevar a cabo utilizando la herramienta de utilidad Setspn.exe.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-124">In this case, establish an SPN for that domain account, which you can do by using the Setspn.exe utility tool.</span></span> <span data-ttu-id="d1ecb-125">Una vez creado el SPN para la cuenta del servicio, configure WCF para publicar ese SPN en los clientes del servicio a través de sus metadatos (WSDL).</span><span class="sxs-lookup"><span data-stu-id="d1ecb-125">Once you create the SPN for the service's account, configure WCF to publish that SPN to the service's clients through its metadata (WSDL).</span></span> <span data-ttu-id="d1ecb-126">Para ello, hay que establecer la identidad del extremo para el extremo expuesto, ya sea mediante un archivo de configuración de la aplicación o el código.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-126">This is done by setting the endpoint identity for the exposed endpoint, either through an application configuration file or code.</span></span>  
  
 <span data-ttu-id="d1ecb-127">Para obtener más información acerca de los SPN, el protocolo Kerberos y Active Directory, vea el [suplemento técnico de Kerberos para Windows](https://docs.microsoft.com/previous-versions/msp-n-p/ff649429(v=pandp.10)).</span><span class="sxs-lookup"><span data-stu-id="d1ecb-127">For more information about SPNs, the Kerberos protocol, and Active Directory, see [Kerberos Technical Supplement for Windows](https://docs.microsoft.com/previous-versions/msp-n-p/ff649429(v=pandp.10)).</span></span>  
  
### <a name="when-spn-or-upn-equals-the-empty-string"></a><span data-ttu-id="d1ecb-128">Cuando SPN o UPN es igual a la cadena vacía</span><span class="sxs-lookup"><span data-stu-id="d1ecb-128">When SPN or UPN Equals the Empty String</span></span>  
 <span data-ttu-id="d1ecb-129">Si establece el SPN o el UPN igual a una cadena vacía, pueden ocurrir varias cosas diferentes, según el nivel de seguridad y modo de autenticación que se use:</span><span class="sxs-lookup"><span data-stu-id="d1ecb-129">If you set the SPN or UPN equal to an empty string, a number of different things happen, depending on the security level and authentication mode being used:</span></span>  
  
- <span data-ttu-id="d1ecb-130">Si está usando la seguridad de nivel de transporte, se elige la autenticación NT LanMan (NTLM).</span><span class="sxs-lookup"><span data-stu-id="d1ecb-130">If you are using transport level security, NT LanMan (NTLM) authentication is chosen.</span></span>  
  
- <span data-ttu-id="d1ecb-131">Si usa la seguridad de nivel de mensaje, se puede producir un error en la autenticación, en función del modo de autenticación:</span><span class="sxs-lookup"><span data-stu-id="d1ecb-131">If you are using message level security, authentication may fail, depending on the authentication mode:</span></span>  
  
- <span data-ttu-id="d1ecb-132">Si usa el modo `spnego` y el atributo `AllowNtlm` está establecido en `false`, se produce un error de autenticación.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-132">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `false`, authentication fail.</span></span>  
  
- <span data-ttu-id="d1ecb-133">Si usa el modo `spnego` y el atributo `AllowNtlm` está establecido en `true`, se produce un error de autenticación si el UPN está vacío, pero se realiza correctamente si el SPN está vacío.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-133">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `true`, authentication fails if the UPN is empty, but succeeds if the SPN is empty.</span></span>  
  
- <span data-ttu-id="d1ecb-134">Si usa Kerberos directo (también conocido como "de una vez"), se produce un error de autenticación.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-134">If you are using Kerberos direct (also known as "one-shot"), authentication fails.</span></span>  
  
### <a name="using-the-identity-element-in-configuration"></a><span data-ttu-id="d1ecb-135">Usar el elemento \<Identity > en la configuración</span><span class="sxs-lookup"><span data-stu-id="d1ecb-135">Using the \<identity> Element in Configuration</span></span>  
 <span data-ttu-id="d1ecb-136">Si se cambia el tipo de credencial de cliente del enlace mostrado anteriormente a Certificate`,` el WSDL generado contiene un certificado X.509 serializado en Base64 para el valor de identidad, como se muestra en el código siguiente.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-136">If you change the client credential type in the binding previously shown to Certificate`,` then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code.</span></span> <span data-ttu-id="d1ecb-137">Éste es el valor predeterminado para todos los tipos de credencial de cliente excepto Windows.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-137">This is the default for all client credential types other than Windows.</span></span>  

 <span data-ttu-id="d1ecb-138">Puede cambiar el valor de la identidad de servicio predeterminada o cambiar el tipo de la identidad mediante el <`identity`elemento > en la configuración o estableciendo la identidad en el código.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-138">You can change the value of the default service identity or change the type of the identity by using the <`identity`> element in configuration or by setting the identity in code.</span></span> <span data-ttu-id="d1ecb-139">El código de configuración siguiente establece una identidad del sistema de nombres de dominio (DNS) con el valor `contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-139">The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.</span></span>  

### <a name="setting-identity-programmatically"></a><span data-ttu-id="d1ecb-140">Establecimiento mediante programación de la identidad</span><span class="sxs-lookup"><span data-stu-id="d1ecb-140">Setting Identity Programmatically</span></span>  
 <span data-ttu-id="d1ecb-141">El servicio no tiene que especificar explícitamente una identidad, ya que WCF la determina automáticamente.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-141">Your service does not have to explicitly specify an identity, because WCF automatically determines it.</span></span> <span data-ttu-id="d1ecb-142">Sin embargo, WCF le permite especificar una identidad en un punto de conexión, si es necesario.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-142">However, WCF allows you to specify an identity on an endpoint, if required.</span></span> <span data-ttu-id="d1ecb-143">El código siguiente agrega un nuevo punto de conexión de servicio con una identidad de DNS concreta.</span><span class="sxs-lookup"><span data-stu-id="d1ecb-143">The following code adds a new service endpoint with a specific DNS identity.</span></span>  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## <a name="see-also"></a><span data-ttu-id="d1ecb-144">Vea también</span><span class="sxs-lookup"><span data-stu-id="d1ecb-144">See also</span></span>

- [<span data-ttu-id="d1ecb-145">Creación de un comprobador de identidad de cliente personalizado</span><span class="sxs-lookup"><span data-stu-id="d1ecb-145">How to: Create a Custom Client Identity Verifier</span></span>](how-to-create-a-custom-client-identity-verifier.md)
- [<span data-ttu-id="d1ecb-146">Identidad del servicio y autenticación</span><span class="sxs-lookup"><span data-stu-id="d1ecb-146">Service Identity and Authentication</span></span>](../feature-details/service-identity-and-authentication.md)
