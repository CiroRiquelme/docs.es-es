---
title: Propiedad de los datos por microservicio
description: La propiedad de datos por microservicio es uno de los puntos clave de los microservicios. Cada microservicio debe ser el único propietario de su base de datos, sin compartirla con ningún otro. Por supuesto, todas las instancias de un microservicio se conectan a la misma base de datos de alta disponibilidad.
ms.date: 09/20/2018
ms.openlocfilehash: f606d6314f38bf3e2c163871af432806dddc7446
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 03/14/2020
ms.locfileid: "73191910"
---
# <a name="data-sovereignty-per-microservice"></a><span data-ttu-id="2599b-105">Propiedad de los datos por microservicio</span><span class="sxs-lookup"><span data-stu-id="2599b-105">Data sovereignty per microservice</span></span>

<span data-ttu-id="2599b-106">Una regla importante de la arquitectura de microservicios es que cada microservicio debe ser propietario de sus datos de dominio y su lógica.</span><span class="sxs-lookup"><span data-stu-id="2599b-106">An important rule for microservices architecture is that each microservice must own its domain data and logic.</span></span> <span data-ttu-id="2599b-107">Al igual que una aplicación completa posee su lógica y sus datos, cada microservicio debe poseer su lógica y sus datos en un ciclo de vida autónomo, con implementación independiente por microservicio.</span><span class="sxs-lookup"><span data-stu-id="2599b-107">Just as a full application owns its logic and data, so must each microservice own its logic and data under an autonomous lifecycle, with independent deployment per microservice.</span></span>

<span data-ttu-id="2599b-108">Esto significa que el modelo conceptual del dominio variará entre subsistemas o microservicios.</span><span class="sxs-lookup"><span data-stu-id="2599b-108">This means that the conceptual model of the domain will differ between subsystems or microservices.</span></span> <span data-ttu-id="2599b-109">Piense en las aplicaciones empresariales, donde las aplicaciones de administración de las relaciones con el cliente (CRM), los subsistemas de compras transaccionales y los subsistemas de asistencia al cliente llaman cada uno de ellos a datos y atributos de entidades de cliente únicos y usan un contexto enlazado diferente.</span><span class="sxs-lookup"><span data-stu-id="2599b-109">Consider enterprise applications, where customer relationship management (CRM) applications, transactional purchase subsystems, and customer support subsystems each call on unique customer entity attributes and data, and where each employs a different Bounded Context (BC).</span></span>

<span data-ttu-id="2599b-110">Este principio es similar en el [diseño guiado por el dominio (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design), donde cada [contexto enlazado](https://martinfowler.com/bliki/BoundedContext.html) o subsistema o servicio autónomo debe ser propietario de su modelo de dominio (datos más lógica y comportamiento).</span><span class="sxs-lookup"><span data-stu-id="2599b-110">This principle is similar in [Domain-driven design (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design), where each [Bounded Context](https://martinfowler.com/bliki/BoundedContext.html) or autonomous subsystem or service must own its domain model (data plus logic and behavior).</span></span> <span data-ttu-id="2599b-111">Cada contexto enlazado de DDD se correlaciona con un microservicio de negocios (uno o varios servicios).</span><span class="sxs-lookup"><span data-stu-id="2599b-111">Each DDD Bounded Context correlates to one business microservice (one or several services).</span></span> <span data-ttu-id="2599b-112">En la sección siguiente se ofrece más información sobre el patrón de contexto enlazado.</span><span class="sxs-lookup"><span data-stu-id="2599b-112">This point about the Bounded Context pattern is expanded in the next section.</span></span>

<span data-ttu-id="2599b-113">Por otro lado, el enfoque tradicional (datos monolíticos) usado en muchas aplicaciones es tener una sola base de datos centralizada o solo algunas bases de datos.</span><span class="sxs-lookup"><span data-stu-id="2599b-113">On the other hand, the traditional (monolithic data) approach used in many applications is to have a single centralized database or just a few databases.</span></span> <span data-ttu-id="2599b-114">Suele ser una base de datos SQL normalizada que se usa para toda la aplicación y todos los subsistemas internos, como se muestra en la figura 4-7.</span><span class="sxs-lookup"><span data-stu-id="2599b-114">This is often a normalized SQL database that's used for the whole application and all its internal subsystems, as shown in Figure 4-7.</span></span>

![Diagrama que muestra los dos enfoques de la base de datos.](./media/data-sovereignty-per-microservice/data-sovereignty-comparison.png)

<span data-ttu-id="2599b-116">**Figura 4-7**.</span><span class="sxs-lookup"><span data-stu-id="2599b-116">**Figure 4-7**.</span></span> <span data-ttu-id="2599b-117">Comparación de propiedad de datos: base de datos monolítica frente a microservicios</span><span class="sxs-lookup"><span data-stu-id="2599b-117">Data sovereignty comparison: monolithic database versus microservices</span></span>

<span data-ttu-id="2599b-118">En el enfoque tradicional, hay una base de datos compartida en todos los servicios, normalmente en una arquitectura en capas.</span><span class="sxs-lookup"><span data-stu-id="2599b-118">In the traditional approach, there's a single database shared across all services, typically in a tiered architecture.</span></span> <span data-ttu-id="2599b-119">En el enfoque de microservicios, cada microservicio posee sus datos o modelos.</span><span class="sxs-lookup"><span data-stu-id="2599b-119">In the microservices approach, each microservice owns its model/data.</span></span> <span data-ttu-id="2599b-120">El enfoque de la base de datos centralizada en principio parece más sencillo y parece permitir la reutilización de entidades de diferentes subsistemas para que todo sea coherente.</span><span class="sxs-lookup"><span data-stu-id="2599b-120">The centralized database approach initially looks simpler and seems to enable reuse of entities in different subsystems to make everything consistent.</span></span> <span data-ttu-id="2599b-121">Pero la realidad es que se acaban teniendo tablas enormes que sirven a muchos subsistemas distintos e incluyen atributos y columnas que no se necesitan en la mayoría de los casos.</span><span class="sxs-lookup"><span data-stu-id="2599b-121">But the reality is you end up with huge tables that serve many different subsystems, and that include attributes and columns that aren't needed in most cases.</span></span> <span data-ttu-id="2599b-122">Es como intentar usar el mismo mapa físico para ir de excursión un par de horas, para hacer un viaje en coche que dure todo un día y para aprender geografía.</span><span class="sxs-lookup"><span data-stu-id="2599b-122">It's like trying to use the same physical map for hiking a short trail, taking a day-long car trip, and learning geography.</span></span>

<span data-ttu-id="2599b-123">Una aplicación monolítica que normalmente tiene una sola base de datos relacional presenta dos ventajas importantes: [Transacciones ACID](https://en.wikipedia.org/wiki/ACID) y el lenguaje SQL, ambos funcionando en todas las tablas y los datos relacionados con la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2599b-123">A monolithic application with typically a single relational database has two important benefits: [ACID transactions](https://en.wikipedia.org/wiki/ACID) and the SQL language, both working across all the tables and data related to your application.</span></span> <span data-ttu-id="2599b-124">Este enfoque proporciona una manera sencilla de escribir una consulta que combina datos de varias tablas.</span><span class="sxs-lookup"><span data-stu-id="2599b-124">This approach provides a way to easily write a query that combines data from multiple tables.</span></span>

<span data-ttu-id="2599b-125">Pero el acceso a los datos es mucho más complejo cuando se migra a una arquitectura de microservicios.</span><span class="sxs-lookup"><span data-stu-id="2599b-125">However, data access becomes much more complicated when you move to a microservices architecture.</span></span> <span data-ttu-id="2599b-126">Incluso cuando se usan transacciones ACID dentro de un microservicio o contexto delimitado, es fundamental tener en cuenta que los datos que pertenecen a cada microservicio son privados para ese microservicio y que solo se debe acceder a ellos de forma sincrónica a través de los puntos de conexión de su API (REST, gRPC, SOAP, etc.), o bien de forma asincrónica a través de mensajería (AMQP o similar).</span><span class="sxs-lookup"><span data-stu-id="2599b-126">Even when using ACID transactions within a microservice or Bounded Context, it is crucial to consider that the data owned by each microservice is private to that microservice and should only be accessed either synchronously through its API endpoints(REST, gRPC, SOAP, etc) or asynchronously via messaging(AMQP or similar).</span></span>

<span data-ttu-id="2599b-127">La encapsulación de los datos garantiza que los microservicios estén acoplados de forma imprecisa y puedan evolucionar independientemente unos de otros.</span><span class="sxs-lookup"><span data-stu-id="2599b-127">Encapsulating the data ensures that the microservices are loosely coupled and can evolve independently of one another.</span></span> <span data-ttu-id="2599b-128">Si varios servicios estuvieran accediendo a los mismos datos, las actualizaciones de esquema exigirían actualizaciones coordinadas de todos los servicios.</span><span class="sxs-lookup"><span data-stu-id="2599b-128">If multiple services were accessing the same data, schema updates would require coordinated updates to all the services.</span></span> <span data-ttu-id="2599b-129">Esto interrumpiría la autonomía del ciclo de vida del microservicio.</span><span class="sxs-lookup"><span data-stu-id="2599b-129">This would break the microservice lifecycle autonomy.</span></span> <span data-ttu-id="2599b-130">Pero las estructuras de datos distribuidas significan que no se puede realizar una única transacción ACID en microservicios.</span><span class="sxs-lookup"><span data-stu-id="2599b-130">But distributed data structures mean that you can't make a single ACID transaction across microservices.</span></span> <span data-ttu-id="2599b-131">A su vez, esto significa que debe usar la coherencia final cuando un proceso empresarial abarque varios microservicios.</span><span class="sxs-lookup"><span data-stu-id="2599b-131">This in turn means you must use eventual consistency when a business process spans multiple microservices.</span></span> <span data-ttu-id="2599b-132">Esto es mucho más difícil de implementar que meras combinaciones SQL, porque no se pueden crear restricciones de integridad o usar las transacciones distribuidas entre bases de datos independientes, como se explicará más adelante.</span><span class="sxs-lookup"><span data-stu-id="2599b-132">This is much harder to implement than simple SQL joins, because you can't create integrity constraints or use distributed transactions between separate databases, as we'll explain later on.</span></span> <span data-ttu-id="2599b-133">De forma similar, muchas otras características de base de datos relacional no están disponibles en varios microservicios.</span><span class="sxs-lookup"><span data-stu-id="2599b-133">Similarly, many other relational database features aren't available across multiple microservices.</span></span>

<span data-ttu-id="2599b-134">Si vamos aún más allá, los distintos microservicios suelen usar *tipos* diferentes de bases de datos.</span><span class="sxs-lookup"><span data-stu-id="2599b-134">Going even further, different microservices often use different *kinds* of databases.</span></span> <span data-ttu-id="2599b-135">Las aplicaciones modernas almacenan y procesan distintos tipos de datos, así que una base de datos relacional no siempre es la mejor opción.</span><span class="sxs-lookup"><span data-stu-id="2599b-135">Modern applications store and process diverse kinds of data, and a relational database isn't always the best choice.</span></span> <span data-ttu-id="2599b-136">En algunos casos de uso, una base de datos no SQL, como Azure CosmosDB o MongoDB, podría tener un modelo de datos más adecuado y ofrecer un mejor rendimiento y escalabilidad que una base de datos SQL como SQL Server o Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="2599b-136">For some use cases, a NoSQL database such as Azure CosmosDB or MongoDB might have a more convenient data model and offer better performance and scalability than a SQL database like SQL Server or Azure SQL Database.</span></span> <span data-ttu-id="2599b-137">En otros casos, una base de datos relacional sigue siendo el mejor enfoque.</span><span class="sxs-lookup"><span data-stu-id="2599b-137">In other cases, a relational database is still the best approach.</span></span> <span data-ttu-id="2599b-138">Por lo tanto, las aplicaciones basadas en microservicios suelen usar una combinación de bases de datos SQL y no SQL, lo que a veces se denomina enfoque de [persistencia políglota](https://martinfowler.com/bliki/PolyglotPersistence.html).</span><span class="sxs-lookup"><span data-stu-id="2599b-138">Therefore, microservices-based applications often use a mixture of SQL and NoSQL databases, which is sometimes called the [polyglot persistence](https://martinfowler.com/bliki/PolyglotPersistence.html) approach.</span></span>

<span data-ttu-id="2599b-139">Una arquitectura con particiones de persistencia políglota para el almacenamiento de datos tiene muchas ventajas.</span><span class="sxs-lookup"><span data-stu-id="2599b-139">A partitioned, polyglot-persistent architecture for data storage has many benefits.</span></span> <span data-ttu-id="2599b-140">Estas incluyen servicios acoplados de forma imprecisa y mejor rendimiento, escalabilidad, costos y manejabilidad.</span><span class="sxs-lookup"><span data-stu-id="2599b-140">These include loosely coupled services and better performance, scalability, costs, and manageability.</span></span> <span data-ttu-id="2599b-141">Pero puede presentar algunos desafíos de administración de datos distribuida, como se explica en "[Identificar los límites del modelo de dominio para cada microservicio](identify-microservice-domain-model-boundaries.md)" más adelante en este capítulo.</span><span class="sxs-lookup"><span data-stu-id="2599b-141">However, it can introduce some distributed data management challenges, as explained in "[Identifying domain-model boundaries](identify-microservice-domain-model-boundaries.md)" later in this chapter.</span></span>

## <a name="the-relationship-between-microservices-and-the-bounded-context-pattern"></a><span data-ttu-id="2599b-142">Relación entre microservicios y el patrón de contexto enlazado</span><span class="sxs-lookup"><span data-stu-id="2599b-142">The relationship between microservices and the Bounded Context pattern</span></span>

<span data-ttu-id="2599b-143">El concepto de microservicio deriva del [patrón de contexto enlazado](https://martinfowler.com/bliki/BoundedContext.html) en el [diseño guiado por el dominio (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design).</span><span class="sxs-lookup"><span data-stu-id="2599b-143">The concept of microservice derives from the [Bounded Context (BC) pattern](https://martinfowler.com/bliki/BoundedContext.html) in [domain-driven design (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design).</span></span> <span data-ttu-id="2599b-144">DDD trabaja con modelos grandes al dividirlos en varios contextos enlazados y ser explícito sobre sus límites.</span><span class="sxs-lookup"><span data-stu-id="2599b-144">DDD deals with large models by dividing them into multiple BCs and being explicit about their boundaries.</span></span> <span data-ttu-id="2599b-145">Cada contexto enlazado debe tener su propio modelo y base de datos; del mismo modo, cada microservicio es propietario de sus datos relacionados.</span><span class="sxs-lookup"><span data-stu-id="2599b-145">Each BC must have its own model and database; likewise, each microservice owns its related data.</span></span> <span data-ttu-id="2599b-146">Además, cada contexto enlazado normalmente tiene su propio [lenguaje ubicuo](https://martinfowler.com/bliki/UbiquitousLanguage.html) para la comunicación entre desarrolladores de software y expertos de dominio.</span><span class="sxs-lookup"><span data-stu-id="2599b-146">In addition, each BC usually has its own [ubiquitous language](https://martinfowler.com/bliki/UbiquitousLanguage.html) to help communication between software developers and domain experts.</span></span>

<span data-ttu-id="2599b-147">Esos términos (principalmente entidades de dominio) en el lenguaje ubicuo pueden tener otros nombres en otros contextos enlazados, incluso cuando varias entidades de dominio compartan la misma identidad (es decir, el identificador único que se usa para leer la entidad desde el almacenamiento).</span><span class="sxs-lookup"><span data-stu-id="2599b-147">Those terms (mainly domain entities) in the ubiquitous language can have different names in different Bounded Contexts, even when different domain entities share the same identity (that is, the unique ID that's used to read the entity from storage).</span></span> <span data-ttu-id="2599b-148">Por ejemplo, en un contexto enlazado de perfil de usuario, la entidad de dominio User puede compartir identidad con la entidad de dominio Buyer en el contexto enlazado Ordering.</span><span class="sxs-lookup"><span data-stu-id="2599b-148">For instance, in a user-profile Bounded Context, the User domain entity might share identity with the Buyer domain entity in the ordering Bounded Context.</span></span>

<span data-ttu-id="2599b-149">Un microservicio es, por tanto, como un contexto enlazado, pero además especifica que es un servicio distribuido.</span><span class="sxs-lookup"><span data-stu-id="2599b-149">A microservice is therefore like a Bounded Context, but it also specifies that it's a distributed service.</span></span> <span data-ttu-id="2599b-150">Se compila como un proceso independiente para cada contexto enlazado y debe usar los protocolos distribuidos indicados anteriormente, como HTTP/HTTPS, WebSockets o [AMQP](https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol).</span><span class="sxs-lookup"><span data-stu-id="2599b-150">It's built as a separate process for each Bounded Context, and it must use the distributed protocols noted earlier, like HTTP/HTTPS, WebSockets, or [AMQP](https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol).</span></span> <span data-ttu-id="2599b-151">Pero el patrón de contexto enlazado no especifica si el contexto enlazado es un servicio distribuido o si es simplemente un límite lógico (por ejemplo, un subsistema genérico) de una aplicación de implementación monolítica.</span><span class="sxs-lookup"><span data-stu-id="2599b-151">The Bounded Context pattern, however, doesn't specify whether the Bounded Context is a distributed service or if it's simply a logical boundary (such as a generic subsystem) within a monolithic-deployment application.</span></span>

<span data-ttu-id="2599b-152">Es importante resaltar que la definición de un servicio para cada contexto enlazado es un buen principio.</span><span class="sxs-lookup"><span data-stu-id="2599b-152">It's important to highlight that defining a service for each Bounded Context is a good place to start.</span></span> <span data-ttu-id="2599b-153">Pero no es necesario restringir el diseño a esto.</span><span class="sxs-lookup"><span data-stu-id="2599b-153">But you don't have to constrain your design to it.</span></span> <span data-ttu-id="2599b-154">A veces debe diseñar un contexto enlazado o microservicio de negocios formado por varios servicios físicos.</span><span class="sxs-lookup"><span data-stu-id="2599b-154">Sometimes you must design a Bounded Context or business microservice composed of several physical services.</span></span> <span data-ttu-id="2599b-155">Pero, en última instancia, ambos patrones, contexto enlazado y microservicio, están estrechamente relacionados.</span><span class="sxs-lookup"><span data-stu-id="2599b-155">But ultimately, both patterns -Bounded Context and microservice- are closely related.</span></span>

<span data-ttu-id="2599b-156">DDD se beneficia de los microservicios al obtener límites reales en forma de microservicios distribuidos.</span><span class="sxs-lookup"><span data-stu-id="2599b-156">DDD benefits from microservices by getting real boundaries in the form of distributed microservices.</span></span> <span data-ttu-id="2599b-157">Pero ideas como no compartir el modelo entre microservicios son las que también se quieren en un contexto enlazado.</span><span class="sxs-lookup"><span data-stu-id="2599b-157">But ideas like not sharing the model between microservices are what you also want in a Bounded Context.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="2599b-158">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="2599b-158">Additional resources</span></span>

- <span data-ttu-id="2599b-159">**Chris Richardson. Patrón: Database per service** (Patrón: base de datos por servicio) </span><span class="sxs-lookup"><span data-stu-id="2599b-159">**Chris Richardson. Pattern: Database per service** </span></span>\
  <https://microservices.io/patterns/data/database-per-service.html>

- <span data-ttu-id="2599b-160">**Martin Fowler. BoundedContext** </span><span class="sxs-lookup"><span data-stu-id="2599b-160">**Martin Fowler. BoundedContext** </span></span>\
  <https://martinfowler.com/bliki/BoundedContext.html>

- <span data-ttu-id="2599b-161">**Martin Fowler. PolyglotPersistence** </span><span class="sxs-lookup"><span data-stu-id="2599b-161">**Martin Fowler. PolyglotPersistence** </span></span>\
  <https://martinfowler.com/bliki/PolyglotPersistence.html>

- <span data-ttu-id="2599b-162">**Alberto Brandolini. Diseño orientado a dominios estratégicos con asignación de contexto** </span><span class="sxs-lookup"><span data-stu-id="2599b-162">**Alberto Brandolini. Strategic Domain Driven Design with Context Mapping** </span></span>\
  <https://www.infoq.com/articles/ddd-contextmapping>

>[!div class="step-by-step"]
><span data-ttu-id="2599b-163">[Anterior](microservices-architecture.md)
>[Siguiente](logical-versus-physical-architecture.md)</span><span class="sxs-lookup"><span data-stu-id="2599b-163">[Previous](microservices-architecture.md)
[Next](logical-versus-physical-architecture.md)</span></span>
