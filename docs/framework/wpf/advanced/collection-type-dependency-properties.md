---
title: Propiedades de dependencia de tipo de colección
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- properties [WPF], dependency
- properties [WPF], collection-type
- dependency properties [WPF]
- collection-type properties [WPF]
ms.assetid: 99f96a42-3ab7-4f64-a16b-2e10d654e97c
ms.openlocfilehash: e783ce4b95b52b86671181dfe4b316d4b91d8fc6
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/12/2020
ms.locfileid: "79141543"
---
# <a name="collection-type-dependency-properties"></a><span data-ttu-id="d32a5-102">Propiedades de dependencia de tipo de colección</span><span class="sxs-lookup"><span data-stu-id="d32a5-102">Collection-Type Dependency Properties</span></span>
<span data-ttu-id="d32a5-103">En este tema se proporciona una guía y modelos recomendados para implementar una propiedad de dependencia donde el tipo de la propiedad es un tipo de colección.</span><span class="sxs-lookup"><span data-stu-id="d32a5-103">This topic provides guidance and suggested patterns for how to implement a dependency property where the type of the property is a collection type.</span></span>  

<a name="implementing"></a>
## <a name="implementing-a-collection-type-dependency-property"></a><span data-ttu-id="d32a5-104">Implementar una propiedad de dependencia de tipo de colección</span><span class="sxs-lookup"><span data-stu-id="d32a5-104">Implementing a Collection-Type Dependency Property</span></span>  
 <span data-ttu-id="d32a5-105">Para una propiedad de dependencia en general, el patrón de implementación que sigue es <xref:System.Windows.DependencyProperty> que se define un contenedor de propiedades CLR, donde esa propiedad está respaldada por un identificador en lugar de un campo u otra construcción.</span><span class="sxs-lookup"><span data-stu-id="d32a5-105">For a dependency property in general, the implementation pattern that you follow is that you define a CLR property wrapper, where that property is backed by a <xref:System.Windows.DependencyProperty> identifier rather than a field or other construct.</span></span> <span data-ttu-id="d32a5-106">Siga este mismo modelo al implementar una propiedad de tipo de colección.</span><span class="sxs-lookup"><span data-stu-id="d32a5-106">You follow this same pattern when you implement a collection-type property.</span></span> <span data-ttu-id="d32a5-107">Sin embargo, una propiedad de tipo de colección introduce cierta complejidad en el <xref:System.Windows.DependencyObject> <xref:System.Windows.Freezable> patrón cada vez que el tipo que se encuentra dentro de la colección es en sí mismo una clase derivada o.</span><span class="sxs-lookup"><span data-stu-id="d32a5-107">However, a collection-type property introduces some complexity to the pattern whenever the type that is contained within the collection is itself a <xref:System.Windows.DependencyObject> or <xref:System.Windows.Freezable> derived class.</span></span>  
  
<a name="initializing"></a>
## <a name="initializing-the-collection-beyond-the-default-value"></a><span data-ttu-id="d32a5-108">Inicialización de la colección más allá del valor predeterminado</span><span class="sxs-lookup"><span data-stu-id="d32a5-108">Initializing the Collection Beyond the Default Value</span></span>  
 <span data-ttu-id="d32a5-109">Cuando cree una propiedad de dependencia, no especifique el valor predeterminado de la propiedad como el valor inicial del campo.</span><span class="sxs-lookup"><span data-stu-id="d32a5-109">When you create a dependency property, you do not specify the property default value as the initial field value.</span></span> <span data-ttu-id="d32a5-110">En su lugar, especifique el valor predeterminado a través de los metadatos de la propiedad de dependencia.</span><span class="sxs-lookup"><span data-stu-id="d32a5-110">Instead, you specify the default value through the dependency property metadata.</span></span> <span data-ttu-id="d32a5-111">Si la propiedad es un tipo de referencia, el valor predeterminado especificado en los metadatos de la propiedad de dependencia no es un valor predeterminado por instancia; en su lugar, es un valor predeterminado que se aplica a todas las instancias del tipo.</span><span class="sxs-lookup"><span data-stu-id="d32a5-111">If your property is a reference type, the default value specified in dependency property metadata is not a default value per instance; instead it is a default value that applies to all instances of the type.</span></span> <span data-ttu-id="d32a5-112">Por lo tanto, debe tener cuidado de no usar la colección estática singular definida por los metadatos de la propiedad de colección como el valor predeterminado operativo para las instancias recién creadas del tipo.</span><span class="sxs-lookup"><span data-stu-id="d32a5-112">Therefore you must be careful to not use the singular static collection defined by the collection property metadata as the working default value for newly created instances of your type.</span></span> <span data-ttu-id="d32a5-113">En su lugar, debe asegurarse de establecer deliberadamente el valor de la colección en una colección única (instancia) como parte de la lógica del constructor de clase.</span><span class="sxs-lookup"><span data-stu-id="d32a5-113">Instead, you must make sure that you deliberately set the collection value to a unique (instance) collection as part of your class constructor logic.</span></span> <span data-ttu-id="d32a5-114">De lo contrario, habrá creado involuntariamente una clase singleton.</span><span class="sxs-lookup"><span data-stu-id="d32a5-114">Otherwise you will have created an unintentional singleton class.</span></span>  
  
 <span data-ttu-id="d32a5-115">Considere el ejemplo siguiente.</span><span class="sxs-lookup"><span data-stu-id="d32a5-115">Consider the following example.</span></span> <span data-ttu-id="d32a5-116">En la siguiente sección del ejemplo `Aquarium`se muestra la definición de una clase , que contiene un error con el valor predeterminado.</span><span class="sxs-lookup"><span data-stu-id="d32a5-116">The following section of the example shows the definition for a class `Aquarium`, which contains a flaw with the default value.</span></span> <span data-ttu-id="d32a5-117">La clase define la `AquariumObjects`propiedad de dependencia <xref:System.Collections.Generic.List%601> de <xref:System.Windows.FrameworkElement> tipo de colección, que utiliza el tipo genérico con una restricción de tipo.</span><span class="sxs-lookup"><span data-stu-id="d32a5-117">The class defines the collection type dependency property `AquariumObjects`, which uses the generic <xref:System.Collections.Generic.List%601> type with a <xref:System.Windows.FrameworkElement> type constraint.</span></span> <span data-ttu-id="d32a5-118">En <xref:System.Windows.DependencyProperty.Register%28System.String%2CSystem.Type%2CSystem.Type%2CSystem.Windows.PropertyMetadata%29> la llamada a la propiedad de dependencia, los metadatos <xref:System.Collections.Generic.List%601>establecen que el valor predeterminado es un nuevo genérico.</span><span class="sxs-lookup"><span data-stu-id="d32a5-118">In the <xref:System.Windows.DependencyProperty.Register%28System.String%2CSystem.Type%2CSystem.Type%2CSystem.Windows.PropertyMetadata%29> call for the dependency property, the metadata establishes the default value to be a new generic <xref:System.Collections.Generic.List%601>.</span></span>

> [!WARNING]
> <span data-ttu-id="d32a5-119">El código siguiente no se comporta correctamente.</span><span class="sxs-lookup"><span data-stu-id="d32a5-119">The following code does not behave correctly.</span></span>

 [!code-csharp[PropertiesOvwSupport2#CollectionProblemDefinition](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport2/CSharp/page.xaml.cs#collectionproblemdefinition)]
 [!code-vb[PropertiesOvwSupport2#CollectionProblemDefinition](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport2/visualbasic/page.xaml.vb#collectionproblemdefinition)]  
  
 <span data-ttu-id="d32a5-120">Sin embargo, si se limita a dejar el código tal como se muestra, ese valor predeterminado de lista único se comparte en todas las instancias de `Aquarium`.</span><span class="sxs-lookup"><span data-stu-id="d32a5-120">However, if you just left the code as shown, that single list default value is shared for all instances of `Aquarium`.</span></span> <span data-ttu-id="d32a5-121">Si ejecutara el siguiente código de prueba, destinado a mostrar cómo se crea una instancia de dos instancias `Aquarium` independientes y se agrega un único valor `Fish` diferente a cada una de ellas, vería un resultado sorprendente:</span><span class="sxs-lookup"><span data-stu-id="d32a5-121">If you ran the following test code, which is intended to show how you would instantiate two separate `Aquarium` instances and add a single different `Fish` to each of them, you would see a surprising result:</span></span>  
  
 [!code-csharp[PropertiesOvwSupport#CollectionProblemTestCode](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page4.xaml.cs#collectionproblemtestcode)]
 [!code-vb[PropertiesOvwSupport#CollectionProblemTestCode](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport/visualbasic/page4.xaml.vb#collectionproblemtestcode)]  
  
 <span data-ttu-id="d32a5-122">En lugar de tener un recuento de uno, cada colección tiene un recuento de dos.</span><span class="sxs-lookup"><span data-stu-id="d32a5-122">Instead of each collection having a count of one, each collection has a count of two!</span></span> <span data-ttu-id="d32a5-123">Esto se debe a que cada `Aquarium` agregó su `Fish` a la colección de valores predeterminados, que resultó de una única llamada de constructor en los metadatos y, por tanto, se compartió en todas las instancias.</span><span class="sxs-lookup"><span data-stu-id="d32a5-123">This is because each `Aquarium` added its `Fish` to the default value collection, which resulted from a single constructor call in the metadata and is therefore shared between all instances.</span></span> <span data-ttu-id="d32a5-124">Esta situación casi nunca es la deseada.</span><span class="sxs-lookup"><span data-stu-id="d32a5-124">This situation is almost never what you want.</span></span>  
  
 <span data-ttu-id="d32a5-125">Para corregir este problema, debe restablecer el valor de la propiedad de dependencia de la colección en una instancia única, como parte de la llamada al constructor de clase.</span><span class="sxs-lookup"><span data-stu-id="d32a5-125">To correct this problem, you must reset the collection dependency property value to a unique instance, as part of the class constructor call.</span></span> <span data-ttu-id="d32a5-126">Dado que la propiedad es una propiedad <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyPropertyKey%2CSystem.Object%29> de dependencia de solo <xref:System.Windows.DependencyPropertyKey> lectura, utilice el método para establecerla, utilizando el que solo es accesible dentro de la clase.</span><span class="sxs-lookup"><span data-stu-id="d32a5-126">Because the property is a read-only dependency property, you use the <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyPropertyKey%2CSystem.Object%29> method to set it, using the <xref:System.Windows.DependencyPropertyKey> that is only accessible within the class.</span></span>  
  
 [!code-csharp[PropertiesOvwSupport#CollectionProblemCtor](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page4.xaml.cs#collectionproblemctor)]
 [!code-vb[PropertiesOvwSupport#CollectionProblemCtor](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport/visualbasic/page4.xaml.vb#collectionproblemctor)]  
  
 <span data-ttu-id="d32a5-127">Ahora, si ejecutara el mismo código de prueba de nuevo, podría obtener resultados más previsibles, donde cada `Aquarium` admite su propia colección única.</span><span class="sxs-lookup"><span data-stu-id="d32a5-127">Now, if you ran that same test code again, you could see more expected results, where each `Aquarium` supported its own unique collection.</span></span>  
  
 <span data-ttu-id="d32a5-128">Se produciría una ligera variación en este modelo si decidiera definir la propiedad de colección como de lectura y escritura.</span><span class="sxs-lookup"><span data-stu-id="d32a5-128">There would be a slight variation on this pattern if you chose to have your collection property be read-write.</span></span> <span data-ttu-id="d32a5-129">En ese caso, podría llamar al descriptor de acceso de conjunto público desde el <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyProperty%2CSystem.Object%29> constructor para realizar la <xref:System.Windows.DependencyProperty> inicialización, que seguiría llamando a la firma sin clave de dentro del contenedor de conjunto, mediante un identificador público.</span><span class="sxs-lookup"><span data-stu-id="d32a5-129">In that case, you could call the public set accessor from the constructor to do the initialization, which would still be calling the nonkey signature of <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyProperty%2CSystem.Object%29> within your set wrapper, using a public <xref:System.Windows.DependencyProperty> identifier.</span></span>  
  
## <a name="reporting-binding-value-changes-from-collection-properties"></a><span data-ttu-id="d32a5-130">Notificación de cambios en los valores de enlace de las propiedades de colección</span><span class="sxs-lookup"><span data-stu-id="d32a5-130">Reporting Binding Value Changes from Collection Properties</span></span>  
 <span data-ttu-id="d32a5-131">Una propiedad de colección que es una propiedad de dependencia no notifica automáticamente los cambios en sus subpropiedades.</span><span class="sxs-lookup"><span data-stu-id="d32a5-131">A collection property that is itself a dependency property does not automatically report changes to its subproperties.</span></span> <span data-ttu-id="d32a5-132">Si está creando enlaces en una colección, esto puede impedir que el enlace comunique los cambios, lo que invalidaría algunos escenarios de enlace de datos.</span><span class="sxs-lookup"><span data-stu-id="d32a5-132">If you are creating bindings into a collection, this can prevent the binding from reporting changes, thus invalidating some data binding scenarios.</span></span> <span data-ttu-id="d32a5-133">Sin embargo, si <xref:System.Windows.FreezableCollection%601> usa el tipo de colección como tipo de colección, los cambios de subpropiedad a los elementos contenidos de la colección se notifican correctamente y el enlace funciona según lo esperado.</span><span class="sxs-lookup"><span data-stu-id="d32a5-133">However, if you use the collection type <xref:System.Windows.FreezableCollection%601> as your collection type, then subproperty changes to contained elements in the collection are properly reported, and binding works as expected.</span></span>  
  
 <span data-ttu-id="d32a5-134">Para habilitar el enlace de subpropiedad en una <xref:System.Windows.FreezableCollection%601>colección de objetos de <xref:System.Windows.DependencyObject> dependencia, cree la propiedad de colección como tipo , con una restricción de tipo para esa colección en cualquier clase derivada.</span><span class="sxs-lookup"><span data-stu-id="d32a5-134">To enable subproperty binding in a dependency object collection, create the collection property as type <xref:System.Windows.FreezableCollection%601>, with a type constraint for that collection to any <xref:System.Windows.DependencyObject> derived class.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d32a5-135">Consulte también</span><span class="sxs-lookup"><span data-stu-id="d32a5-135">See also</span></span>

- <xref:System.Windows.FreezableCollection%601>
- [<span data-ttu-id="d32a5-136">Clases XAML y personalizadas para WPF</span><span class="sxs-lookup"><span data-stu-id="d32a5-136">XAML and Custom Classes for WPF</span></span>](xaml-and-custom-classes-for-wpf.md)
- [<span data-ttu-id="d32a5-137">Descripción general del enlace de datos</span><span class="sxs-lookup"><span data-stu-id="d32a5-137">Data Binding Overview</span></span>](../../../desktop-wpf/data/data-binding-overview.md)
- [<span data-ttu-id="d32a5-138">Descripción general de las propiedades de dependencia</span><span class="sxs-lookup"><span data-stu-id="d32a5-138">Dependency Properties Overview</span></span>](dependency-properties-overview.md)
- [<span data-ttu-id="d32a5-139">Propiedades de dependencia personalizadas</span><span class="sxs-lookup"><span data-stu-id="d32a5-139">Custom Dependency Properties</span></span>](custom-dependency-properties.md)
- [<span data-ttu-id="d32a5-140">Metadatos de las propiedades de dependencia</span><span class="sxs-lookup"><span data-stu-id="d32a5-140">Dependency Property Metadata</span></span>](dependency-property-metadata.md)
