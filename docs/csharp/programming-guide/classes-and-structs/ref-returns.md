---
title: Valores devueltos y variables locales de tipo ref (Guía de C#)
description: Obtenga información sobre cómo definir y usar valores locales y devueltos de tipo ref
ms.date: 04/04/2018
ms.openlocfilehash: 87a9538db60d69062f0fb48ed9683a9d4f972b91
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 03/14/2020
ms.locfileid: "79170078"
---
# <a name="ref-returns-and-ref-locals"></a><span data-ttu-id="58f41-103">Valores devueltos y variables locales de tipo ref</span><span class="sxs-lookup"><span data-stu-id="58f41-103">Ref returns and ref locals</span></span>

<span data-ttu-id="58f41-104">A partir de C# 7.0, C# admite los valores devueltos de referencia (valores devueltos de tipo ref).</span><span class="sxs-lookup"><span data-stu-id="58f41-104">Starting with C# 7.0, C# supports reference return values (ref returns).</span></span> <span data-ttu-id="58f41-105">Un valor devuelto de referencia permite que un método devuelva una referencia a una variable, en lugar de un valor, al autor de una llamada.</span><span class="sxs-lookup"><span data-stu-id="58f41-105">A reference return value allows a method to return a reference to a variable, rather than a value, back to a caller.</span></span> <span data-ttu-id="58f41-106">El autor de la llamada puede tratar la variable devuelta como si se hubiera devuelto por valor o por referencia.</span><span class="sxs-lookup"><span data-stu-id="58f41-106">The caller can then choose to treat the returned variable as if it were returned by value or by reference.</span></span> <span data-ttu-id="58f41-107">El autor de la llamada puede crear una variable que sea una referencia al valor devuelto, lo que se conoce como una referencia local.</span><span class="sxs-lookup"><span data-stu-id="58f41-107">The caller can create a new variable that is itself a reference to the returned value, called a ref local.</span></span>

## <a name="what-is-a-reference-return-value"></a><span data-ttu-id="58f41-108">¿Qué es un valor devuelto de referencia?</span><span class="sxs-lookup"><span data-stu-id="58f41-108">What is a reference return value?</span></span>

<span data-ttu-id="58f41-109">La mayoría de los desarrolladores están familiarizados con pasar un argumento a un método llamado *por referencia*.</span><span class="sxs-lookup"><span data-stu-id="58f41-109">Most developers are familiar with passing an argument to a called method *by reference*.</span></span> <span data-ttu-id="58f41-110">Una lista de argumentos del método llamado incluye una variable que pasa la referencia.</span><span class="sxs-lookup"><span data-stu-id="58f41-110">A called method's argument list includes a variable passed by reference.</span></span> <span data-ttu-id="58f41-111">El autor de la llamada observa los cambios que ha realizado el método llamado a su valor.</span><span class="sxs-lookup"><span data-stu-id="58f41-111">Any changes made to its value by the called method are observed by the caller.</span></span> <span data-ttu-id="58f41-112">Un *valor devuelto de referencia* significa que un método devuelve una *referencia* (o un alias) a alguna variable.</span><span class="sxs-lookup"><span data-stu-id="58f41-112">A *reference return value* means that a method returns a *reference* (or an alias) to some variable.</span></span> <span data-ttu-id="58f41-113">El ámbito de esa variable debe incluir el método.</span><span class="sxs-lookup"><span data-stu-id="58f41-113">That variable's scope must include the method.</span></span> <span data-ttu-id="58f41-114">La duración de la variable debe extenderse más allá de la devolución del método.</span><span class="sxs-lookup"><span data-stu-id="58f41-114">That variable's lifetime must extend beyond the return of the method.</span></span> <span data-ttu-id="58f41-115">Las modificaciones en el valor del método devuelto por el autor de la llamada se realizan en la variable devuelta por el método.</span><span class="sxs-lookup"><span data-stu-id="58f41-115">Modifications to the method's return value by the caller are made to the variable that is returned by the method.</span></span>

<span data-ttu-id="58f41-116">Declarar que un método devuelve un *valor devuelto de referencia* indica que el método devuelve un alias a una variable.</span><span class="sxs-lookup"><span data-stu-id="58f41-116">Declaring that a method returns a *reference return value* indicates that the method returns an alias to a variable.</span></span> <span data-ttu-id="58f41-117">El diseño suele pretender que el código de llamada acceda a dicha variable con el alias, incluso para modificarla.</span><span class="sxs-lookup"><span data-stu-id="58f41-117">The design intent is often that the calling code should have access to that variable through the alias, including to modify it.</span></span> <span data-ttu-id="58f41-118">Por tanto, los métodos devueltos por referencia no pueden tener el tipo de valor devuelto `void`.</span><span class="sxs-lookup"><span data-stu-id="58f41-118">It follows that methods returning by reference can't have the return type `void`.</span></span>

<span data-ttu-id="58f41-119">Hay algunas restricciones en la expresión que un método puede devolver como un valor devuelto de referencia.</span><span class="sxs-lookup"><span data-stu-id="58f41-119">There are some restrictions on the expression that a method can return as a reference return value.</span></span> <span data-ttu-id="58f41-120">Entre las restricciones se incluyen:</span><span class="sxs-lookup"><span data-stu-id="58f41-120">Restrictions include:</span></span>

- <span data-ttu-id="58f41-121">El valor devuelto debe tener una duración que se extienda más allá de la ejecución del método.</span><span class="sxs-lookup"><span data-stu-id="58f41-121">The return value must have a lifetime that extends beyond the execution of the method.</span></span> <span data-ttu-id="58f41-122">En otras palabras, no puede tratarse de una variable local del método que la devuelve.</span><span class="sxs-lookup"><span data-stu-id="58f41-122">In other words, it cannot be a local variable in the method that returns it.</span></span> <span data-ttu-id="58f41-123">Puede ser una instancia o un campo estático de una clase, o puede ser un argumento pasado al método.</span><span class="sxs-lookup"><span data-stu-id="58f41-123">It can be an instance or static field of a class, or it can be an argument passed to the method.</span></span> <span data-ttu-id="58f41-124">Al intentar devolver una variable local, se genera el error del compilador CS8168, "No se puede devolver por referencia la variable local 'obj' porque no es de tipo ref".</span><span class="sxs-lookup"><span data-stu-id="58f41-124">Attempting to return a local variable generates compiler error CS8168, "Cannot return local 'obj' by reference because it is not a ref local."</span></span>

- <span data-ttu-id="58f41-125">El valor devuelto no puede ser el literal `null`.</span><span class="sxs-lookup"><span data-stu-id="58f41-125">The return value cannot be the literal `null`.</span></span> <span data-ttu-id="58f41-126">Si devuelve `null`, se genera el error del compilador CS8156, "No se puede usar una expresión en este contexto porque no se puede devolver por referencia".</span><span class="sxs-lookup"><span data-stu-id="58f41-126">Returning `null` generates compiler error CS8156, "An expression cannot be used in this context because it may not be returned by reference."</span></span>

   <span data-ttu-id="58f41-127">Un método con un valor devuelto de referencia puede devolver un alias a una variable cuyo valor es actualmente el valor NULL (sin instancias) o un [tipo de valor que admite un valor NULL](../../language-reference/builtin-types/nullable-value-types.md) para un tipo de valor.</span><span class="sxs-lookup"><span data-stu-id="58f41-127">A method with a ref return can return an alias to a variable whose value is currently the null (uninstantiated) value or a [nullable value type](../../language-reference/builtin-types/nullable-value-types.md) for a value type.</span></span>

- <span data-ttu-id="58f41-128">El valor devuelto no puede ser una constante, un miembro de enumeración, el valor devuelto por valor desde una propiedad o un método de `class` o `struct`.</span><span class="sxs-lookup"><span data-stu-id="58f41-128">The return value cannot be a constant, an enumeration member, the by-value return value from a property, or a method of a `class` or `struct`.</span></span> <span data-ttu-id="58f41-129">Si infringe esta regla, se genera el error del compilador CS8156, "No se puede usar una expresión en este contexto porque no se puede devolver por referencia".</span><span class="sxs-lookup"><span data-stu-id="58f41-129">Violating this rule generates compiler error CS8156, "An expression cannot be used in this context because it may not be returned by reference."</span></span>

<span data-ttu-id="58f41-130">Además, los valores devueltos por referencia no se permiten en métodos asincrónicos.</span><span class="sxs-lookup"><span data-stu-id="58f41-130">In addition, reference return values are not allowed on async methods.</span></span> <span data-ttu-id="58f41-131">Un método asincrónico puede volver antes de que haya terminado de ejecutarse, mientras que su valor devuelto aún no se conoce.</span><span class="sxs-lookup"><span data-stu-id="58f41-131">An asynchronous method may return before it has finished execution, while its return value is still unknown.</span></span>

## <a name="defining-a-ref-return-value"></a><span data-ttu-id="58f41-132">Definir un valor devuelto de tipo ref</span><span class="sxs-lookup"><span data-stu-id="58f41-132">Defining a ref return value</span></span>

<span data-ttu-id="58f41-133">Un método que devuelve un *valor devuelto de referencia* debe cumplir las dos condiciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="58f41-133">A method that returns a *reference return value* must satisfy the following two conditions:</span></span>

- <span data-ttu-id="58f41-134">La firma del método incluye la palabra clave [ref](../../language-reference/keywords/ref.md) delante del tipo de valor devuelto.</span><span class="sxs-lookup"><span data-stu-id="58f41-134">The method signature includes the [ref](../../language-reference/keywords/ref.md) keyword in front of the return type.</span></span>
- <span data-ttu-id="58f41-135">Cada instrucción [return](../../language-reference/keywords/return.md) del cuerpo del método incluye la palabra clave [ref](../../language-reference/keywords/ref.md) delante del nombre de la instancia devuelta.</span><span class="sxs-lookup"><span data-stu-id="58f41-135">Each [return](../../language-reference/keywords/return.md) statement in the method body includes the [ref](../../language-reference/keywords/ref.md) keyword in front of the name of the returned instance.</span></span>

<span data-ttu-id="58f41-136">En el método siguiente se muestra un método que cumple estas condiciones y devuelve una referencia a un objeto `Person` denominado `p`:</span><span class="sxs-lookup"><span data-stu-id="58f41-136">The following example shows a method that satisfies those conditions and returns a reference to a `Person` object named `p`:</span></span>

```csharp
public ref Person GetContactInformation(string fname, string lname)
{
    // ...method implementation...
    return ref p;
}
```

## <a name="consuming-a-ref-return-value"></a><span data-ttu-id="58f41-137">Usar un valor devuelto de tipo ref</span><span class="sxs-lookup"><span data-stu-id="58f41-137">Consuming a ref return value</span></span>

<span data-ttu-id="58f41-138">El valor devuelto de tipo ref es un alias para otra variable en el ámbito del método llamado.</span><span class="sxs-lookup"><span data-stu-id="58f41-138">The ref return value is an alias to another variable in the called method's scope.</span></span> <span data-ttu-id="58f41-139">Puede interpretar cualquier uso del valor devuelto tipo ref como si se usara la variable a la que se asigna el alias:</span><span class="sxs-lookup"><span data-stu-id="58f41-139">You can interpret any use of the ref return as using the variable it aliases:</span></span>

- <span data-ttu-id="58f41-140">Al asignar su valor, se asigna un valor a la variable a la que se asigna el alias.</span><span class="sxs-lookup"><span data-stu-id="58f41-140">When you assign its value, you are assigning a value to the variable it aliases.</span></span>
- <span data-ttu-id="58f41-141">Al leer su valor, se lee un valor a la variable a la que se asigna el alias.</span><span class="sxs-lookup"><span data-stu-id="58f41-141">When you read its value, you are reading the value of the variable it aliases.</span></span>
- <span data-ttu-id="58f41-142">Si la devolución se realiza *por referencia*, entonces devuelve un alias a esa misma variable.</span><span class="sxs-lookup"><span data-stu-id="58f41-142">If you return it *by reference*, you are returning an alias to that same variable.</span></span>
- <span data-ttu-id="58f41-143">Si pasa el valor a otro método *por referencia*, pasará una referencia a la variable a la que se asigna el alias.</span><span class="sxs-lookup"><span data-stu-id="58f41-143">If you pass it to another method *by reference*, you are passing a reference to the variable it aliases.</span></span>
- <span data-ttu-id="58f41-144">Al asignar un alias [local tipo ref](#ref-locals), crea un alias para la misma variable.</span><span class="sxs-lookup"><span data-stu-id="58f41-144">When you make a [ref local](#ref-locals) alias, you make a new alias to the same variable.</span></span>

## <a name="ref-locals"></a><span data-ttu-id="58f41-145">Variables locales de tipo ref</span><span class="sxs-lookup"><span data-stu-id="58f41-145">Ref locals</span></span>

<span data-ttu-id="58f41-146">Suponga que el método `GetContactInformation` se declara como un valor devuelto tipo ref:</span><span class="sxs-lookup"><span data-stu-id="58f41-146">Assume the `GetContactInformation` method is declared as a ref return:</span></span>

```csharp
public ref Person GetContactInformation(string fname, string lname)
```

<span data-ttu-id="58f41-147">Una asignación por valor lee el valor de una variable y lo asigna a una nueva variable:</span><span class="sxs-lookup"><span data-stu-id="58f41-147">A by-value assignment reads the value of a variable and assigns it to a new variable:</span></span>

```csharp
Person p = contacts.GetContactInformation("Brandie", "Best");
```

<span data-ttu-id="58f41-148">La asignación anterior declara `p` como una variable local.</span><span class="sxs-lookup"><span data-stu-id="58f41-148">The preceding assignment declares `p` as a local variable.</span></span> <span data-ttu-id="58f41-149">Su valor inicial se copia a partir de la lectura del valor devuelto por `GetContactInformation`.</span><span class="sxs-lookup"><span data-stu-id="58f41-149">Its initial value is copied from reading the value returned by `GetContactInformation`.</span></span> <span data-ttu-id="58f41-150">Las asignaciones futuras a `p` no cambiarán el valor de la variable devuelta por `GetContactInformation`.</span><span class="sxs-lookup"><span data-stu-id="58f41-150">Any future assignments to `p` will not change the value of the variable returned by `GetContactInformation`.</span></span> <span data-ttu-id="58f41-151">La variable `p` ya no es un alias de la variable devuelta.</span><span class="sxs-lookup"><span data-stu-id="58f41-151">The variable `p` is no longer an alias to the variable returned.</span></span>

<span data-ttu-id="58f41-152">Se declara una variable *local tipo ref* para copiar el alias en el valor original.</span><span class="sxs-lookup"><span data-stu-id="58f41-152">You declare a *ref local* variable to copy the alias to the original value.</span></span> <span data-ttu-id="58f41-153">En la siguiente asignación, `p` es un alias para la variable devuelta desde `GetContactInformation`.</span><span class="sxs-lookup"><span data-stu-id="58f41-153">In the following assignment, `p` is an alias to the variable returned from `GetContactInformation`.</span></span>

```csharp
ref Person p = ref contacts.GetContactInformation("Brandie", "Best");
```

<span data-ttu-id="58f41-154">El uso posterior de `p` es lo mismo que usar la variable devuelta por `GetContactInformation`, porque `p` es un alias para dicha variable.</span><span class="sxs-lookup"><span data-stu-id="58f41-154">Subsequent usage of `p` is the same as using the variable returned by `GetContactInformation` because `p` is an alias for that variable.</span></span> <span data-ttu-id="58f41-155">Los cambios realizados en `p` también modifican la variable devuelta desde `GetContactInformation`.</span><span class="sxs-lookup"><span data-stu-id="58f41-155">Changes to `p` also change the variable returned from `GetContactInformation`.</span></span>

<span data-ttu-id="58f41-156">La palabra clave `ref` se usa antes de la declaración de variable local *y* antes de la llamada al método.</span><span class="sxs-lookup"><span data-stu-id="58f41-156">The `ref` keyword is used both before the local variable declaration *and* before the method call.</span></span>

<span data-ttu-id="58f41-157">Puede acceder a un valor por referencia de la misma manera.</span><span class="sxs-lookup"><span data-stu-id="58f41-157">You can access a value by reference in the same way.</span></span> <span data-ttu-id="58f41-158">En algunos casos, acceder a un valor por referencia aumenta el rendimiento, ya que evita una operación de copia potencialmente cara.</span><span class="sxs-lookup"><span data-stu-id="58f41-158">In some cases, accessing a value by reference increases performance by avoiding a potentially expensive copy operation.</span></span> <span data-ttu-id="58f41-159">Por ejemplo, en la instrucción siguiente se muestra cómo es posible definir un valor local de referencia que se usa para hacer referencia a un valor.</span><span class="sxs-lookup"><span data-stu-id="58f41-159">For example, the following statement shows how one can define a ref local value that is used to reference a value.</span></span>

```csharp
ref VeryLargeStruct reflocal = ref veryLargeStruct;
```

<span data-ttu-id="58f41-160">La palabra clave `ref` se usa antes de la declaración de variable local *y* antes del valor en el segundo ejemplo.</span><span class="sxs-lookup"><span data-stu-id="58f41-160">The `ref` keyword is used both before the local variable declaration *and* before the value in the second example.</span></span> <span data-ttu-id="58f41-161">Si no se incluyen ambas palabras clave `ref` en la asignación y declaración de variable en ambos ejemplos, se produce el error del compilador CS8172, "No se puede inicializar una variable por referencia con un valor".</span><span class="sxs-lookup"><span data-stu-id="58f41-161">Failure to include both `ref` keywords in the variable declaration and assignment in both examples results in compiler error CS8172, "Cannot initialize a by-reference variable with a value."</span></span>

<span data-ttu-id="58f41-162">Antes de C# 7.3, las variables locales de tipo ref no se podían reasignar para hacer referencia a otro almacenamiento después de haberse inicializado.</span><span class="sxs-lookup"><span data-stu-id="58f41-162">Prior to C# 7.3, ref local variables couldn't be reassigned to refer to different storage after being initialized.</span></span> <span data-ttu-id="58f41-163">Esta restricción se ha quitado.</span><span class="sxs-lookup"><span data-stu-id="58f41-163">That restriction has been removed.</span></span> <span data-ttu-id="58f41-164">En el ejemplo siguiente, se muestra una reasignación:</span><span class="sxs-lookup"><span data-stu-id="58f41-164">The following example shows a reassignment:</span></span>

```csharp
ref VeryLargeStruct reflocal = ref veryLargeStruct; // initialization
refLocal = ref anotherVeryLargeStruct; // reassigned, refLocal refers to different storage.
```

 <span data-ttu-id="58f41-165">Las variables locales de tipo ref todavía deben inicializarse cuando se declaran.</span><span class="sxs-lookup"><span data-stu-id="58f41-165">Ref local variables must still be initialized when they are declared.</span></span>

## <a name="ref-returns-and-ref-locals-an-example"></a><span data-ttu-id="58f41-166">Valores devueltos y variables locales de tipo ref: un ejemplo</span><span class="sxs-lookup"><span data-stu-id="58f41-166">Ref returns and ref locals: an example</span></span>

<span data-ttu-id="58f41-167">En el ejemplo siguiente, se define una clase `NumberStore` que almacena una matriz de valores enteros.</span><span class="sxs-lookup"><span data-stu-id="58f41-167">The following example defines a `NumberStore` class that stores an array of integer values.</span></span> <span data-ttu-id="58f41-168">El método `FindNumber` devuelve por referencia el primer número que es mayor o igual que el número que se pasa como argumento.</span><span class="sxs-lookup"><span data-stu-id="58f41-168">The `FindNumber` method returns by reference the first number that is greater than or equal to the number passed as an argument.</span></span> <span data-ttu-id="58f41-169">Si ningún número es mayor o igual que el argumento, el método devuelve el número en el índice 0.</span><span class="sxs-lookup"><span data-stu-id="58f41-169">If no number is greater than or equal to the argument, the method returns the number in index 0.</span></span>

[!code-csharp[ref-returns](../../../../samples/snippets/csharp/programming-guide/ref-returns/NumberStore.cs#1)]

<span data-ttu-id="58f41-170">En el ejemplo siguiente, se llama al método `NumberStore.FindNumber` para recuperar el primer valor que es mayor o igual que 16.</span><span class="sxs-lookup"><span data-stu-id="58f41-170">The following example calls the `NumberStore.FindNumber` method to retrieve the first value that is greater than or equal to 16.</span></span> <span data-ttu-id="58f41-171">Después, el autor de la llamada duplica el valor devuelto por el método.</span><span class="sxs-lookup"><span data-stu-id="58f41-171">The caller then doubles the value returned by the method.</span></span> <span data-ttu-id="58f41-172">En el resultado del ejemplo se muestra el cambio reflejado en el valor de los elementos de matriz de la instancia `NumberStore`.</span><span class="sxs-lookup"><span data-stu-id="58f41-172">The output from the example shows the change reflected in the value of the array elements of the `NumberStore` instance.</span></span>

[!code-csharp[ref-returns](../../../../samples/snippets/csharp/programming-guide/ref-returns/NumberStore.cs#2)]

<span data-ttu-id="58f41-173">Sin que se admitan los valores devueltos de referencia, este tipo de operación se realiza al devolver el índice del elemento de matriz junto con su valor.</span><span class="sxs-lookup"><span data-stu-id="58f41-173">Without support for reference return values, such an operation is performed by returning the index of the array element along with its value.</span></span> <span data-ttu-id="58f41-174">Después, el autor de la llamada puede usar este índice para modificar el valor en una llamada al método independiente.</span><span class="sxs-lookup"><span data-stu-id="58f41-174">The caller can then use this index to modify the value in a separate method call.</span></span> <span data-ttu-id="58f41-175">En cambio, el autor de la llamada también puede modificar el índice para tener acceso a otros valores de matriz y, posiblemente, modificarlos.</span><span class="sxs-lookup"><span data-stu-id="58f41-175">However, the caller can also modify the index to access and possibly modify other array values.</span></span>  

<span data-ttu-id="58f41-176">En el siguiente ejemplo, se muestra cómo el método `FindNumber` podría modificarse después de C# 7.3 para usar la reasignación local de tipo ref:</span><span class="sxs-lookup"><span data-stu-id="58f41-176">The following example shows how the `FindNumber` method could be rewritten after C# 7.3 to use ref local reassignment:</span></span>

[!code-csharp[ref-returns](../../../../samples/snippets/csharp/programming-guide/ref-returns/NumberStoreUpdated.cs#1)]

<span data-ttu-id="58f41-177">Esta segunda versión es más eficaz con secuencias mayores en escenarios donde el número que se busca está más cerca del final de la matriz.</span><span class="sxs-lookup"><span data-stu-id="58f41-177">This second version is more efficient with longer sequences in scenarios where the number sought is closer to the end of the array.</span></span>

## <a name="see-also"></a><span data-ttu-id="58f41-178">Vea también</span><span class="sxs-lookup"><span data-stu-id="58f41-178">See also</span></span>

- [<span data-ttu-id="58f41-179">ref (palabra clave)</span><span class="sxs-lookup"><span data-stu-id="58f41-179">ref keyword</span></span>](../../language-reference/keywords/ref.md)
- [<span data-ttu-id="58f41-180">Escritura de código seguro y eficaz</span><span class="sxs-lookup"><span data-stu-id="58f41-180">Write safe efficient code</span></span>](../../write-safe-efficient-code.md)
