---
title: Tipos de valor devueltos asincrónicos (C#)
ms.date: 05/29/2017
ms.assetid: ddb2539c-c898-48c1-ad92-245e4a996df8
ms.openlocfilehash: 9926fea5308f9088ad924bcc98d8deed319c6300
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 03/14/2020
ms.locfileid: "79170044"
---
# <a name="async-return-types-c"></a><span data-ttu-id="891f7-102">Tipos de valor devueltos asincrónicos (C#)</span><span class="sxs-lookup"><span data-stu-id="891f7-102">Async Return Types (C#)</span></span>
<span data-ttu-id="891f7-103">Los métodos asincrónicos pueden tener los siguientes tipos de valor devuelto:</span><span class="sxs-lookup"><span data-stu-id="891f7-103">Async methods can have the following return types:</span></span>

- <span data-ttu-id="891f7-104"><xref:System.Threading.Tasks.Task%601>, para un método asincrónico que devuelve un valor.</span><span class="sxs-lookup"><span data-stu-id="891f7-104"><xref:System.Threading.Tasks.Task%601>, for an async method that returns a value.</span></span>

- <span data-ttu-id="891f7-105"><xref:System.Threading.Tasks.Task>, para un método asincrónico que realiza una operación pero no devuelve ningún valor.</span><span class="sxs-lookup"><span data-stu-id="891f7-105"><xref:System.Threading.Tasks.Task>, for an async method that performs an operation but returns no value.</span></span>

- <span data-ttu-id="891f7-106">`void`, para un controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="891f7-106">`void`, for an event handler.</span></span>

- <span data-ttu-id="891f7-107">A partir de C# 7.0, cualquier tipo que tenga un método `GetAwaiter` accesible.</span><span class="sxs-lookup"><span data-stu-id="891f7-107">Starting with C# 7.0, any type that has an accessible `GetAwaiter` method.</span></span> <span data-ttu-id="891f7-108">El objeto devuelto por el método `GetAwaiter` debe implementar la interfaz <xref:System.Runtime.CompilerServices.ICriticalNotifyCompletion?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="891f7-108">The object returned by the `GetAwaiter` method must implement the <xref:System.Runtime.CompilerServices.ICriticalNotifyCompletion?displayProperty=nameWithType> interface.</span></span>
  
<span data-ttu-id="891f7-109">Para más información sobre los métodos async, vea [Programación asincrónica con async y await 8C#)](./index.md).</span><span class="sxs-lookup"><span data-stu-id="891f7-109">For more information about async methods, see [Asynchronous Programming with async and await (C#)](./index.md).</span></span>  
  
<span data-ttu-id="891f7-110">Cada tipo de valor devuelto se examina en una de las siguientes secciones, y puede encontrar un ejemplo completo que usa los tres tipos al final del tema.</span><span class="sxs-lookup"><span data-stu-id="891f7-110">Each return type is examined in one of the following sections, and you can find a full example that uses all three types at the end of the topic.</span></span>  
  
## <span data-ttu-id="891f7-111">Tipo de valor devuelto<a name="BKMK_TaskTReturnType"></a> Task\<TResult\></span><span class="sxs-lookup"><span data-stu-id="891f7-111"><a name="BKMK_TaskTReturnType"></a> Task\<TResult\> Return Type</span></span>  
<span data-ttu-id="891f7-112">El tipo de valor devuelto <xref:System.Threading.Tasks.Task%601> se usa para un método asincrónico que contiene una instrucción [return](../../../language-reference/keywords/return.md) (C#) en la que el operando tiene el tipo `TResult`.</span><span class="sxs-lookup"><span data-stu-id="891f7-112">The <xref:System.Threading.Tasks.Task%601> return type is used for an async method that contains a [return](../../../language-reference/keywords/return.md) (C#) statement in which the operand has type `TResult`.</span></span>  
  
<span data-ttu-id="891f7-113">En el ejemplo siguiente, el método asincrónico `GetLeisureHours` contiene una instrucción `return` que devuelve un entero.</span><span class="sxs-lookup"><span data-stu-id="891f7-113">In the following example, the `GetLeisureHours` async method contains a `return` statement that returns an integer.</span></span> <span data-ttu-id="891f7-114">Por tanto, la declaración del método debe tener un tipo de valor devuelto de `Task<int>`.</span><span class="sxs-lookup"><span data-stu-id="891f7-114">Therefore, the method declaration must specify a return type of `Task<int>`.</span></span>  <span data-ttu-id="891f7-115">El método asincrónico <xref:System.Threading.Tasks.Task.FromResult%2A> es un marcador de posición para una operación que devuelve una cadena.</span><span class="sxs-lookup"><span data-stu-id="891f7-115">The <xref:System.Threading.Tasks.Task.FromResult%2A> async method is a placeholder for an operation that returns a string.</span></span>
  
[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns1.cs)]

<span data-ttu-id="891f7-116">Cuando se llama a `GetLeisureHours` desde una expresión await en el método `ShowTodaysInfo`, esta recupera el valor entero (el valor de `leisureHours`) que está almacenado en la tarea que devuelve el método `GetLeisureHours`.</span><span class="sxs-lookup"><span data-stu-id="891f7-116">When `GetLeisureHours` is called from within an await expression in the `ShowTodaysInfo` method, the await expression retrieves the integer value (the value of `leisureHours`) that's stored in the task returned by the `GetLeisureHours` method.</span></span> <span data-ttu-id="891f7-117">Para más información sobre las expresiones await, vea [await](../../../language-reference/operators/await.md).</span><span class="sxs-lookup"><span data-stu-id="891f7-117">For more information about await expressions, see [await](../../../language-reference/operators/await.md).</span></span>  
  
<span data-ttu-id="891f7-118">Comprenderá mejor cómo sucede esto separando la llamada a `GetLeisureHours` de la aplicación de `await`, como se muestra en el código siguiente.</span><span class="sxs-lookup"><span data-stu-id="891f7-118">You can better understand how this happens by separating the call to `GetLeisureHours` from the application of `await`, as the following code shows.</span></span> <span data-ttu-id="891f7-119">Una llamada al método `GetLeisureHours` que no se espera inmediatamente devuelve `Task<int>`, como se podría esperar de la declaración del método.</span><span class="sxs-lookup"><span data-stu-id="891f7-119">A call to method `GetLeisureHours` that isn't immediately awaited returns a `Task<int>`, as you would expect from the declaration of the method.</span></span> <span data-ttu-id="891f7-120">La tarea se asigna a la variable `integerTask` en el ejemplo.</span><span class="sxs-lookup"><span data-stu-id="891f7-120">The task is assigned to the `integerTask` variable in the example.</span></span> <span data-ttu-id="891f7-121">Dado que `integerTask` es <xref:System.Threading.Tasks.Task%601>, contiene una propiedad <xref:System.Threading.Tasks.Task%601.Result> de tipo `TResult`.</span><span class="sxs-lookup"><span data-stu-id="891f7-121">Because `integerTask` is a <xref:System.Threading.Tasks.Task%601>, it contains a <xref:System.Threading.Tasks.Task%601.Result> property of type `TResult`.</span></span> <span data-ttu-id="891f7-122">En este caso, `TResult` representa un tipo entero.</span><span class="sxs-lookup"><span data-stu-id="891f7-122">In this case, `TResult` represents an integer type.</span></span> <span data-ttu-id="891f7-123">Cuando `await` se aplica a `integerTask`, la expresión await se evalúa en el contenido de la propiedad <xref:System.Threading.Tasks.Task%601.Result%2A> de `integerTask`.</span><span class="sxs-lookup"><span data-stu-id="891f7-123">When `await` is applied to `integerTask`, the await expression evaluates to the contents of the <xref:System.Threading.Tasks.Task%601.Result%2A> property of `integerTask`.</span></span> <span data-ttu-id="891f7-124">El valor se asigna a la variable `ret`.</span><span class="sxs-lookup"><span data-stu-id="891f7-124">The value is assigned to the `ret` variable.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="891f7-125">La propiedad <xref:System.Threading.Tasks.Task%601.Result%2A> es una propiedad de bloqueo.</span><span class="sxs-lookup"><span data-stu-id="891f7-125">The <xref:System.Threading.Tasks.Task%601.Result%2A> property is a blocking property.</span></span> <span data-ttu-id="891f7-126">Si se intenta acceder a ella antes de que termine su tarea, se bloquea el subproceso que está activo actualmente hasta que finaliza la tarea y el valor está disponible.</span><span class="sxs-lookup"><span data-stu-id="891f7-126">If you try to access it before its task is finished, the thread that's currently active is blocked until the task completes and the value is available.</span></span> <span data-ttu-id="891f7-127">En la mayoría de los casos, se debe tener acceso al valor usando `await` en lugar de tener acceso directamente a la propiedad.</span><span class="sxs-lookup"><span data-stu-id="891f7-127">In most cases, you should access the value by using `await` instead of accessing the property directly.</span></span> <br/> <span data-ttu-id="891f7-128">En el ejemplo anterior se ha recuperado el valor de la propiedad <xref:System.Threading.Tasks.Task%601.Result%2A> para bloquear el subproceso principal de manera que el método `ShowTodaysInfo` pueda terminar la ejecución antes de que finalice la aplicación.</span><span class="sxs-lookup"><span data-stu-id="891f7-128">The previous example retrieved the value of the <xref:System.Threading.Tasks.Task%601.Result%2A> property to block the main thread so that the `ShowTodaysInfo` method could finish execution before the application ended.</span></span>  

[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns1a.cs#1)]
  
## <a name="BKMK_TaskReturnType"></a> <span data-ttu-id="891f7-129">Tipo de valor devuelto Task</span><span class="sxs-lookup"><span data-stu-id="891f7-129">Task Return Type</span></span>  
<span data-ttu-id="891f7-130">Los métodos asincrónicos que no contienen una instrucción `return` o que contienen una instrucción `return` que no devuelve un operando tienen normalmente un tipo de valor devuelto de <xref:System.Threading.Tasks.Task>.</span><span class="sxs-lookup"><span data-stu-id="891f7-130">Async methods that don't contain a `return` statement or that contain a `return` statement that doesn't return an operand usually have a return type of <xref:System.Threading.Tasks.Task>.</span></span> <span data-ttu-id="891f7-131">Dichos métodos devuelven `void` si se ejecutan de manera sincrónica.</span><span class="sxs-lookup"><span data-stu-id="891f7-131">Such methods return `void` if they run synchronously.</span></span> <span data-ttu-id="891f7-132">Si se usa un tipo de valor devuelto <xref:System.Threading.Tasks.Task> para un método asincrónico, un método de llamada puede usar un operador `await` para suspender la finalización del llamador hasta que finalice el método asincrónico llamado.</span><span class="sxs-lookup"><span data-stu-id="891f7-132">If you use a <xref:System.Threading.Tasks.Task> return type for an async method, a calling method can use an `await` operator to suspend the caller's completion until the called async method has finished.</span></span>  
  
<span data-ttu-id="891f7-133">En el ejemplo siguiente, el método asincrónico `WaitAndApologize` no contiene una instrucción `return`, de manera que el método devuelve un objeto <xref:System.Threading.Tasks.Task>.</span><span class="sxs-lookup"><span data-stu-id="891f7-133">In the following example, the `WaitAndApologize` async method doesn't contain a `return` statement, so the method returns a <xref:System.Threading.Tasks.Task> object.</span></span> <span data-ttu-id="891f7-134">Esto permite que se espere a `WaitAndApologize`.</span><span class="sxs-lookup"><span data-stu-id="891f7-134">This enables `WaitAndApologize` to be awaited.</span></span> <span data-ttu-id="891f7-135">Tenga en cuenta que el tipo <xref:System.Threading.Tasks.Task> no incluye una propiedad `Result` porque no tiene ningún valor devuelto.</span><span class="sxs-lookup"><span data-stu-id="891f7-135">Note that the <xref:System.Threading.Tasks.Task> type doesn't include a `Result` property because it has no return value.</span></span>  

[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns2.cs)]  
  
<span data-ttu-id="891f7-136">Se espera a `WaitAndApologize` mediante una instrucción await en lugar de una expresión await, similar a la instrucción de llamada para un método sincrónico que devuelve void.</span><span class="sxs-lookup"><span data-stu-id="891f7-136">`WaitAndApologize` is awaited by using an await statement instead of an await expression, similar to the calling statement for a synchronous void-returning method.</span></span> <span data-ttu-id="891f7-137">En este caso, la aplicación de un operador await no genera un valor.</span><span class="sxs-lookup"><span data-stu-id="891f7-137">The application of an await operator in this case doesn't produce a value.</span></span>  
  
<span data-ttu-id="891f7-138">Igual que en el ejemplo <xref:System.Threading.Tasks.Task%601> anterior, puede separar la llamada a `WaitAndApologize` desde la aplicación de un operador await, como muestra el código siguiente.</span><span class="sxs-lookup"><span data-stu-id="891f7-138">As in the previous <xref:System.Threading.Tasks.Task%601> example, you can separate the call to `WaitAndApologize` from the application of an await operator, as the following code shows.</span></span> <span data-ttu-id="891f7-139">Pero recuerde que una `Task` no tiene una propiedad `Result` y que no se genera ningún valor cuando se aplica un operador await a una `Task`.</span><span class="sxs-lookup"><span data-stu-id="891f7-139">However, remember that a `Task` doesn't have a `Result` property, and that no value is produced when an await operator is applied to a `Task`.</span></span>  
  
<span data-ttu-id="891f7-140">El código siguiente separa la llamada del método `WaitAndApologize` de la espera de la tarea que el método devuelve.</span><span class="sxs-lookup"><span data-stu-id="891f7-140">The following code separates calling the `WaitAndApologize` method from awaiting the task that the method returns.</span></span>  

[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns2a.cs#1)]  

## <a name="BKMK_VoidReturnType"></a> <span data-ttu-id="891f7-141">Tipo de valor devuelto Void</span><span class="sxs-lookup"><span data-stu-id="891f7-141">Void return type</span></span>

<span data-ttu-id="891f7-142">Usa el tipo de valor devuelto `void` en controladores de eventos asincrónicos, que necesitan un tipo de valor devuelto `void`.</span><span class="sxs-lookup"><span data-stu-id="891f7-142">You use the `void` return type in asynchronous event handlers, which require a `void` return type.</span></span> <span data-ttu-id="891f7-143">Para métodos que no sean controladores de eventos que no devuelven un valor, debe devolver <xref:System.Threading.Tasks.Task> en su lugar, porque no se espera a un método asincrónico que devuelva `void`.</span><span class="sxs-lookup"><span data-stu-id="891f7-143">For methods other than event handlers that don't return a value, you should return a <xref:System.Threading.Tasks.Task> instead, because an async method that returns `void` can't be awaited.</span></span> <span data-ttu-id="891f7-144">Cualquier llamador de este método debe poder continuar hasta completarse sin esperar a que finalice el método asincrónico llamado y el llamador debe ser independiente de los valores o las excepciones que genera el método asincrónico.</span><span class="sxs-lookup"><span data-stu-id="891f7-144">Any caller of such a method must be able to continue to completion without waiting for the called async method to finish, and the caller must be independent of any values or exceptions that the async method generates.</span></span>  
  
<span data-ttu-id="891f7-145">El llamador de un método asincrónico que devuelve void no puede capturar las excepciones emitidas desde el método y dichas excepciones no controladas pueden provocar un error de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="891f7-145">The caller of a void-returning async method can't catch exceptions that are thrown from the method, and such unhandled exceptions are likely to cause your application to fail.</span></span> <span data-ttu-id="891f7-146">Si se produce una excepción en un método asincrónico que devuelve <xref:System.Threading.Tasks.Task> o <xref:System.Threading.Tasks.Task%601>, la excepción se almacena en la tarea devuelta y se vuelve a emitir cuando se espera la tarea.</span><span class="sxs-lookup"><span data-stu-id="891f7-146">If an exception occurs in an async method that returns a <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601>, the exception is stored in the returned task and is rethrown when the task is awaited.</span></span> <span data-ttu-id="891f7-147">Por tanto, asegúrese de que cualquier método asincrónico que puede producir una excepción tiene un tipo de valor devuelto de <xref:System.Threading.Tasks.Task> o <xref:System.Threading.Tasks.Task%601> y que se esperan llamadas al método.</span><span class="sxs-lookup"><span data-stu-id="891f7-147">Therefore, make sure that any async method that can produce an exception has a return type of <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> and that calls to the method are awaited.</span></span>  
  
<span data-ttu-id="891f7-148">Para obtener más información sobre cómo capturar excepciones en métodos asincrónicos, vea la sección [Excepciones en métodos asincrónicos](../../../language-reference/keywords/try-catch.md#exceptions-in-async-methods) del tema [try-catch](../../../language-reference/keywords/try-catch.md).</span><span class="sxs-lookup"><span data-stu-id="891f7-148">For more information about how to catch exceptions in async methods, see the [Exceptions in Async Methods](../../../language-reference/keywords/try-catch.md#exceptions-in-async-methods) section of the [try-catch](../../../language-reference/keywords/try-catch.md) topic.</span></span>  
  
<span data-ttu-id="891f7-149">En el ejemplo siguiente se muestra el comportamiento de un controlador de eventos asincrónicos.</span><span class="sxs-lookup"><span data-stu-id="891f7-149">The following example shows the behavior of an async event handler.</span></span> <span data-ttu-id="891f7-150">Tenga en cuenta que en el código de ejemplo, un controlador de eventos asincrónicos debe informar de que ha terminado al subproceso principal.</span><span class="sxs-lookup"><span data-stu-id="891f7-150">Note that in the example code, an async event handler must let the main thread know when it finishes.</span></span> <span data-ttu-id="891f7-151">Después, el subproceso principal puede esperar a que un controlador de eventos asincrónicos finalice antes de salir del programa.</span><span class="sxs-lookup"><span data-stu-id="891f7-151">Then the main thread can wait for an async event handler to complete before exiting the program.</span></span>

[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns3.cs)]  

## <a name="generalized-async-return-types-and-valuetasktresult"></a><span data-ttu-id="891f7-152">Tipos de valor devueltos asincrónicos generalizados y ValueTask\<TResult\></span><span class="sxs-lookup"><span data-stu-id="891f7-152">Generalized async return types and ValueTask\<TResult\></span></span>

<span data-ttu-id="891f7-153">A partir de C# 7.0, un método asincrónico puede devolver cualquier tipo que tenga un método `GetAwaiter` accesible.</span><span class="sxs-lookup"><span data-stu-id="891f7-153">Starting with C# 7.0, an async method can return any type that has an accessible `GetAwaiter` method.</span></span>

<span data-ttu-id="891f7-154">Como <xref:System.Threading.Tasks.Task> y <xref:System.Threading.Tasks.Task%601> son tipos de referencia, la asignación de memoria en las rutas críticas para el rendimiento, especialmente cuando las asignaciones se producen en ajustados bucles, puede afectar negativamente al rendimiento.</span><span class="sxs-lookup"><span data-stu-id="891f7-154">Because <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> are reference types, memory allocation in performance-critical paths, particularly when allocations occur in tight loops, can adversely affect performance.</span></span> <span data-ttu-id="891f7-155">La compatibilidad para los tipos de valor devuelto generalizados significa que puede devolver un tipo de valor ligero en lugar de un tipo de referencia para evitar asignaciones de memoria adicionales.</span><span class="sxs-lookup"><span data-stu-id="891f7-155">Support for generalized return types means that you can return a lightweight value type instead of a reference type to avoid additional memory allocations.</span></span>

<span data-ttu-id="891f7-156">.NET proporciona la estructura <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType> como una implementación ligera de un valor de devolución de tareas generalizado.</span><span class="sxs-lookup"><span data-stu-id="891f7-156">.NET provides the <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType> structure as a lightweight implementation of a generalized task-returning value.</span></span> <span data-ttu-id="891f7-157">Para usar el tipo <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType>, debe agregar el paquete NuGet de `System.Threading.Tasks.Extensions` a su proyecto.</span><span class="sxs-lookup"><span data-stu-id="891f7-157">To use the <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType> type, you must add the `System.Threading.Tasks.Extensions` NuGet package to your project.</span></span> <span data-ttu-id="891f7-158">En el ejemplo siguiente se usa la estructura <xref:System.Threading.Tasks.ValueTask%601> para recuperar el valor de dos tiradas de dado.</span><span class="sxs-lookup"><span data-stu-id="891f7-158">The following example uses the <xref:System.Threading.Tasks.ValueTask%601> structure to retrieve the value of two dice rolls.</span></span>
  
[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-valuetask.cs)]

## <a name="see-also"></a><span data-ttu-id="891f7-159">Vea también</span><span class="sxs-lookup"><span data-stu-id="891f7-159">See also</span></span>

- <xref:System.Threading.Tasks.Task.FromResult%2A>
- <span data-ttu-id="891f7-160">[Walkthrough: Accessing the Web by Using async and await (C#)](./walkthrough-accessing-the-web-by-using-async-and-await.md) (Tutorial: Acceso a web usando Async y Await [C#])</span><span class="sxs-lookup"><span data-stu-id="891f7-160">[Walkthrough: Accessing the Web by Using async and await (C#)](./walkthrough-accessing-the-web-by-using-async-and-await.md)</span></span>
- <span data-ttu-id="891f7-161">[Control Flow in Async Programs (C#)](./control-flow-in-async-programs.md) (Flujo de control en programas asincrónicos [C#])</span><span class="sxs-lookup"><span data-stu-id="891f7-161">[Control Flow in Async Programs (C#)](./control-flow-in-async-programs.md)</span></span>
- [<span data-ttu-id="891f7-162">async</span><span class="sxs-lookup"><span data-stu-id="891f7-162">async</span></span>](../../../language-reference/keywords/async.md)
- [<span data-ttu-id="891f7-163">await</span><span class="sxs-lookup"><span data-stu-id="891f7-163">await</span></span>](../../../language-reference/operators/await.md)
