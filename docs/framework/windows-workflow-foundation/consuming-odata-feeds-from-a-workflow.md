---
title: 'Consumir fuentes de OData desde un flujo de trabajo: WF'
ms.date: 03/30/2017
ms.assetid: 1b26617c-53e9-476a-81af-675c36d95919
ms.openlocfilehash: ceac2c2d07351fcb79e2345068f07fa22f356411
ms.sourcegitcommit: de17a7a0a37042f0d4406f5ae5393531caeb25ba
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/24/2020
ms.locfileid: "76743795"
---
# <a name="consuming-odata-feeds-from-a-workflow"></a><span data-ttu-id="84f36-102">Consumir fuentes de OData desde un flujo de trabajo</span><span class="sxs-lookup"><span data-stu-id="84f36-102">Consuming OData feeds from a workflow</span></span>

<span data-ttu-id="84f36-103">WCF Data Services es un componente del .NET Framework que le permite crear servicios que usan el Open Data Protocol (OData) para exponer y consumir datos en Internet o en una intranet mediante la semántica de transferencia de estado representacional (REST).</span><span class="sxs-lookup"><span data-stu-id="84f36-103">WCF Data Services is a component of the .NET Framework that enables you to create services that use the Open Data Protocol (OData) to expose and consume data over the Web or intranet by using the semantics of representational state transfer (REST).</span></span> <span data-ttu-id="84f36-104">OData expone los datos como recursos direccionables a través de identificadores uniformes de recursos (URI).</span><span class="sxs-lookup"><span data-stu-id="84f36-104">OData exposes data as resources that are addressable by URIs.</span></span> <span data-ttu-id="84f36-105">Cualquier aplicación puede interactuar con un servicio de datos basado en OData si puede enviar una solicitud HTTP y procesar la fuente de OData que devuelve un servicio de datos.</span><span class="sxs-lookup"><span data-stu-id="84f36-105">Any application can interact with an OData-based data service if it can send an HTTP request and process the OData feed that a data service returns.</span></span> <span data-ttu-id="84f36-106">Además, WCF Data Services incluye bibliotecas de cliente que proporcionan una experiencia de programación más enriquecida cuando se usan fuentes de OData de .NET Framework aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="84f36-106">In addition, WCF Data Services includes client libraries that provide a richer programming experience when you consume OData feeds from .NET Framework applications.</span></span> <span data-ttu-id="84f36-107">En este tema se proporciona una información general del uso de una fuente de OData en un flujo de trabajo con y sin utilizar las bibliotecas de clientes.</span><span class="sxs-lookup"><span data-stu-id="84f36-107">This topic provides an overview of consuming an OData feed in a workflow with and without using the client libraries.</span></span>

## <a name="using-the-sample-northwind-odata-service"></a><span data-ttu-id="84f36-108">Usar el servicio OData de ejemplo Northwind</span><span class="sxs-lookup"><span data-stu-id="84f36-108">Using the sample Northwind OData service</span></span>

<span data-ttu-id="84f36-109">En los ejemplos de este tema se usa el servicio de datos Northwind de ejemplo ubicado en <https://services.odata.org/Northwind/Northwind.svc/>.</span><span class="sxs-lookup"><span data-stu-id="84f36-109">The examples in this topic use the sample Northwind data service located at <https://services.odata.org/Northwind/Northwind.svc/>.</span></span> <span data-ttu-id="84f36-110">Este servicio se proporciona como parte del [SDK de OData](https://www.odata.org/ecosystem/#sdk) y proporciona acceso de solo lectura a la base de datos Northwind de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="84f36-110">This service is provided as part of the [OData SDK](https://www.odata.org/ecosystem/#sdk) and provides read-only access to the sample Northwind database.</span></span> <span data-ttu-id="84f36-111">Si se quiere acceso de escritura, o un Servicio de datos de WCF local, puede seguir los pasos del [Tutorial rápido (WCF Data Services)](../data/wcf/quickstart-wcf-data-services.md) para crear un servicio OData local que proporcione acceso a la base de datos Northwind.</span><span class="sxs-lookup"><span data-stu-id="84f36-111">If write access is desired, or if a local WCF Data Service is desired, you can follow the steps of the [WCF Data Services Quickstart](../data/wcf/quickstart-wcf-data-services.md) to create a local OData service that provides access to the Northwind database.</span></span> <span data-ttu-id="84f36-112">Si sigue el tutorial rápido, sustituya el URI local por el que se proporciona en el código de ejemplo de este tema.</span><span class="sxs-lookup"><span data-stu-id="84f36-112">If you follow the quickstart, substitute the local URI for the one provided in the example code in this topic.</span></span>

## <a name="consuming-an-odata-feed-using-the-client-libraries"></a><span data-ttu-id="84f36-113">Consumir una fuente de OData mediante las bibliotecas de cliente</span><span class="sxs-lookup"><span data-stu-id="84f36-113">Consuming an OData feed using the client libraries</span></span>

<span data-ttu-id="84f36-114">WCF Data Services incluye bibliotecas de cliente que le permiten consumir más fácilmente una fuente de OData desde .NET Framework y aplicaciones cliente.</span><span class="sxs-lookup"><span data-stu-id="84f36-114">WCF Data Services includes client libraries that enable you to more easily consume an OData feed from .NET Framework and client applications.</span></span> <span data-ttu-id="84f36-115">Estas bibliotecas simplifican el envío y recepción de los mensajes HTTP.</span><span class="sxs-lookup"><span data-stu-id="84f36-115">These libraries simplify sending and receiving HTTP messages.</span></span> <span data-ttu-id="84f36-116">También traducen la carga del mensaje en objetos CLR que representan los datos de entidad.</span><span class="sxs-lookup"><span data-stu-id="84f36-116">They also translate the message payload into CLR objects that represent entity data.</span></span> <span data-ttu-id="84f36-117">Las bibliotecas cliente representan las dos clases principales <xref:System.Data.Services.Client.DataServiceContext> y <xref:System.Data.Services.Client.DataServiceQuery%601>.</span><span class="sxs-lookup"><span data-stu-id="84f36-117">The client libraries feature the two core classes <xref:System.Data.Services.Client.DataServiceContext> and <xref:System.Data.Services.Client.DataServiceQuery%601>.</span></span> <span data-ttu-id="84f36-118">Estas clases le permiten consultar un servicio de datos y, a continuación, trabajar con los datos de entidad devueltos como objetos CLR.</span><span class="sxs-lookup"><span data-stu-id="84f36-118">These classes enable you to query a data service and then work with the returned entity data as CLR objects.</span></span> <span data-ttu-id="84f36-119">En esta sección se incluyen dos enfoques para crear actividades que utilizan bibliotecas de clientes.</span><span class="sxs-lookup"><span data-stu-id="84f36-119">This section covers two approaches to creating activities that use the client libraries.</span></span>

### <a name="adding-a-service-reference-to-the-wcf-data-service"></a><span data-ttu-id="84f36-120">Agregar una referencia de servicio al servicio de datos de WCF</span><span class="sxs-lookup"><span data-stu-id="84f36-120">Adding a service reference to the WCF Data service</span></span>

<span data-ttu-id="84f36-121">Para generar las bibliotecas de cliente de Northwind, puede utilizar el cuadro de diálogo **Agregar referencia de servicio** de Visual Studio 2012 para agregar una referencia al servicio Northwind OData.</span><span class="sxs-lookup"><span data-stu-id="84f36-121">To generate the Northwind client libraries, you can use the **Add Service Reference** dialog box in Visual Studio 2012 to add a reference to the Northwind OData service.</span></span>

![Captura de pantalla que muestra el cuadro de diálogo Agregar referencia de servicio.](./media/consuming-odata-feeds-from-a-workflow/add-service-reference-dialog.gif)

<span data-ttu-id="84f36-123">Observe que no hay ninguna operación del servicio expuesta por el servicio y que en la lista **Servicios** hay elementos que representan las entidades expuestas por el servicio de datos Northwind.</span><span class="sxs-lookup"><span data-stu-id="84f36-123">Note that there are no service operations exposed by the service, and in the **Services** list there are items representing the entities exposed by the Northwind data service.</span></span> <span data-ttu-id="84f36-124">Cuando se agregue la referencia de servicio, se generarán las clases para estas entidades y se podrán utilizar en el código del cliente.</span><span class="sxs-lookup"><span data-stu-id="84f36-124">When the service reference is added, classes will be generated for these entities and they can be used in the client code.</span></span> <span data-ttu-id="84f36-125">Los ejemplos de este tema usan estas clases y la clase `NorthwindEntities` para realizar las consultas.</span><span class="sxs-lookup"><span data-stu-id="84f36-125">The examples in this topic use these classes and the `NorthwindEntities` class to perform the queries.</span></span>

> [!NOTE]
> <span data-ttu-id="84f36-126">Para obtener más información, vea [generar la biblioteca de cliente del servicio de datos (WCF Data Services)](../data/wcf/generating-the-data-service-client-library-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="84f36-126">For more information, see [Generating the Data Service Client Library (WCF Data Services)](../data/wcf/generating-the-data-service-client-library-wcf-data-services.md).</span></span>

### <a name="using-asynchronous-methods"></a><span data-ttu-id="84f36-127">Usar métodos asincrónicos</span><span class="sxs-lookup"><span data-stu-id="84f36-127">Using asynchronous methods</span></span>

<span data-ttu-id="84f36-128">Para resolver los posibles problemas de latencia que se pueden producir al tener acceso a los recursos en Web, recomendamos el acceso asincrónico a Servicios de datos de WCF.</span><span class="sxs-lookup"><span data-stu-id="84f36-128">To address possible latency issues that may occur when accessing resources over the Web, we recommend accessing WCF Data Services asynchronously.</span></span> <span data-ttu-id="84f36-129">Las bibliotecas de cliente de WCF Data Services incluyen métodos asincrónicos para invocar consultas y Windows Workflow Foundation (WF) proporciona la clase <xref:System.Activities.AsyncCodeActivity> para crear actividades asincrónicas.</span><span class="sxs-lookup"><span data-stu-id="84f36-129">The WCF Data Services client libraries include asynchronous methods for invoking queries, and Windows Workflow Foundation (WF) provides the <xref:System.Activities.AsyncCodeActivity> class for authoring asynchronous activities.</span></span> <span data-ttu-id="84f36-130"><xref:System.Activities.AsyncCodeActivity> se pueden escribir actividades derivadas para aprovechar las clases de .NET Framework que tienen métodos asincrónicos, o el código que se ejecuta de forma asincrónica se puede colocar en un método e invocar mediante un delegado.</span><span class="sxs-lookup"><span data-stu-id="84f36-130"><xref:System.Activities.AsyncCodeActivity> derived activities can be written to take advantage of .NET Framework classes that have asynchronous methods, or the code to be executed asynchronously can be put into a method and invoked by using a delegate.</span></span> <span data-ttu-id="84f36-131">Esta sección proporciona dos ejemplos de una actividad derivada de <xref:System.Activities.AsyncCodeActivity> ; uno que utiliza los métodos asincrónicos de las bibliotecas cliente de los Servicios de datos de WCF y otro que usa un delegado.</span><span class="sxs-lookup"><span data-stu-id="84f36-131">This section provides two examples of an <xref:System.Activities.AsyncCodeActivity> derived activity; one that uses the asynchronous methods of the WCF Data Services client libraries and one that uses a delegate.</span></span>

> [!NOTE]
> <span data-ttu-id="84f36-132">Para obtener más información, vea [operaciones asincrónicas (WCF Data Services)](../data/wcf/asynchronous-operations-wcf-data-services.md) y [crear actividades asincrónicas](creating-asynchronous-activities-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="84f36-132">For more information, see [Asynchronous Operations (WCF Data Services)](../data/wcf/asynchronous-operations-wcf-data-services.md) and [Creating Asynchronous Activities](creating-asynchronous-activities-in-wf.md).</span></span>

### <a name="using-client-library-asynchronous-methods"></a><span data-ttu-id="84f36-133">Usar métodos asincrónicos de la biblioteca de cliente</span><span class="sxs-lookup"><span data-stu-id="84f36-133">Using client library asynchronous methods</span></span>

<span data-ttu-id="84f36-134">La clase <xref:System.Data.Services.Client.DataServiceQuery%601> proporciona los métodos <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> y <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> para consultar asincrónicamente un servicio OData.</span><span class="sxs-lookup"><span data-stu-id="84f36-134">The <xref:System.Data.Services.Client.DataServiceQuery%601> class provides <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> and <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> methods for querying an OData service asynchronously.</span></span> <span data-ttu-id="84f36-135">Se puede llamar a estos métodos desde <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> y <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> invalida de una clase derivada de <xref:System.Activities.AsyncCodeActivity> .</span><span class="sxs-lookup"><span data-stu-id="84f36-135">These methods can be called from the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> overrides of an <xref:System.Activities.AsyncCodeActivity> derived class.</span></span> <span data-ttu-id="84f36-136">Cuando se devuelve el <xref:System.Activities.AsyncCodeActivity> <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> invalidación, el flujo de trabajo puede pasar a inactivo (pero no conservar) y, cuando se completa el trabajo asincrónico, el tiempo de ejecución invoca <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="84f36-136">When the <xref:System.Activities.AsyncCodeActivity> <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override returns, the workflow can go idle (but not persist), and when the asynchronous work is completed, <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> is invoked by the runtime.</span></span>

<span data-ttu-id="84f36-137">En el ejemplo siguiente, se define una actividad `OrdersByCustomer` con dos argumentos de entrada.</span><span class="sxs-lookup"><span data-stu-id="84f36-137">In the following example, an `OrdersByCustomer` activity is defined that has two input arguments.</span></span> <span data-ttu-id="84f36-138">El argumento `CustomerId` representa el cliente que identifica qué pedidos se va a devolver, mientras que el argumento `ServiceUri` representa el URI del servicio de OData que se va a consultar.</span><span class="sxs-lookup"><span data-stu-id="84f36-138">The `CustomerId` argument represents the customer who identifies which orders to return, and the `ServiceUri` argument represents the URI of the OData service to be queried.</span></span> <span data-ttu-id="84f36-139">Dado que la actividad deriva de `AsyncCodeActivity<IEnumerable<Order>>` hay también un parámetro de salida <xref:System.Activities.Activity%601.Result%2A> que se utiliza para devolver los resultados de la consulta.</span><span class="sxs-lookup"><span data-stu-id="84f36-139">Because the activity derives from `AsyncCodeActivity<IEnumerable<Order>>` there is also a <xref:System.Activities.Activity%601.Result%2A> output argument that is used to return the results of the query.</span></span> <span data-ttu-id="84f36-140">La <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> reemplazada crea un consulta LINQ que selecciona todos los pedidos del cliente especificado.</span><span class="sxs-lookup"><span data-stu-id="84f36-140">The <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override creates a LINQ query that selects all orders of the specified customer.</span></span> <span data-ttu-id="84f36-141">Esta consulta se especifica como la <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> de la <xref:System.Activities.AsyncCodeActivityContext>pasada y, a continuación, se llama al método de la consulta <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> .</span><span class="sxs-lookup"><span data-stu-id="84f36-141">This query is specified as the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> of the passed <xref:System.Activities.AsyncCodeActivityContext>, and then the query's <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> method is called.</span></span> <span data-ttu-id="84f36-142">Observe que la devolución de llamada y el estado que se pasan a la <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> de la consulta son las que se pasan al método <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> de la actividad.</span><span class="sxs-lookup"><span data-stu-id="84f36-142">Note that the callback and state that are passed into the query's <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> are the ones that are passed in to the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> method.</span></span> <span data-ttu-id="84f36-143">Cuando la consulta se ha terminado de ejecutar, se invoca el método <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> de la actividad.</span><span class="sxs-lookup"><span data-stu-id="84f36-143">When the query has finished executing, the activity's <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> method is invoked.</span></span> <span data-ttu-id="84f36-144">La consulta se recupera desde <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>y, a continuación, se llama al método <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> de la consulta.</span><span class="sxs-lookup"><span data-stu-id="84f36-144">The query is retrieved from the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, and then the query's <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> method is called.</span></span> <span data-ttu-id="84f36-145">Este método devuelve las <xref:System.Collections.Generic.IEnumerable%601> del tipo de entidad especificado; en este caso `Order`.</span><span class="sxs-lookup"><span data-stu-id="84f36-145">This method returns an <xref:System.Collections.Generic.IEnumerable%601> of the specified entity type; in this case `Order`.</span></span> <span data-ttu-id="84f36-146">Puesto que `IEnumerable<Order>` es el tipo genérico del <xref:System.Activities.AsyncCodeActivity%601>, este <xref:System.Collections.IEnumerable> se establece como el <xref:System.Activities.OutArgument%601> <xref:System.Activities.Activity%601.Result%2A> de la actividad.</span><span class="sxs-lookup"><span data-stu-id="84f36-146">Since `IEnumerable<Order>` is the generic type of the <xref:System.Activities.AsyncCodeActivity%601>, this <xref:System.Collections.IEnumerable> is set as the <xref:System.Activities.Activity%601.Result%2A> <xref:System.Activities.OutArgument%601> of the activity.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#100](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#100)]

<span data-ttu-id="84f36-147">En el siguiente ejemplo, la actividad `OrdersByCustomer` recupera una lista de pedidos para el cliente especificado y a continuación una actividad <xref:System.Activities.Statements.ForEach%601> enumera los pedidos devueltos y escribe la fecha de cada pedido en la consola.</span><span class="sxs-lookup"><span data-stu-id="84f36-147">In the following example, the `OrdersByCustomer` activity retrieves a list of orders for the specified customer, and then a <xref:System.Activities.Statements.ForEach%601> activity enumerates the returned orders and writes the date of each order to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#10](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#10)]

<span data-ttu-id="84f36-148">Cuando se invoca este flujo de trabajo, se escriben los siguientes datos en la consola:</span><span class="sxs-lookup"><span data-stu-id="84f36-148">When this workflow is invoked, the following data is written to the console:</span></span>

```console
Calling WCF Data Service...
8/25/1997
10/3/1997
10/13/1997
1/15/1998
3/16/1998
4/9/1998
```

> [!NOTE]
> <span data-ttu-id="84f36-149">Si no se puede establecer una conexión al servidor de OData, obtendrá una excepción similar a la siguiente:</span><span class="sxs-lookup"><span data-stu-id="84f36-149">If a connection to the OData server cannot be established, you will get an exception similar to the following exception:</span></span>
>
> <span data-ttu-id="84f36-150">Excepción no controlada: System.InvalidOperationException: Error al procesar esta solicitud.</span><span class="sxs-lookup"><span data-stu-id="84f36-150">Unhandled Exception: System.InvalidOperationException: An error occurred while processing this request.</span></span> <span data-ttu-id="84f36-151">---> System.Net.WebException: No es posible conectar con el servidor remoto ---> System.Net.Sockets.SocketException: Error de intento de conexión porque la parte conectada no respondió correctamente después de un período de tiempo, o error de la conexión establecida porque el host conectado no respondió.</span><span class="sxs-lookup"><span data-stu-id="84f36-151">---> System.Net.WebException: Unable to connect to the remote server ---> System.Net.Sockets.SocketException: A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond.</span></span>

<span data-ttu-id="84f36-152">Si se requiere cualquier procesamiento adicional de los datos devueltos por la consulta, se puede hacer al reemplazar <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> en la actividad.</span><span class="sxs-lookup"><span data-stu-id="84f36-152">If any additional processing of the data returned by the query is required, it can be done in the activity's <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> override.</span></span> <span data-ttu-id="84f36-153">Se invocan <xref:System.Activities.AsyncCodeActivity%601.BeginExecute%2A> y <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> al usar el subproceso del flujo de trabajo y cualquier código de estos reemplazos no se ejecuta de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="84f36-153">Both <xref:System.Activities.AsyncCodeActivity%601.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> are invoked by using the workflow thread, and any code in these overrides does not run asynchronously.</span></span> <span data-ttu-id="84f36-154">Si el procesamiento adicional es extenso o de ejecución prolongada, o se paginan los resultados de la consulta, debería considerar el enfoque descrito en la sección siguiente, que utiliza un delegado para ejecutar la consulta y realizar el procesamiento adicional de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="84f36-154">If the additional processing is extensive or long-running, or the query results are paged, you should consider the approach discussed in the next section, which uses a delegate to execute the query and perform additional processing asynchronously.</span></span>

### <a name="using-a-delegate"></a><span data-ttu-id="84f36-155">Usar un delegado</span><span class="sxs-lookup"><span data-stu-id="84f36-155">Using a delegate</span></span>

<span data-ttu-id="84f36-156">Además de invocar el método asincrónico de una clase .NET Framework, una actividad basada en <xref:System.Activities.AsyncCodeActivity>también puede definir la lógica asincrónica en uno de sus métodos.</span><span class="sxs-lookup"><span data-stu-id="84f36-156">In addition to invoking the asynchronous method of a .NET Framework class, an <xref:System.Activities.AsyncCodeActivity>-based activity can also define the asynchronous logic in one of its methods.</span></span> <span data-ttu-id="84f36-157">Este método se especifica al usar un delegado en el reemplazo de <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> de la actividad.</span><span class="sxs-lookup"><span data-stu-id="84f36-157">This method is specified by using a delegate in the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override.</span></span> <span data-ttu-id="84f36-158">Cuando el método devuelve un resultado, el runtime invoca el reemplazo de <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> de la actividad.</span><span class="sxs-lookup"><span data-stu-id="84f36-158">When the method returns, the runtime invokes the activity's <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> override.</span></span> <span data-ttu-id="84f36-159">Al llamar a un servicio de OData desde un flujo de trabajo, este método se puede utilizar para consultar el servicio y proporcionar cualquier procesamiento adicional.</span><span class="sxs-lookup"><span data-stu-id="84f36-159">When calling an OData service from a workflow, this method can be used to query the service and provide any additional processing.</span></span>

<span data-ttu-id="84f36-160">En el ejemplo siguiente, se define una actividad `ListCustomers` .</span><span class="sxs-lookup"><span data-stu-id="84f36-160">In the following example, a `ListCustomers` activity is defined.</span></span> <span data-ttu-id="84f36-161">Esta actividad consulta el servicio de datos de Northwind de ejemplo y devuelve una `List<Customer>` que contiene todos los clientes de la base de datos Northwind.</span><span class="sxs-lookup"><span data-stu-id="84f36-161">This activity queries the sample Northwind data service and returns a `List<Customer>` that contains all of the customers in the Northwind database.</span></span> <span data-ttu-id="84f36-162">El método `GetCustomers` realiza el trabajo asincrónico.</span><span class="sxs-lookup"><span data-stu-id="84f36-162">The asynchronous work is performed by the `GetCustomers` method.</span></span> <span data-ttu-id="84f36-163">Este método consulta todos los clientes del servicio y, a continuación, los copia en una `List<Customer>`.</span><span class="sxs-lookup"><span data-stu-id="84f36-163">This method queries the service for all customers, and then copies them into a `List<Customer>`.</span></span> <span data-ttu-id="84f36-164">Después, comprueba si los resultados están paginados.</span><span class="sxs-lookup"><span data-stu-id="84f36-164">It then checks to see if the results are paged.</span></span> <span data-ttu-id="84f36-165">En ese caso, consulta en el servicio la siguiente página de resultados, los agrega a la lista y continúa hasta que se hayan recuperado todos los datos del cliente.</span><span class="sxs-lookup"><span data-stu-id="84f36-165">If so, it queries the service for the next page of results, adds them to the list, and continues until all of the customer data has been retrieved.</span></span>

> [!NOTE]
> <span data-ttu-id="84f36-166">Para obtener más información acerca de la paginación en WCF Data Services, consulte [Cómo: cargar resultados paginados (WCF Data Services)](../data/wcf/how-to-load-paged-results-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="84f36-166">For more information about paging in WCF Data Services, see [How to: Load Paged Results (WCF Data Services)](../data/wcf/how-to-load-paged-results-wcf-data-services.md).</span></span>

<span data-ttu-id="84f36-167">Una vez agregados todos los clientes, se devuelve la lista.</span><span class="sxs-lookup"><span data-stu-id="84f36-167">Once all customers are added, the list is returned.</span></span> <span data-ttu-id="84f36-168">El método `GetCustomers` se especifica en el reemplazo de <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> de la actividad.</span><span class="sxs-lookup"><span data-stu-id="84f36-168">The `GetCustomers` method is specified in the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override.</span></span> <span data-ttu-id="84f36-169">Puesto que el método tiene un valor devuelto, se crea `Func<string, List<Customer>>` para especificar el método.</span><span class="sxs-lookup"><span data-stu-id="84f36-169">Since the method has a return value, a `Func<string, List<Customer>>` is created to specify the method.</span></span>

> [!NOTE]
> <span data-ttu-id="84f36-170">Si el método que realiza el trabajo asincrónico no tiene un valor devuelto, se utiliza  <xref:System.Action> en lugar de <xref:System.Func%601>.</span><span class="sxs-lookup"><span data-stu-id="84f36-170">If the method that performs the asynchronous work does not have a return value, an <xref:System.Action> is used instead of a <xref:System.Func%601>.</span></span> <span data-ttu-id="84f36-171">Para obtener ejemplos de cómo crear un ejemplo asincrónico con ambos enfoques, vea [crear actividades asincrónicas](creating-asynchronous-activities-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="84f36-171">For examples of creating an asynchronous example using both approaches, see [Creating Asynchronous Activities](creating-asynchronous-activities-in-wf.md).</span></span>

<span data-ttu-id="84f36-172"><xref:System.Func%601> está asignado a <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> y, a continuación, se llama a `BeginInvoke`.</span><span class="sxs-lookup"><span data-stu-id="84f36-172">This <xref:System.Func%601> is assigned to the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, and then `BeginInvoke` is called.</span></span> <span data-ttu-id="84f36-173">Puesto que el método que se va a invocar no tiene el acceso al entorno de argumentos de la actividad, el valor del argumento `ServiceUri` se pasa como el primer parámetro, junto con la devolución de llamada y estado por los que se pasaron en <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="84f36-173">Since the method to be invoked does not have access to the activity's environment of arguments, the value of the `ServiceUri` argument is passed as the first parameter, together with the callback and state that were passed into <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span></span> <span data-ttu-id="84f36-174">Cuando `GetCustomers` devuelve un resultado, el runtime invoca a <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="84f36-174">When `GetCustomers` returns, the runtime invokes <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="84f36-175">El código de <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> recupera el delegado desde la propiedad <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, llama a `EndInvoke`y devuelve el resultado, que es la lista de clientes devuelta desde el método `GetCustomers` .</span><span class="sxs-lookup"><span data-stu-id="84f36-175">The code in <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> retrieves the delegate from the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, calls `EndInvoke`, and returns the result, which is the list of customers returned from the `GetCustomers` method.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#200](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#200)]

<span data-ttu-id="84f36-176">En el siguiente ejemplo, la actividad `ListCustomers` recupera una lista de clientes y, a continuación, una actividad <xref:System.Activities.Statements.ForEach%601> los enumera y escribe el nombre de la compañía y nombre de contacto de cada cliente en la consola.</span><span class="sxs-lookup"><span data-stu-id="84f36-176">In the following example, the `ListCustomers` activity retrieves a list of customers, and then a <xref:System.Activities.Statements.ForEach%601> activity enumerates them and writes the company name and contact name of each customer to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#20](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#20)]

<span data-ttu-id="84f36-177">Cuando se invoca este flujo de trabajo, se escriben los siguientes datos en la consola.</span><span class="sxs-lookup"><span data-stu-id="84f36-177">When this workflow is invoked, the following data is written to the console.</span></span> <span data-ttu-id="84f36-178">Puesto que esta consulta devuelve muchos clientes, solo se mostró aquí una parte del resultado.</span><span class="sxs-lookup"><span data-stu-id="84f36-178">Since this query returns many customers, only part of the output is displayed here.</span></span>

```console
Calling WCF Data Service...
Alfreds Futterkiste, Contact: Maria Anders
Ana Trujillo Emparedados y helados, Contact: Ana Trujillo
Antonio Moreno Taquería, Contact: Antonio Moreno
Around the Horn, Contact: Thomas Hardy
Berglunds snabbköp, Contact: Christina Berglund
...
```

## <a name="consuming-an-odata-feed-without-using-the-client-libraries"></a><span data-ttu-id="84f36-179">Consumir una fuente de OData sin usar las bibliotecas de cliente</span><span class="sxs-lookup"><span data-stu-id="84f36-179">Consuming an OData feed without using the client libraries</span></span>

<span data-ttu-id="84f36-180">OData expone los datos como recursos direccionables a través de identificadores uniformes de recursos (URI).</span><span class="sxs-lookup"><span data-stu-id="84f36-180">OData exposes data as resources that are addressable by URIs.</span></span> <span data-ttu-id="84f36-181">Al utilizar las bibliotecas de clientes, se crean estos URI para usted, pero no tiene que utilizar las bibliotecas de clientes.</span><span class="sxs-lookup"><span data-stu-id="84f36-181">When you use the client libraries these URIs are created for you, but you do not have to use the client libraries.</span></span> <span data-ttu-id="84f36-182">Si se desea, se puede tener acceso directo a los servicios OData sin utilizar las bibliotecas de clientes.</span><span class="sxs-lookup"><span data-stu-id="84f36-182">If desired, OData services can be accessed directly without using the client libraries.</span></span> <span data-ttu-id="84f36-183">Cuando no se usan las bibliotecas de clientes, la ubicación del servicio y los datos deseados son especificados por el URI y los resultados se devuelven en respuesta a la solicitud HTTP.</span><span class="sxs-lookup"><span data-stu-id="84f36-183">When not using the client libraries the location of the service and the desired data are specified by the URI and the results are returned in the response to the HTTP request.</span></span> <span data-ttu-id="84f36-184">Entonces, estos datos sin procesar se pueden procesar o manipular del modo deseado.</span><span class="sxs-lookup"><span data-stu-id="84f36-184">This raw data can then be processed or manipulated in the desired manner.</span></span> <span data-ttu-id="84f36-185">Una manera de recuperar los resultados de una consulta de OData es utilizando la clase <xref:System.Net.WebClient> .</span><span class="sxs-lookup"><span data-stu-id="84f36-185">One way to retrieve the results of an OData query is by using the <xref:System.Net.WebClient> class.</span></span> <span data-ttu-id="84f36-186">En este ejemplo, se recupera el nombre de contacto para el cliente representado por la clave ALFKI.</span><span class="sxs-lookup"><span data-stu-id="84f36-186">In this example, the contact name for the customer represented by the key ALFKI is retrieved.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#2](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#2)]

<span data-ttu-id="84f36-187">Cuando se ejecuta este código, en la consola se muestra el siguiente resultado:</span><span class="sxs-lookup"><span data-stu-id="84f36-187">When this code is run, the following output is displayed to the console:</span></span>

```console
Raw data returned:
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<ContactName xmlns="http://schemas.microsoft.com/ado/2007/08/dataservices">Maria Anders</ContactName>
```

<span data-ttu-id="84f36-188">En un flujo de trabajo, el código de este ejemplo podría incorporarse al reemplazo <xref:System.Activities.CodeActivity.Execute%2A> de una actividad personalizada basada en <xref:System.Activities.CodeActivity>, pero también se puede lograr la misma funcionalidad utilizando la actividad <xref:System.Activities.Expressions.InvokeMethod%601>.</span><span class="sxs-lookup"><span data-stu-id="84f36-188">In a workflow, the code from this example could be incorporated into the <xref:System.Activities.CodeActivity.Execute%2A> override of a <xref:System.Activities.CodeActivity>-based custom activity, but the same functionality can also be accomplished by using the <xref:System.Activities.Expressions.InvokeMethod%601> activity.</span></span> <span data-ttu-id="84f36-189">La actividad <xref:System.Activities.Expressions.InvokeMethod%601> permite a los autores del flujo de trabajo invocarlos métodos estáticos y de instancia de una clase, pero también tiene una opción para invocar el método especificado de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="84f36-189">The <xref:System.Activities.Expressions.InvokeMethod%601> activity enables workflow authors to invoke static and instance methods of a class, and also has an option to invoke the specified method asynchronously.</span></span> <span data-ttu-id="84f36-190">En el siguiente ejemplo, se configura una actividad <xref:System.Activities.Expressions.InvokeMethod%601> para llamar al método <xref:System.Net.WebClient.DownloadString%2A> de la clase <xref:System.Net.WebClient> y devolver una lista de clientes.</span><span class="sxs-lookup"><span data-stu-id="84f36-190">In the following example, an <xref:System.Activities.Expressions.InvokeMethod%601> activity is configured to call the <xref:System.Net.WebClient.DownloadString%2A> method of the <xref:System.Net.WebClient> class and return a list of customers.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#3](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#3)]

<span data-ttu-id="84f36-191"><xref:System.Activities.Expressions.InvokeMethod%601> puede llamar métodos estáticos y de instancia de una clase.</span><span class="sxs-lookup"><span data-stu-id="84f36-191"><xref:System.Activities.Expressions.InvokeMethod%601> can call both static and instance methods of a class.</span></span> <span data-ttu-id="84f36-192">Puesto que <xref:System.Net.WebClient.DownloadString%2A> es un método de instancia de la clase <xref:System.Net.WebClient> , una nueva instancia de la clase <xref:System.Net.WebClient> se especifica para <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A>.</span><span class="sxs-lookup"><span data-stu-id="84f36-192">Since <xref:System.Net.WebClient.DownloadString%2A> is an instance method of the <xref:System.Net.WebClient> class, a new instance of the <xref:System.Net.WebClient> class is specified for the <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A>.</span></span> <span data-ttu-id="84f36-193">`DownloadString` se especifica como <xref:System.Activities.Expressions.InvokeMethod%601.MethodName%2A>, el URI que contiene la consulta se especifica en la colección <xref:System.Activities.Expressions.InvokeMethod%601.Parameters%2A> y el valor devuelto se asigna al valor de <xref:System.Activities.Activity%601.Result%2A> .</span><span class="sxs-lookup"><span data-stu-id="84f36-193">`DownloadString` is specified as the <xref:System.Activities.Expressions.InvokeMethod%601.MethodName%2A>, the URI that contains the query is specified in the <xref:System.Activities.Expressions.InvokeMethod%601.Parameters%2A> collection, and the return value is assigned to the <xref:System.Activities.Activity%601.Result%2A> value.</span></span> <span data-ttu-id="84f36-194">El valor <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A> se establece en `true`, lo que significa que la invocación del método se ejecutará de forma asincrónica con respecto al flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="84f36-194">The <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A> value is set to `true`, which means that the method invocation will run asynchronously with regard to the workflow.</span></span> <span data-ttu-id="84f36-195">En el siguiente ejemplo, se construye un flujo de trabajo que utiliza la actividad <xref:System.Activities.Expressions.InvokeMethod%601> para consultar en el servicio de datos de Northwind dl ejemplo una lista de pedidos para un cliente concreto y, a continuación, los datos devueltos se escriben en la consola.</span><span class="sxs-lookup"><span data-stu-id="84f36-195">In the following example, a workflow is constructed that uses the <xref:System.Activities.Expressions.InvokeMethod%601> activity to query the sample Northwind data service for a list of orders for a specific customer, and then the returned data is written to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#1](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#1)]

<span data-ttu-id="84f36-196">Cuando se invoca este flujo de trabajo, en la consola se muestra el siguiente resultado.</span><span class="sxs-lookup"><span data-stu-id="84f36-196">When this workflow is invoked, the following output is displayed to the console.</span></span> <span data-ttu-id="84f36-197">Puesto que esta consulta devuelve varios pedidos, solo se muestra aquí una parte del resultado.</span><span class="sxs-lookup"><span data-stu-id="84f36-197">Since this query returns several orders, only part of the output is displayed here.</span></span>

```console
Calling WCF Data Service...
Raw data returned:

<?xml version="1.0" encoding="utf-8" standalone="yes"?>*
<feed
xml:base="http://services.odata.org/Northwind/Northwind.svc/"
xmlns:d="http://schemas.microsoft.com/ado/2007/08/dataservices"
xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata"
xmlns="http://www.w3.org/2005/Atom">
<title type="text">Orders\</title>
<id>http://services.odata.org/Northwind/Northwind.svc/Customers('ALFKI')/Orders\</id>
<updated>2010-05-19T19:37:07Z\</updated>
<link rel="self" title="Orders" href="Orders" />
<entry>
<id>http://services.odata.org/Northwind/Northwind.svc/Orders(10643)\</id>
<title type="text">\</title>
<updated>2010-05-19T19:37:07Z\</updated>
<author>
<name />
</author>
<link rel="edit" title="Order" href="Orders(10643)" />
<link rel="http://schemas.microsoft.com/ado/2007/08/dataservices/related/Customer" type="application/atom+xml;type=entry" title="Customer" href="Orders(10643)/Customer" />
...
```

<span data-ttu-id="84f36-198">Este ejemplo proporciona un método que los autores de aplicación de flujo de trabajo pueden usar para consumir los datos sin formato devueltos de un servicio de OData.</span><span class="sxs-lookup"><span data-stu-id="84f36-198">This example provides one method that workflow application authors can use to consume the raw data returned from an OData service.</span></span> <span data-ttu-id="84f36-199">Para obtener más información sobre el acceso a WCF Data Services mediante URI, consulte [acceso a los recursos del servicio de datos (WCF Data Services)](../data/wcf/accessing-data-service-resources-wcf-data-services.md) y [OData: convenciones de URI](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/).</span><span class="sxs-lookup"><span data-stu-id="84f36-199">For more information about accessing WCF Data Services using URIs, see [Accessing Data Service Resources (WCF Data Services)](../data/wcf/accessing-data-service-resources-wcf-data-services.md) and [OData: URI Conventions](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/).</span></span>
