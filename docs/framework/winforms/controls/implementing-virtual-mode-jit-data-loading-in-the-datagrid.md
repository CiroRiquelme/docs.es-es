---
title: Implementar el modo virtual con la carga de datos Just-in-Time en el control DataGridView
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- examples [Windows Forms], just-in-time data loading
- data [Windows Forms], managing large data sets
- DataGridView control [Windows Forms], virtual mode
- just-in-time data loading
- DataGridView control [Windows Forms], large data sets
- virtual mode [Windows Forms], just-in-time data loading
ms.assetid: c2a052b9-423c-4ff7-91dc-d8c7c79345f6
ms.openlocfilehash: 85c6877a9fc6a92752eb039da9d36e34811f8b77
ms.sourcegitcommit: de17a7a0a37042f0d4406f5ae5393531caeb25ba
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/24/2020
ms.locfileid: "76745068"
---
# <a name="implementing-virtual-mode-with-just-in-time-data-loading-in-the-windows-forms-datagridview-control"></a><span data-ttu-id="a1afd-102">Implementar el modo virtual mediante la carga de datos Just-In-Time en el control DataGridView de formularios Windows Forms</span><span class="sxs-lookup"><span data-stu-id="a1afd-102">Implementing Virtual Mode with Just-In-Time Data Loading in the Windows Forms DataGridView Control</span></span>
<span data-ttu-id="a1afd-103">Una razón para implementar el modo virtual en el control <xref:System.Windows.Forms.DataGridView> es recuperar los datos solo cuando sea necesario.</span><span class="sxs-lookup"><span data-stu-id="a1afd-103">One reason to implement virtual mode in the <xref:System.Windows.Forms.DataGridView> control is to retrieve data only as it is needed.</span></span> <span data-ttu-id="a1afd-104">Esto se denomina *carga de datos Just-in-Time*.</span><span class="sxs-lookup"><span data-stu-id="a1afd-104">This is called *just-in-time data loading*.</span></span>  
  
 <span data-ttu-id="a1afd-105">Si está trabajando con una tabla muy grande en una base de datos remota, por ejemplo, puede que desee evitar retrasos de inicio recuperando únicamente los datos necesarios para mostrar y recuperar datos adicionales solo cuando el usuario desplace nuevas filas a la vista.</span><span class="sxs-lookup"><span data-stu-id="a1afd-105">If you are working with a very large table in a remote database, for example, you might want to avoid startup delays by retrieving only the data that is necessary for display and retrieving additional data only when the user scrolls new rows into view.</span></span> <span data-ttu-id="a1afd-106">Si los equipos cliente que ejecutan la aplicación tienen una cantidad limitada de memoria disponible para almacenar los datos, puede que también desee descartar los datos no usados al recuperar nuevos valores de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="a1afd-106">If the client computers running your application have a limited amount of memory available for storing data, you might also want to discard unused data when retrieving new values from the database.</span></span>  
  
 <span data-ttu-id="a1afd-107">En las secciones siguientes se describe cómo utilizar un control de <xref:System.Windows.Forms.DataGridView> con una caché Just-in-Time.</span><span class="sxs-lookup"><span data-stu-id="a1afd-107">The following sections describe how to use a <xref:System.Windows.Forms.DataGridView> control with a just-in-time cache.</span></span>  
  
 <span data-ttu-id="a1afd-108">Para copiar el código de este tema como una sola lista, vea [Cómo: implementar el modo virtual con la carga de datos Just-in-Time en el control DataGridView Windows Forms](virtual-mode-with-just-in-time-data-loading-in-the-datagrid.md).</span><span class="sxs-lookup"><span data-stu-id="a1afd-108">To copy the code in this topic as a single listing, see [How to: Implement Virtual Mode with Just-In-Time Data Loading in the Windows Forms DataGridView Control](virtual-mode-with-just-in-time-data-loading-in-the-datagrid.md).</span></span>  
  
## <a name="the-form"></a><span data-ttu-id="a1afd-109">El formulario</span><span class="sxs-lookup"><span data-stu-id="a1afd-109">The Form</span></span>  
 <span data-ttu-id="a1afd-110">En el ejemplo de código siguiente se define un formulario que contiene un control de <xref:System.Windows.Forms.DataGridView> de solo lectura que interactúa con un objeto `Cache` a través de un controlador de eventos <xref:System.Windows.Forms.DataGridView.CellValueNeeded>.</span><span class="sxs-lookup"><span data-stu-id="a1afd-110">The following code example defines a form containing a read-only <xref:System.Windows.Forms.DataGridView> control that interacts with a `Cache` object through a <xref:System.Windows.Forms.DataGridView.CellValueNeeded> event handler.</span></span> <span data-ttu-id="a1afd-111">El objeto `Cache` administra los valores almacenados localmente y utiliza un objeto `DataRetriever` para recuperar los valores de la tabla Orders de la base de datos Northwind de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="a1afd-111">The `Cache` object manages the locally stored values and uses a `DataRetriever` object to retrieve values from the Orders table of the sample Northwind database.</span></span> <span data-ttu-id="a1afd-112">El objeto `DataRetriever`, que implementa la interfaz `IDataPageRetriever` requerida por la clase `Cache`, también se usa para inicializar las filas y columnas del control <xref:System.Windows.Forms.DataGridView>.</span><span class="sxs-lookup"><span data-stu-id="a1afd-112">The `DataRetriever` object, which implements the `IDataPageRetriever` interface required by the `Cache` class, is also used to initialize the <xref:System.Windows.Forms.DataGridView> control rows and columns.</span></span>  
  
 <span data-ttu-id="a1afd-113">Los tipos `IDataPageRetriever`, `DataRetriever`y `Cache` se describen más adelante en este tema.</span><span class="sxs-lookup"><span data-stu-id="a1afd-113">The `IDataPageRetriever`, `DataRetriever`, and `Cache` types are described later in this topic.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="a1afd-114">Almacenar información confidencial, como una contraseña, en la cadena de conexión puede afectar a la seguridad de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a1afd-114">Storing sensitive information, such as a password, within the connection string can affect the security of your application.</span></span> <span data-ttu-id="a1afd-115">El uso de la autenticación de Windows (también conocida como seguridad integrada) es un modo más seguro de controlar el acceso a una base de datos.</span><span class="sxs-lookup"><span data-stu-id="a1afd-115">Using Windows Authentication (also known as integrated security) is a more secure way to control access to a database.</span></span> <span data-ttu-id="a1afd-116">Para más información, consulte [Proteger la información de conexión](../../data/adonet/protecting-connection-information.md).</span><span class="sxs-lookup"><span data-stu-id="a1afd-116">For more information, see [Protecting Connection Information](../../data/adonet/protecting-connection-information.md).</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#100](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#100)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#100](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#100)]  
  
## <a name="the-idatapageretriever-interface"></a><span data-ttu-id="a1afd-117">La interfaz IDataPageRetriever</span><span class="sxs-lookup"><span data-stu-id="a1afd-117">The IDataPageRetriever Interface</span></span>  
 <span data-ttu-id="a1afd-118">En el ejemplo de código siguiente se define la interfaz `IDataPageRetriever`, implementada por la clase `DataRetriever`.</span><span class="sxs-lookup"><span data-stu-id="a1afd-118">The following code example defines the `IDataPageRetriever` interface, which is implemented by the `DataRetriever` class.</span></span> <span data-ttu-id="a1afd-119">El único método declarado en esta interfaz es el método `SupplyPageOfData`, que requiere un índice de fila inicial y un recuento del número de filas en una sola página de datos.</span><span class="sxs-lookup"><span data-stu-id="a1afd-119">The only method declared in this interface is the `SupplyPageOfData` method, which requires an initial row index and a count of the number of rows in a single page of data.</span></span> <span data-ttu-id="a1afd-120">El implementador utiliza estos valores para recuperar un subconjunto de datos de un origen de datos.</span><span class="sxs-lookup"><span data-stu-id="a1afd-120">These values are used by the implementer to retrieve a subset of data from a data source.</span></span>  
  
 <span data-ttu-id="a1afd-121">Un objeto `Cache` usa una implementación de esta interfaz durante la construcción para cargar dos páginas iniciales de datos.</span><span class="sxs-lookup"><span data-stu-id="a1afd-121">A `Cache` object uses an implementation of this interface during construction to load two initial pages of data.</span></span> <span data-ttu-id="a1afd-122">Siempre que se necesita un valor no almacenado en caché, la memoria caché descarta una de estas páginas y solicita una nueva página que contiene el valor de la `IDataPageRetriever`.</span><span class="sxs-lookup"><span data-stu-id="a1afd-122">Whenever an uncached value is needed, the cache discards one of these pages and requests a new page containing the value from the `IDataPageRetriever`.</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#201](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#201)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#201](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#201)]  
  
## <a name="the-dataretriever-class"></a><span data-ttu-id="a1afd-123">La clase del recuperador</span><span class="sxs-lookup"><span data-stu-id="a1afd-123">The DataRetriever Class</span></span>  
 <span data-ttu-id="a1afd-124">En el ejemplo de código siguiente se define la clase `DataRetriever`, que implementa la interfaz `IDataPageRetriever` para recuperar páginas de datos de un servidor.</span><span class="sxs-lookup"><span data-stu-id="a1afd-124">The following code example defines the `DataRetriever` class, which implements the `IDataPageRetriever` interface to retrieve pages of data from a server.</span></span> <span data-ttu-id="a1afd-125">La clase `DataRetriever` también proporciona las propiedades `Columns` y `RowCount`, que el control <xref:System.Windows.Forms.DataGridView> utiliza para crear las columnas necesarias y para agregar el número adecuado de filas vacías a la colección <xref:System.Windows.Forms.DataGridView.Rows%2A>.</span><span class="sxs-lookup"><span data-stu-id="a1afd-125">The `DataRetriever` class also provides `Columns` and `RowCount` properties, which the <xref:System.Windows.Forms.DataGridView> control uses to create the necessary columns and to add the appropriate number of empty rows to the <xref:System.Windows.Forms.DataGridView.Rows%2A> collection.</span></span> <span data-ttu-id="a1afd-126">Es necesario agregar filas vacías para que el control se comporte como si tuviera todos los datos de la tabla.</span><span class="sxs-lookup"><span data-stu-id="a1afd-126">Adding the empty rows is necessary so that the control will behave as though it contains all the data in the table.</span></span> <span data-ttu-id="a1afd-127">Esto significa que el cuadro de desplazamiento de la barra de desplazamiento tendrá el tamaño adecuado y el usuario podrá tener acceso a cualquier fila de la tabla.</span><span class="sxs-lookup"><span data-stu-id="a1afd-127">This means that the scroll box in the scroll bar will have the appropriate size, and the user will be able to access any row in the table.</span></span> <span data-ttu-id="a1afd-128">El controlador de eventos <xref:System.Windows.Forms.DataGridView.CellValueNeeded> rellena las filas solo cuando se desplazan a la vista.</span><span class="sxs-lookup"><span data-stu-id="a1afd-128">The rows are filled by the <xref:System.Windows.Forms.DataGridView.CellValueNeeded> event handler only when they are scrolled into view.</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#200](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#200)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#200](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#200)]  
  
## <a name="the-cache-class"></a><span data-ttu-id="a1afd-129">La clase cache</span><span class="sxs-lookup"><span data-stu-id="a1afd-129">The Cache Class</span></span>  
 <span data-ttu-id="a1afd-130">En el ejemplo de código siguiente se define la clase `Cache`, que administra dos páginas de datos rellenadas a través de una implementación `IDataPageRetriever`.</span><span class="sxs-lookup"><span data-stu-id="a1afd-130">The following code example defines the `Cache` class, which manages two pages of data populated through an `IDataPageRetriever` implementation.</span></span> <span data-ttu-id="a1afd-131">La clase `Cache` define una estructura de `DataPage` interna, que contiene un <xref:System.Data.DataTable> para almacenar los valores en una sola página de caché y que calcula los índices de fila que representan los límites superior e inferior de la página.</span><span class="sxs-lookup"><span data-stu-id="a1afd-131">The `Cache` class defines an inner `DataPage` structure, which contains a <xref:System.Data.DataTable> to store the values in a single cache page and which calculates the row indexes that represent the upper and lower boundaries of the page.</span></span>  
  
 <span data-ttu-id="a1afd-132">La clase `Cache` carga dos páginas de datos en el momento de la construcción.</span><span class="sxs-lookup"><span data-stu-id="a1afd-132">The `Cache` class loads two pages of data at construction time.</span></span> <span data-ttu-id="a1afd-133">Cada vez que el evento de <xref:System.Windows.Forms.DataGridView.CellValueNeeded> solicita un valor, el objeto de `Cache` determina si el valor está disponible en una de sus dos páginas y, en caso afirmativo, lo devuelve.</span><span class="sxs-lookup"><span data-stu-id="a1afd-133">Whenever the <xref:System.Windows.Forms.DataGridView.CellValueNeeded> event requests a value, the `Cache` object determines if the value is available in one of its two pages and, if so, returns it.</span></span> <span data-ttu-id="a1afd-134">Si el valor no está disponible localmente, el objeto de `Cache` determina cuál de sus dos páginas es más alejada de las filas mostradas actualmente y reemplaza la página por una nueva que contiene el valor solicitado, que después devuelve.</span><span class="sxs-lookup"><span data-stu-id="a1afd-134">If the value is not available locally, the `Cache` object determines which of its two pages is farthest from the currently displayed rows and replaces the page with a new one containing the requested value, which it then returns.</span></span>  
  
 <span data-ttu-id="a1afd-135">Suponiendo que el número de filas de una página de datos es el mismo que el número de filas que se pueden mostrar en la pantalla al mismo tiempo, este modelo permite a los usuarios paginar la tabla para volver a la página que se vio más recientemente.</span><span class="sxs-lookup"><span data-stu-id="a1afd-135">Assuming that the number of rows in a data page is the same as the number of rows that can be displayed on screen at once, this model allows users paging through the table to efficiently return to the most recently viewed page.</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#300](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#300)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#300](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#300)]  
  
## <a name="additional-considerations"></a><span data-ttu-id="a1afd-136">Consideraciones adicionales</span><span class="sxs-lookup"><span data-stu-id="a1afd-136">Additional Considerations</span></span>  
 <span data-ttu-id="a1afd-137">Los ejemplos de código anteriores se proporcionan como demostración de la carga de datos Just-in-Time.</span><span class="sxs-lookup"><span data-stu-id="a1afd-137">The previous code examples are provided as a demonstration of just-in-time data loading.</span></span> <span data-ttu-id="a1afd-138">Tendrá que modificar el código para sus propias necesidades para lograr la máxima eficacia.</span><span class="sxs-lookup"><span data-stu-id="a1afd-138">You will need to modify the code for your own needs to achieve maximum efficiency.</span></span> <span data-ttu-id="a1afd-139">Como mínimo, tendrá que elegir un valor adecuado para el número de filas por página de datos en la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="a1afd-139">At minimum, you will need to choose an appropriate value for the number of rows per page of data in the cache.</span></span> <span data-ttu-id="a1afd-140">Este valor se pasa al constructor de `Cache`.</span><span class="sxs-lookup"><span data-stu-id="a1afd-140">This value is passed into the `Cache` constructor.</span></span> <span data-ttu-id="a1afd-141">El número de filas por página no debe ser menor que el número de filas que se pueden mostrar simultáneamente en el control de <xref:System.Windows.Forms.DataGridView>.</span><span class="sxs-lookup"><span data-stu-id="a1afd-141">The number of rows per page should be no less than the number of rows that can be displayed simultaneously in your <xref:System.Windows.Forms.DataGridView> control.</span></span>  
  
 <span data-ttu-id="a1afd-142">Para obtener los mejores resultados, tendrá que realizar pruebas de rendimiento y pruebas de facilidad de uso para determinar los requisitos del sistema y de los usuarios.</span><span class="sxs-lookup"><span data-stu-id="a1afd-142">For best results, you will need to conduct performance testing and usability testing to determine the requirements of your system and your users.</span></span> <span data-ttu-id="a1afd-143">Entre los factores que debe tener en cuenta se incluyen la cantidad de memoria en los equipos cliente que ejecutan la aplicación, el ancho de banda disponible de la conexión de red usada y la latencia del servidor utilizado.</span><span class="sxs-lookup"><span data-stu-id="a1afd-143">Several factors that you will need to take into consideration include the amount of memory in the client machines running your application, the available bandwidth of the network connection used, and the latency of the server used.</span></span> <span data-ttu-id="a1afd-144">El ancho de banda y la latencia deben determinarse a horas de uso máximo.</span><span class="sxs-lookup"><span data-stu-id="a1afd-144">The bandwidth and latency should be determined at times of peak usage.</span></span>  
  
 <span data-ttu-id="a1afd-145">Para mejorar el rendimiento del desplazamiento de la aplicación, puede aumentar la cantidad de datos almacenados localmente.</span><span class="sxs-lookup"><span data-stu-id="a1afd-145">To improve the scrolling performance of your application, you can increase the amount of data stored locally.</span></span> <span data-ttu-id="a1afd-146">Sin embargo, para mejorar el tiempo de inicio, debe evitar cargar inicialmente demasiados datos.</span><span class="sxs-lookup"><span data-stu-id="a1afd-146">To improve startup time, however, you must avoid loading too much data initially.</span></span> <span data-ttu-id="a1afd-147">Puede que desee modificar la clase `Cache` para aumentar el número de páginas de datos que puede almacenar.</span><span class="sxs-lookup"><span data-stu-id="a1afd-147">You may want to modify the `Cache` class to increase the number of data pages it can store.</span></span> <span data-ttu-id="a1afd-148">El uso de más páginas de datos puede mejorar la eficacia del desplazamiento, pero tendrá que determinar el número ideal de filas en una página de datos, en función del ancho de banda disponible y de la latencia del servidor.</span><span class="sxs-lookup"><span data-stu-id="a1afd-148">Using more data pages can improve scrolling efficiency, but you will need to determine the ideal number of rows in a data page, depending on the available bandwidth and the server latency.</span></span> <span data-ttu-id="a1afd-149">Con páginas más pequeñas, se tiene acceso al servidor con mayor frecuencia, pero se tardará menos tiempo en devolver los datos solicitados.</span><span class="sxs-lookup"><span data-stu-id="a1afd-149">With smaller pages, the server will be accessed more frequently, but will take less time to return the requested data.</span></span> <span data-ttu-id="a1afd-150">Si la latencia es mayor que un problema que el ancho de banda, puede que desee usar páginas de datos más grandes.</span><span class="sxs-lookup"><span data-stu-id="a1afd-150">If latency is more of an issue than bandwidth, you may want to use larger data pages.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a1afd-151">Consulte también</span><span class="sxs-lookup"><span data-stu-id="a1afd-151">See also</span></span>

- <xref:System.Windows.Forms.DataGridView>
- <xref:System.Windows.Forms.DataGridView.VirtualMode%2A>
- [<span data-ttu-id="a1afd-152">Ajuste del rendimiento del control DataGridView en Windows Forms</span><span class="sxs-lookup"><span data-stu-id="a1afd-152">Performance Tuning in the Windows Forms DataGridView Control</span></span>](performance-tuning-in-the-windows-forms-datagridview-control.md)
- [<span data-ttu-id="a1afd-153">Procedimientos recomendados para ajustar la escala del control DataGridView en formularios Windows Forms</span><span class="sxs-lookup"><span data-stu-id="a1afd-153">Best Practices for Scaling the Windows Forms DataGridView Control</span></span>](best-practices-for-scaling-the-windows-forms-datagridview-control.md)
- [<span data-ttu-id="a1afd-154">Modo virtual del control DataGridView de Windows Forms</span><span class="sxs-lookup"><span data-stu-id="a1afd-154">Virtual Mode in the Windows Forms DataGridView Control</span></span>](virtual-mode-in-the-windows-forms-datagridview-control.md)
- [<span data-ttu-id="a1afd-155">Tutorial: Implementar el modo virtual en el control DataGridView de Windows Forms</span><span class="sxs-lookup"><span data-stu-id="a1afd-155">Walkthrough: Implementing Virtual Mode in the Windows Forms DataGridView Control</span></span>](implementing-virtual-mode-wf-datagridview-control.md)
- [<span data-ttu-id="a1afd-156">Implementar el modo virtual con la carga de datos Just-In-Time en el control DataGridView de formularios Windows Forms</span><span class="sxs-lookup"><span data-stu-id="a1afd-156">How to: Implement Virtual Mode with Just-In-Time Data Loading in the Windows Forms DataGridView Control</span></span>](virtual-mode-with-just-in-time-data-loading-in-the-datagrid.md)
