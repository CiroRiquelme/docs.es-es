---
title: Comunicación de servicio a servicio
description: Obtenga información sobre cómo los microservicios nativos de la nube de back-end se comunican con otros microservicios back-end.
author: robvet
ms.date: 09/09/2019
ms.openlocfilehash: a5124b8b83f62ff17b1230ead63db26e0c1f2a5b
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/14/2020
ms.locfileid: "79401764"
---
# <a name="service-to-service-communication"></a><span data-ttu-id="2cac4-103">Comunicación de servicio a servicio</span><span class="sxs-lookup"><span data-stu-id="2cac4-103">Service-to-service communication</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="2cac4-104">Al pasar del cliente front-end, ahora nos dirigimos a microservicios back-end que se comunican entre sí.</span><span class="sxs-lookup"><span data-stu-id="2cac4-104">Moving from the front-end client, we now address back-end microservices communicate with each other.</span></span>

<span data-ttu-id="2cac4-105">Al crear una aplicación nativa de la nube, querrá ser sensible a cómo se comunican los servicios back-end entre sí.</span><span class="sxs-lookup"><span data-stu-id="2cac4-105">When constructing a cloud-native application, you'll want to be sensitive to how back-end services communicate with each other.</span></span> <span data-ttu-id="2cac4-106">Idealmente, cuanto menos comunicación entre servicios, mejor.</span><span class="sxs-lookup"><span data-stu-id="2cac4-106">Ideally, the less inter-service communication, the better.</span></span> <span data-ttu-id="2cac4-107">Sin embargo, la evitación no siempre es posible, ya que los servicios back-end a menudo dependen unos de otros para completar una operación.</span><span class="sxs-lookup"><span data-stu-id="2cac4-107">However, avoidance isn't always possible as back-end services often rely on one another to complete an operation.</span></span>

<span data-ttu-id="2cac4-108">Existen varios enfoques ampliamente aceptados para implementar la comunicación entre servicios.</span><span class="sxs-lookup"><span data-stu-id="2cac4-108">There are several widely accepted approaches to implementing cross-service communication.</span></span> <span data-ttu-id="2cac4-109">El *tipo de interacción de comunicación* a menudo determinará el mejor enfoque.</span><span class="sxs-lookup"><span data-stu-id="2cac4-109">The *type of communication interaction* will often determine the best approach.</span></span>

<span data-ttu-id="2cac4-110">Tenga en cuenta los siguientes tipos de interacción:</span><span class="sxs-lookup"><span data-stu-id="2cac4-110">Consider the following interaction types:</span></span>

- <span data-ttu-id="2cac4-111">*Consulta:* cuando un microservicio que realiza una llamada requiere una respuesta de un microservicio llamado, como" "Oye, dame la información del comprador para un identificador de cliente determinado."</span><span class="sxs-lookup"><span data-stu-id="2cac4-111">*Query* – when a calling microservice requires a response from a called microservice, such as, "Hey, give me the buyer information for a given customer Id."</span></span>

- <span data-ttu-id="2cac4-112">*Comando:* cuando el microservicio que realiza la llamada necesita otro microservicio para ejecutar una acción, pero no requiere una respuesta, como, "Oye, simplemente envía esta orden".</span><span class="sxs-lookup"><span data-stu-id="2cac4-112">*Command* – when the calling microservice needs another microservice to execute an action but doesn't require a response, such as, "Hey, just ship this order."</span></span>

- <span data-ttu-id="2cac4-113">*Evento:* cuando un microservicio, denominado publicador, genera un evento que indica que el estado ha cambiado o se ha producido una acción.</span><span class="sxs-lookup"><span data-stu-id="2cac4-113">*Event* – when a microservice, called the publisher, raises an event that state has changed or an action has occurred.</span></span> <span data-ttu-id="2cac4-114">Otros microservicios, denominados suscriptores, que están interesados, pueden reaccionar al evento de forma adecuada.</span><span class="sxs-lookup"><span data-stu-id="2cac4-114">Other microservices, called subscribers, who are interested, can react to the event appropriately.</span></span> <span data-ttu-id="2cac4-115">El editor y los suscriptores no se conocen entre sí.</span><span class="sxs-lookup"><span data-stu-id="2cac4-115">The publisher and the subscribers aren't aware of each other.</span></span>

<span data-ttu-id="2cac4-116">Los sistemas de microservicios suelen usar una combinación de estos tipos de interacción al ejecutar operaciones que requieren interacción entre servicios.</span><span class="sxs-lookup"><span data-stu-id="2cac4-116">Microservice systems typically use a combination of these interaction types when executing operations that require cross-service interaction.</span></span> <span data-ttu-id="2cac4-117">Echemos un vistazo de cerca a cada uno y cómo podría implementarlos.</span><span class="sxs-lookup"><span data-stu-id="2cac4-117">Let's take a close look at each and how you might implement them.</span></span>

## <a name="queries"></a><span data-ttu-id="2cac4-118">Consultas</span><span class="sxs-lookup"><span data-stu-id="2cac4-118">Queries</span></span>

<span data-ttu-id="2cac4-119">Muchas veces, un microservicio puede necesitar *consultar* otro, lo que requiere una respuesta inmediata para completar una operación.</span><span class="sxs-lookup"><span data-stu-id="2cac4-119">Many times, one microservice might need to *query* another, requiring an immediate response to complete an operation.</span></span> <span data-ttu-id="2cac4-120">Un microservicio de cesta de la compra puede necesitar información del producto y un precio para agregar un artículo a su cesta.</span><span class="sxs-lookup"><span data-stu-id="2cac4-120">A shopping basket microservice may need product information and a price to add an item to its basket.</span></span> <span data-ttu-id="2cac4-121">Hay una serie de enfoques para implementar operaciones de consulta.</span><span class="sxs-lookup"><span data-stu-id="2cac4-121">There are a number of approaches for implementing query operations.</span></span>

### <a name="requestresponse-messaging"></a><span data-ttu-id="2cac4-122">Mensajería de solicitud-respuesta</span><span class="sxs-lookup"><span data-stu-id="2cac4-122">Request/Response Messaging</span></span>

<span data-ttu-id="2cac4-123">Una opción para implementar este escenario es que el microservicio back-end de llamada realice solicitudes HTTP directas a los microservicios que necesita consultar, que se muestra en la figura 4-8.</span><span class="sxs-lookup"><span data-stu-id="2cac4-123">One option for implementing this scenario is for the calling back-end microservice to make direct HTTP requests to the microservices it needs to query, shown in Figure 4-8.</span></span>

![Comunicación HTTP directa](./media/direct-http-communication.png)

<span data-ttu-id="2cac4-125">**Figura 4-8**.</span><span class="sxs-lookup"><span data-stu-id="2cac4-125">**Figure 4-8**.</span></span> <span data-ttu-id="2cac4-126">Comunicación HTTP directa</span><span class="sxs-lookup"><span data-stu-id="2cac4-126">Direct HTTP communication</span></span>

<span data-ttu-id="2cac4-127">Aunque las llamadas HTTP directas entre microservicios son relativamente sencillas de implementar, se debe tener cuidado para minimizar esta práctica.</span><span class="sxs-lookup"><span data-stu-id="2cac4-127">While direct HTTP calls between microservices are relatively simple to implement, care should be taken to minimize this practice.</span></span> <span data-ttu-id="2cac4-128">Para empezar, estas llamadas siempre son *sincrónicas* y bloquearán la operación hasta que se devuelva un resultado o se adelante la solicitud.</span><span class="sxs-lookup"><span data-stu-id="2cac4-128">To start, these calls are always *synchronous* and will block the operation until a result is returned or the request times outs.</span></span> <span data-ttu-id="2cac4-129">Lo que antes eran servicios independientes e independientes, capaces de evolucionar de forma independiente y desplegarse con frecuencia, ahora se acoplan entre sí.</span><span class="sxs-lookup"><span data-stu-id="2cac4-129">What were once self-contained, independent services, able to evolve independently and deploy frequently, now become coupled to each other.</span></span> <span data-ttu-id="2cac4-130">A medida que aumenta el acoplamiento entre los microservicios, sus beneficios arquitectónicos disminuyen.</span><span class="sxs-lookup"><span data-stu-id="2cac4-130">As coupling among microservices increase, their architectural benefits diminish.</span></span>

<span data-ttu-id="2cac4-131">La ejecución de una solicitud poco frecuente que realiza una única llamada HTTP directa a otro microservicio podría ser aceptable para algunos sistemas.</span><span class="sxs-lookup"><span data-stu-id="2cac4-131">Executing an infrequent request that makes a single direct HTTP call to another microservice might be acceptable for some systems.</span></span> <span data-ttu-id="2cac4-132">Sin embargo, no es recomendable realizar llamadas de gran volumen que invoquen llamadas HTTP directas a varios microservicios.</span><span class="sxs-lookup"><span data-stu-id="2cac4-132">However, high-volume calls that invoke direct HTTP calls to multiple microservices aren't advisable.</span></span> <span data-ttu-id="2cac4-133">Pueden aumentar la latencia y afectar negativamente al rendimiento, la escalabilidad y la disponibilidad del sistema.</span><span class="sxs-lookup"><span data-stu-id="2cac4-133">They can increase latency and negatively impact the performance, scalability, and availability of your system.</span></span> <span data-ttu-id="2cac4-134">Peor aún, una larga serie de comunicaciones HTTP directas puede conducir a cadenas profundas y complejas de llamadas de microservicios sincrónicos, que se muestra n.o 4-9:</span><span class="sxs-lookup"><span data-stu-id="2cac4-134">Even worse, a long series of direct HTTP communication can lead to deep and complex chains of synchronous microservices calls, shown in Figure 4-9:</span></span>

![Encadenamiento de consultas HTTP](./media/chaining-http-queries.png)

<span data-ttu-id="2cac4-136">**Figura 4-9**.</span><span class="sxs-lookup"><span data-stu-id="2cac4-136">**Figure 4-9**.</span></span> <span data-ttu-id="2cac4-137">Encadenamiento de consultas HTTP</span><span class="sxs-lookup"><span data-stu-id="2cac4-137">Chaining HTTP queries</span></span>

<span data-ttu-id="2cac4-138">Usted puede sin duda imaginar el riesgo en el diseño mostrado en la imagen anterior.</span><span class="sxs-lookup"><span data-stu-id="2cac4-138">You can certainly imagine the risk in the design shown in the previous image.</span></span> <span data-ttu-id="2cac4-139">¿Qué sucede \#si se produce un error en el paso 3?</span><span class="sxs-lookup"><span data-stu-id="2cac4-139">What happens if Step \#3 fails?</span></span> <span data-ttu-id="2cac4-140">¿O \#el paso 8 falla?</span><span class="sxs-lookup"><span data-stu-id="2cac4-140">Or Step \#8 fails?</span></span> <span data-ttu-id="2cac4-141">¿Cómo te recuperas?</span><span class="sxs-lookup"><span data-stu-id="2cac4-141">How do you recover?</span></span> <span data-ttu-id="2cac4-142">¿Qué \#sucede si el paso 6 es lento porque el servicio subyacente está ocupado?</span><span class="sxs-lookup"><span data-stu-id="2cac4-142">What if Step \#6 is slow because the underlying service is busy?</span></span> <span data-ttu-id="2cac4-143">¿Cómo continúas?</span><span class="sxs-lookup"><span data-stu-id="2cac4-143">How do you continue?</span></span> <span data-ttu-id="2cac4-144">Incluso si todo funciona correctamente, piense en la latencia en la que incurriría esta llamada, que es la suma de la latencia de cada paso.</span><span class="sxs-lookup"><span data-stu-id="2cac4-144">Even if all works correctly, think of the latency this call would incur, which is the sum of the latency of each step.</span></span>

<span data-ttu-id="2cac4-145">El gran grado de acoplamiento en la imagen anterior sugiere que los servicios no se modelaron de forma óptima.</span><span class="sxs-lookup"><span data-stu-id="2cac4-145">The large degree of coupling in the previous image suggests the services weren't optimally modeled.</span></span> <span data-ttu-id="2cac4-146">Sería bueno que el equipo revisara su diseño.</span><span class="sxs-lookup"><span data-stu-id="2cac4-146">It would behoove the team to revisit their design.</span></span>

### <a name="materialized-view-pattern"></a><span data-ttu-id="2cac4-147">Patrón Materialized View</span><span class="sxs-lookup"><span data-stu-id="2cac4-147">Materialized View pattern</span></span>

<span data-ttu-id="2cac4-148">Una opción popular para eliminar el acoplamiento de microservicios es el [patrón de vista materializada.](https://docs.microsoft.com/azure/architecture/patterns/materialized-view)</span><span class="sxs-lookup"><span data-stu-id="2cac4-148">A popular option for removing microservice coupling is the [Materialized View pattern](https://docs.microsoft.com/azure/architecture/patterns/materialized-view).</span></span> <span data-ttu-id="2cac4-149">Con este patrón, un microservicio almacena su propia copia local desnormalizada de los datos que son propiedad de otros servicios.</span><span class="sxs-lookup"><span data-stu-id="2cac4-149">With this pattern, a microservice stores its own local, denormalized copy of data that's owned by other services.</span></span> <span data-ttu-id="2cac4-150">En lugar del microservicio de la cesta de la compra que consulta el catálogo de productos y los microservicios de precios, mantiene su propia copia local de esos datos.</span><span class="sxs-lookup"><span data-stu-id="2cac4-150">Instead of the Shopping Basket microservice querying the Product Catalog and Pricing microservices, it maintains its own local copy of that data.</span></span> <span data-ttu-id="2cac4-151">Este patrón elimina el acoplamiento innecesario y mejora la fiabilidad y el tiempo de respuesta.</span><span class="sxs-lookup"><span data-stu-id="2cac4-151">This pattern eliminates unnecessary coupling and improves reliability and response time.</span></span> <span data-ttu-id="2cac4-152">Toda la operación se ejecuta dentro de un único proceso.</span><span class="sxs-lookup"><span data-stu-id="2cac4-152">The entire operation executes inside a single process.</span></span> <span data-ttu-id="2cac4-153">Exploramos este patrón y otras preocupaciones de datos en el Capítulo 5.</span><span class="sxs-lookup"><span data-stu-id="2cac4-153">We explore this pattern and other data concerns in Chapter 5.</span></span>

### <a name="service-aggregator-pattern"></a><span data-ttu-id="2cac4-154">Patrón de agregador de servicio</span><span class="sxs-lookup"><span data-stu-id="2cac4-154">Service Aggregator Pattern</span></span>

<span data-ttu-id="2cac4-155">Otra opción para eliminar el acoplamiento de microservicio a microservicio es un [microservicio de agregador,](https://devblogs.microsoft.com/cesardelatorre/designing-and-implementing-api-gateways-with-ocelot-in-a-microservices-and-container-based-architecture/)que se muestra en púrpura en la figura 4-10.</span><span class="sxs-lookup"><span data-stu-id="2cac4-155">Another option for eliminating microservice-to-microservice coupling is an [Aggregator microservice](https://devblogs.microsoft.com/cesardelatorre/designing-and-implementing-api-gateways-with-ocelot-in-a-microservices-and-container-based-architecture/), shown in purple in Figure 4-10.</span></span>

![Servicio de agregador](./media/aggregator-service.png)

<span data-ttu-id="2cac4-157">**Figura 4-10**.</span><span class="sxs-lookup"><span data-stu-id="2cac4-157">**Figure 4-10**.</span></span> <span data-ttu-id="2cac4-158">Microservicio de agregador</span><span class="sxs-lookup"><span data-stu-id="2cac4-158">Aggregator microservice</span></span>

<span data-ttu-id="2cac4-159">El patrón aísla una operación que realiza llamadas a varios microservicios back-end, centralizando su lógica en un microservicio especializado.</span><span class="sxs-lookup"><span data-stu-id="2cac4-159">The pattern isolates an operation that makes calls to multiple back-end microservices, centralizing its logic into a specialized microservice.</span></span>  <span data-ttu-id="2cac4-160">El microservicio de agregador de desprotección púrpura en la figura anterior orquesta el flujo de trabajo para la operación de desprotección.</span><span class="sxs-lookup"><span data-stu-id="2cac4-160">The purple checkout aggregator microservice in the previous figure orchestrates the workflow for the Checkout operation.</span></span> <span data-ttu-id="2cac4-161">Incluye llamadas a varios microservicios back-end en un orden secuenciado.</span><span class="sxs-lookup"><span data-stu-id="2cac4-161">It includes calls to several back-end microservices in a sequenced order.</span></span> <span data-ttu-id="2cac4-162">Los datos del flujo de trabajo se agregan y se devuelven al autor de la llamada.</span><span class="sxs-lookup"><span data-stu-id="2cac4-162">Data from the workflow is aggregated and returned to the caller.</span></span> <span data-ttu-id="2cac4-163">Aunque sigue implementando llamadas HTTP directas, el microservicio de agregador reduce las dependencias directas entre los microservicios back-end.</span><span class="sxs-lookup"><span data-stu-id="2cac4-163">While it still implements direct HTTP calls, the aggregator microservice reduces direct dependencies among back-end microservices.</span></span>

### <a name="requestreply-pattern"></a><span data-ttu-id="2cac4-164">Patrón de solicitud/respuesta</span><span class="sxs-lookup"><span data-stu-id="2cac4-164">Request/Reply Pattern</span></span>

<span data-ttu-id="2cac4-165">Otro enfoque para desacoplar mensajes HTTP sincrónicos es un [patrón de solicitud-respuesta,](https://www.enterpriseintegrationpatterns.com/patterns/messaging/RequestReply.html)que utiliza la comunicación de cola.</span><span class="sxs-lookup"><span data-stu-id="2cac4-165">Another approach for decoupling synchronous HTTP messages is a [Request-Reply Pattern](https://www.enterpriseintegrationpatterns.com/patterns/messaging/RequestReply.html), which uses queuing communication.</span></span> <span data-ttu-id="2cac4-166">La comunicación mediante una cola siempre es un canal unidireccional, con un productor enviando el mensaje y el consumidor recibiendo.</span><span class="sxs-lookup"><span data-stu-id="2cac4-166">Communication using a queue is always a one-way channel, with a producer sending the message and consumer receiving it.</span></span> <span data-ttu-id="2cac4-167">Con este patrón, se implementan una cola de solicitudes y una cola de respuesta, que se muestran en la Figura 4-11.</span><span class="sxs-lookup"><span data-stu-id="2cac4-167">With this pattern, both a request queue and response queue are implemented, shown in Figure 4-11.</span></span>

![Patrón de solicitud-respuesta](./media/request-reply-pattern.png)

<span data-ttu-id="2cac4-169">**Figura 4-11**.</span><span class="sxs-lookup"><span data-stu-id="2cac4-169">**Figure 4-11**.</span></span> <span data-ttu-id="2cac4-170">Patrón de solicitud-respuesta</span><span class="sxs-lookup"><span data-stu-id="2cac4-170">Request-reply pattern</span></span>

<span data-ttu-id="2cac4-171">Aquí, el productor de mensajes crea un mensaje basado en consultas que contiene un identificador de correlación único y lo coloca en una cola de solicitudes.</span><span class="sxs-lookup"><span data-stu-id="2cac4-171">Here, the message producer creates a query-based message that contains a unique correlation ID and places it into a request queue.</span></span> <span data-ttu-id="2cac4-172">El servicio de consumo elimina los mensajes, los procesa y coloca la respuesta en la cola de respuesta con el mismo identificador de correlación.</span><span class="sxs-lookup"><span data-stu-id="2cac4-172">The consuming service dequeues the messages, processes it and places the response into the response queue with the same correlation ID.</span></span> <span data-ttu-id="2cac4-173">El servicio de productor elimina el mensaje, lo hace coincidir con el identificador de correlación y continúa el procesamiento.</span><span class="sxs-lookup"><span data-stu-id="2cac4-173">The producer service dequeues the message, matches it with the correlation ID and continues processing.</span></span> <span data-ttu-id="2cac4-174">Cubrimos las colas en detalle en la siguiente sección.</span><span class="sxs-lookup"><span data-stu-id="2cac4-174">We cover queues in detail in the next section.</span></span>

## <a name="commands"></a><span data-ttu-id="2cac4-175">Comandos:</span><span class="sxs-lookup"><span data-stu-id="2cac4-175">Commands</span></span>

<span data-ttu-id="2cac4-176">Otro tipo de interacción de comunicación es un *comando*.</span><span class="sxs-lookup"><span data-stu-id="2cac4-176">Another type of communication interaction is a *command*.</span></span> <span data-ttu-id="2cac4-177">Un microservicio puede necesitar otro microservicio para realizar una acción.</span><span class="sxs-lookup"><span data-stu-id="2cac4-177">A microservice may need another microservice to perform an action.</span></span> <span data-ttu-id="2cac4-178">El microservicio De pedidos puede necesitar el microservicio Envío para crear un envío para un pedido aprobado.</span><span class="sxs-lookup"><span data-stu-id="2cac4-178">The Ordering microservice may need the Shipping microservice to create a shipment for an approved order.</span></span> <span data-ttu-id="2cac4-179">En la Figura 4-12, un microservicio, denominado Productor, envía un mensaje a otro microservicio, el Consumidor, ordenándolo que haga algo.</span><span class="sxs-lookup"><span data-stu-id="2cac4-179">In Figure 4-12, one microservice, called a Producer, sends a message to another microservice, the Consumer, commanding it to do something.</span></span>

![Interacción de comandos con una cola](./media/command-interaction-with-queue.png)

<span data-ttu-id="2cac4-181">**Figura 4-12**.</span><span class="sxs-lookup"><span data-stu-id="2cac4-181">**Figure 4-12**.</span></span> <span data-ttu-id="2cac4-182">Interacción de comandos con una cola</span><span class="sxs-lookup"><span data-stu-id="2cac4-182">Command interaction with a queue</span></span>

<span data-ttu-id="2cac4-183">Muy a menudo, el Productor no requiere una respuesta y puede *disparar y olvidar* el mensaje.</span><span class="sxs-lookup"><span data-stu-id="2cac4-183">Most often, the Producer doesn't require a response and can *fire-and-forget* the message.</span></span> <span data-ttu-id="2cac4-184">Si se necesita una respuesta, el consumidor envía un mensaje independiente al productor en otro canal.</span><span class="sxs-lookup"><span data-stu-id="2cac4-184">If a reply is needed, the Consumer sends a separate message back to Producer on another channel.</span></span> <span data-ttu-id="2cac4-185">Un mensaje de comando se envía mejor de forma asincrónica con una cola de mensajes.</span><span class="sxs-lookup"><span data-stu-id="2cac4-185">A command message is best sent asynchronously with a message queue.</span></span> <span data-ttu-id="2cac4-186">un agente de mensajes ligero.</span><span class="sxs-lookup"><span data-stu-id="2cac4-186">supported by a lightweight message broker.</span></span> <span data-ttu-id="2cac4-187">En el diagrama anterior, observe cómo una cola separa y desacopla ambos servicios.</span><span class="sxs-lookup"><span data-stu-id="2cac4-187">In the previous diagram, note how a queue separates and decouples both services.</span></span>

<span data-ttu-id="2cac4-188">Una cola de mensajes es una construcción intermedia a través de la cual un productor y un consumidor pasan un mensaje.</span><span class="sxs-lookup"><span data-stu-id="2cac4-188">A message queue is an intermediary construct through which a producer and consumer pass a message.</span></span> <span data-ttu-id="2cac4-189">Las colas implementan un patrón de mensajería asincrónico punto a punto.</span><span class="sxs-lookup"><span data-stu-id="2cac4-189">Queues implement an asynchronous, point-to-point messaging pattern.</span></span> <span data-ttu-id="2cac4-190">El Productor sabe dónde necesita enviarse un comando y rutea adecuadamente.</span><span class="sxs-lookup"><span data-stu-id="2cac4-190">The Producer knows where a command needs to be sent and routes appropriately.</span></span> <span data-ttu-id="2cac4-191">La cola garantiza que un mensaje es procesado por exactamente una de las instancias de consumidor que están leyendo desde el canal.</span><span class="sxs-lookup"><span data-stu-id="2cac4-191">The queue guarantees that a message is processed by exactly one of the consumer instances that are reading from the channel.</span></span> <span data-ttu-id="2cac4-192">En este escenario, el productor o el servicio de consumidor pueden escalar horizontalmente sin afectar al otro.</span><span class="sxs-lookup"><span data-stu-id="2cac4-192">In this scenario, either the producer or consumer service can scale out without affecting the other.</span></span> <span data-ttu-id="2cac4-193">Además, las tecnologías pueden ser dispares en cada lado, lo que significa que podríamos tener un microservicio Java llamando a un microservicio [Golang.](https://golang.org)</span><span class="sxs-lookup"><span data-stu-id="2cac4-193">As well, technologies can be disparate on each side, meaning that we might have a Java microservice calling a [Golang](https://golang.org) microservice.</span></span>

<span data-ttu-id="2cac4-194">En el capítulo 1, hablamos de *los servicios*de respaldo .</span><span class="sxs-lookup"><span data-stu-id="2cac4-194">In chapter 1, we talked about *backing services*.</span></span> <span data-ttu-id="2cac4-195">Los servicios de respaldo son recursos auxiliares de los que dependen los sistemas nativos de la nube.</span><span class="sxs-lookup"><span data-stu-id="2cac4-195">Backing services are ancillary resources upon which cloud-native systems depend.</span></span> <span data-ttu-id="2cac4-196">Las colas de mensajes son servicios de respaldo.</span><span class="sxs-lookup"><span data-stu-id="2cac4-196">Message queues are backing services.</span></span> <span data-ttu-id="2cac4-197">La nube de Azure admite dos tipos de colas de mensajes que los sistemas nativos de la nube pueden consumir para implementar la mensajería de comandos: colas de Azure Storage y colas de Bus de servicio de Azure.</span><span class="sxs-lookup"><span data-stu-id="2cac4-197">The Azure cloud supports two types of message queues that your cloud-native systems can consume to implement command messaging: Azure Storage Queues and Azure Service Bus Queues.</span></span>

### <a name="azure-storage-queues"></a><span data-ttu-id="2cac4-198">Colas de Azure Storage</span><span class="sxs-lookup"><span data-stu-id="2cac4-198">Azure Storage Queues</span></span>

<span data-ttu-id="2cac4-199">Las colas de almacenamiento de Azure ofrecen una infraestructura de cola sencilla que es rápida, asequible y está respaldada por cuentas de almacenamiento de Azure.</span><span class="sxs-lookup"><span data-stu-id="2cac4-199">Azure storage queues offer a simple queueing infrastructure that is fast, affordable, and backed by Azure storage accounts.</span></span>

<span data-ttu-id="2cac4-200">[Las colas](https://docs.microsoft.com/azure/storage/queues/storage-queues-introduction) de azure Storage cuentan con un mecanismo de cola basado en REST con mensajería confiable y persistente.</span><span class="sxs-lookup"><span data-stu-id="2cac4-200">[Azure Storage Queues](https://docs.microsoft.com/azure/storage/queues/storage-queues-introduction) feature a REST-based queuing mechanism with reliable and persistent messaging.</span></span> <span data-ttu-id="2cac4-201">Proporcionan un conjunto de características mínimo, pero son baratos y almacenan millones de mensajes.</span><span class="sxs-lookup"><span data-stu-id="2cac4-201">They provide a minimal feature set, but are inexpensive and store millions of messages.</span></span> <span data-ttu-id="2cac4-202">Su capacidad oscila hasta 500 TB.</span><span class="sxs-lookup"><span data-stu-id="2cac4-202">Their capacity ranges up to 500 TB.</span></span> <span data-ttu-id="2cac4-203">Un solo mensaje puede tener un tamaño de hasta 64 KB.</span><span class="sxs-lookup"><span data-stu-id="2cac4-203">A single message can be up to 64 KB in size.</span></span>

<span data-ttu-id="2cac4-204">Puede acceder a los mensajes desde cualquier lugar del mundo a través de llamadas autenticadas mediante HTTP o HTTPS.</span><span class="sxs-lookup"><span data-stu-id="2cac4-204">You can access messages from anywhere in the world via authenticated calls using HTTP or HTTPS.</span></span> <span data-ttu-id="2cac4-205">Las colas de almacenamiento pueden escalar horizontalmente a un gran número de clientes simultáneos para controlar los picos de tráfico.</span><span class="sxs-lookup"><span data-stu-id="2cac4-205">Storage queues can scale out to large numbers of concurrent clients to handle traffic spikes.</span></span>

<span data-ttu-id="2cac4-206">Dicho esto, hay limitaciones con el servicio:</span><span class="sxs-lookup"><span data-stu-id="2cac4-206">That said, there are limitations with the service:</span></span>

- <span data-ttu-id="2cac4-207">El orden de los mensajes no está garantizado.</span><span class="sxs-lookup"><span data-stu-id="2cac4-207">Message order isn't guaranteed.</span></span>

- <span data-ttu-id="2cac4-208">Un mensaje solo puede persistir durante siete días antes de que se elimine automáticamente.</span><span class="sxs-lookup"><span data-stu-id="2cac4-208">A message can only persist for seven days before it's automatically removed.</span></span>

- <span data-ttu-id="2cac4-209">La compatibilidad con la administración de estados, la detección de duplicados o las transacciones no está disponible.</span><span class="sxs-lookup"><span data-stu-id="2cac4-209">Support for state management, duplicate detection, or transactions isn't available.</span></span>

<span data-ttu-id="2cac4-210">En la figura 4-13 se muestra la jerarquía de una cola de Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="2cac4-210">Figure 4-13 shows the hierarchy of an Azure Storage Queue.</span></span>

![Jerarquía de colas de almacenamiento](./media/storage-queue-hierarchy.png)

<span data-ttu-id="2cac4-212">**Figura 4-13**.</span><span class="sxs-lookup"><span data-stu-id="2cac4-212">**Figure 4-13**.</span></span> <span data-ttu-id="2cac4-213">Jerarquía de colas de almacenamiento</span><span class="sxs-lookup"><span data-stu-id="2cac4-213">Storage queue hierarchy</span></span>

<span data-ttu-id="2cac4-214">En la figura anterior, observe cómo las colas de almacenamiento almacenan sus mensajes en la cuenta de Azure Storage subyacente.</span><span class="sxs-lookup"><span data-stu-id="2cac4-214">In the previous figure, note how storage queues store their messages in the underlying Azure Storage account.</span></span>

<span data-ttu-id="2cac4-215">Para los desarrolladores, Microsoft proporciona varias bibliotecas de cliente y servidor para el procesamiento de colas de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="2cac4-215">For developers, Microsoft provides several client and server-side libraries for Storage queue processing.</span></span> <span data-ttu-id="2cac4-216">La mayoría de las plataformas principales son compatibles, incluyendo .NET, Java, JavaScript, Ruby, Python y Go.</span><span class="sxs-lookup"><span data-stu-id="2cac4-216">Most major platforms are supported including .NET, Java, JavaScript, Ruby, Python, and Go.</span></span> <span data-ttu-id="2cac4-217">Los desarrolladores nunca deben comunicarse directamente con estas bibliotecas.</span><span class="sxs-lookup"><span data-stu-id="2cac4-217">Developers should never communicate directly with these libraries.</span></span> <span data-ttu-id="2cac4-218">Si lo hace, acoplará estrechamente el código de microservicio al servicio Azure Storage Queue.</span><span class="sxs-lookup"><span data-stu-id="2cac4-218">Doing so will tightly couple your microservice code to the Azure Storage Queue service.</span></span> <span data-ttu-id="2cac4-219">Es una mejor práctica aislar los detalles de implementación de la API.</span><span class="sxs-lookup"><span data-stu-id="2cac4-219">It's a better practice to insulate the implementation details of the API.</span></span> <span data-ttu-id="2cac4-220">Introducir una capa de intermediación, o API intermedia, que expone operaciones genéricas y encapsula la biblioteca concreta.</span><span class="sxs-lookup"><span data-stu-id="2cac4-220">Introduce an intermediation layer, or intermediate API, that exposes generic operations and encapsulates the concrete library.</span></span> <span data-ttu-id="2cac4-221">Este acoplamiento suelto le permite intercambiar un servicio de cola por otro sin tener que realizar cambios en el código de servicio principal.</span><span class="sxs-lookup"><span data-stu-id="2cac4-221">This loose coupling enables you to swap out one queuing service for another without having to make changes to the mainline service code.</span></span>

<span data-ttu-id="2cac4-222">Las colas de Azure Storage son una opción económica para implementar la mensajería de comandos en las aplicaciones nativas de la nube.</span><span class="sxs-lookup"><span data-stu-id="2cac4-222">Azure Storage queues are an economical option to implement command messaging in your cloud-native applications.</span></span> <span data-ttu-id="2cac4-223">Especialmente cuando un tamaño de cola superará los 80 GB, o un conjunto de características simple es aceptable.</span><span class="sxs-lookup"><span data-stu-id="2cac4-223">Especially when a queue size will exceed 80 GB, or a simple feature set is acceptable.</span></span> <span data-ttu-id="2cac4-224">Solo paga por el almacenamiento de los mensajes; no hay cargos fijos por hora.</span><span class="sxs-lookup"><span data-stu-id="2cac4-224">You only pay for the storage of the messages; there are no fixed hourly charges.</span></span>

### <a name="azure-service-bus-queues"></a><span data-ttu-id="2cac4-225">Azure Service Bus Queues</span><span class="sxs-lookup"><span data-stu-id="2cac4-225">Azure Service Bus Queues</span></span>

<span data-ttu-id="2cac4-226">Para requisitos de mensajería más complejos, tenga en cuenta las colas de Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="2cac4-226">For more complex messaging requirements, consider Azure Service Bus queues.</span></span>

<span data-ttu-id="2cac4-227">En una sólida infraestructura de mensajes, [Azure Service Bus](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-messaging-overview) admite un modelo de *mensajería intermediada.*</span><span class="sxs-lookup"><span data-stu-id="2cac4-227">Sitting atop a robust message infrastructure, [Azure Service Bus](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-messaging-overview) supports a *brokered messaging model*.</span></span> <span data-ttu-id="2cac4-228">Los mensajes se almacenan de forma fiable en un intermediario (la cola) hasta que el consumidor los recibe.</span><span class="sxs-lookup"><span data-stu-id="2cac4-228">Messages are reliably stored in a broker (the queue) until received by the consumer.</span></span> <span data-ttu-id="2cac4-229">La cola garantiza la entrega de mensajes First-In/First-Out (FIFO), respetando el orden en que se agregaron los mensajes a la cola.</span><span class="sxs-lookup"><span data-stu-id="2cac4-229">The queue guarantees First-In/First-Out (FIFO) message delivery, respecting the order in which messages were added to the queue.</span></span>

<span data-ttu-id="2cac4-230">El tamaño de un mensaje puede ser mucho mayor, hasta 256 KB.</span><span class="sxs-lookup"><span data-stu-id="2cac4-230">The size of a message can be much larger, up to 256 KB.</span></span> <span data-ttu-id="2cac4-231">Los mensajes se conservan en la cola durante un período de tiempo ilimitado.</span><span class="sxs-lookup"><span data-stu-id="2cac4-231">Messages are persisted in the queue for an unlimited period of time.</span></span> <span data-ttu-id="2cac4-232">Service Bus no solo admite llamadas basadas en HTTP, sino que también proporciona compatibilidad completa con el [protocolo AMPQ.](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-amqp-overview)</span><span class="sxs-lookup"><span data-stu-id="2cac4-232">Service Bus supports not only HTTP-based calls, but also provides full support for the [AMPQ protocol](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-amqp-overview).</span></span> <span data-ttu-id="2cac4-233">AMPQ es un estándar abierto entre proveedores que admite un protocolo binario y mayores grados de confiabilidad.</span><span class="sxs-lookup"><span data-stu-id="2cac4-233">AMPQ is an open-standard across vendors that supports a binary protocol and higher degrees of reliability.</span></span>

<span data-ttu-id="2cac4-234">Service Bus proporciona un amplio conjunto de características, incluida la [compatibilidad con transacciones](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-transactions) y una característica de [detección de duplicados.](https://docs.microsoft.com/azure/service-bus-messaging/duplicate-detection)</span><span class="sxs-lookup"><span data-stu-id="2cac4-234">Service Bus provides a rich set of features, including [transaction support](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-transactions) and a [duplicate detection feature](https://docs.microsoft.com/azure/service-bus-messaging/duplicate-detection).</span></span> <span data-ttu-id="2cac4-235">La cola garantiza "como máximo una entrega por mensaje" por mensaje.</span><span class="sxs-lookup"><span data-stu-id="2cac4-235">The queue guarantees "at most once delivery" per message.</span></span> <span data-ttu-id="2cac4-236">Descarta automáticamente un mensaje que ya se ha enviado.</span><span class="sxs-lookup"><span data-stu-id="2cac4-236">It automatically discards a message that has already been sent.</span></span> <span data-ttu-id="2cac4-237">Si un productor tiene dudas, puede volver a enviar el mismo mensaje y Service Bus garantiza que solo se procesará una copia.</span><span class="sxs-lookup"><span data-stu-id="2cac4-237">If a producer is in doubt, it can resend the same message, and Service Bus guarantees that only one copy will be processed.</span></span> <span data-ttu-id="2cac4-238">La detección de duplicados le libera de tener que construir plomería de infraestructura adicional.</span><span class="sxs-lookup"><span data-stu-id="2cac4-238">Duplicate detection frees you from  having to build additional infrastructure plumbing.</span></span>

<span data-ttu-id="2cac4-239">Otras dos características empresariales son la partición y las sesiones.</span><span class="sxs-lookup"><span data-stu-id="2cac4-239">Two more enterprise features are partitioning and sessions.</span></span> <span data-ttu-id="2cac4-240">Una cola de Service Bus convencional se controla mediante un único agente de mensajes y se almacena en un único almacén de mensajes.</span><span class="sxs-lookup"><span data-stu-id="2cac4-240">A conventional Service Bus queue is handled by a single message broker and stored in a single message store.</span></span> <span data-ttu-id="2cac4-241">Sin embargo, [la partición](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-partitioning) de Service Bus distribuye la cola entre varios agentes de mensajes y almacenes de mensajes.</span><span class="sxs-lookup"><span data-stu-id="2cac4-241">But, [Service Bus Partitioning](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-partitioning) spreads the queue across multiple message brokers and message stores.</span></span> <span data-ttu-id="2cac4-242">El rendimiento general ya no está limitado por el rendimiento de un único agente de mensajes o almacén de mensajería.</span><span class="sxs-lookup"><span data-stu-id="2cac4-242">The overall throughput is no longer limited by the performance of a single message broker or messaging store.</span></span> <span data-ttu-id="2cac4-243">Una interrupción temporal de un almacén de mensajería no hace que una cola con particiones no esté disponible.</span><span class="sxs-lookup"><span data-stu-id="2cac4-243">A temporary outage of a messaging store doesn't render a partitioned queue unavailable.</span></span>

<span data-ttu-id="2cac4-244">[Las sesiones](https://codingcanvas.com/azure-service-bus-sessions/) de Service Bus proporcionan una manera de agrupar mensajes.</span><span class="sxs-lookup"><span data-stu-id="2cac4-244">[Service Bus Sessions](https://codingcanvas.com/azure-service-bus-sessions/) provide a way to group-related messages.</span></span> <span data-ttu-id="2cac4-245">Imagine un escenario de flujo de trabajo donde los mensajes deben procesarse juntos y la operación se debe completar al final.</span><span class="sxs-lookup"><span data-stu-id="2cac4-245">Imagine a workflow scenario where messages must be processed together and the operation completed at the end.</span></span> <span data-ttu-id="2cac4-246">Para aprovecharlas, las sesiones deben habilitarse explícitamente para la cola y cada mensaje relacionado debe contener el mismo identificador de sesión.</span><span class="sxs-lookup"><span data-stu-id="2cac4-246">To take advantage, sessions must be explicitly enabled for the queue and each related messaged must contain the same session ID.</span></span>

<span data-ttu-id="2cac4-247">Sin embargo, hay algunas advertencias importantes: el tamaño de las colas de Service Bus está limitado a 80 GB, que es mucho más pequeño que lo que está disponible en las colas de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="2cac4-247">However, there are some important caveats: Service Bus queues size is limited to 80 GB, which is much smaller than what's available from store queues.</span></span> <span data-ttu-id="2cac4-248">Además, las colas de Service Bus incurren en un costo base y un cargo por operación.</span><span class="sxs-lookup"><span data-stu-id="2cac4-248">Additionally, Service Bus queues incur a base cost and charge per operation.</span></span>

<span data-ttu-id="2cac4-249">La figura 4-14 describe la arquitectura de alto nivel de una cola de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="2cac4-249">Figure 4-14 outlines the high-level architecture of a Service Bus queue.</span></span>

![Cola de Service Bus](./media/service-bus-queue.png)

<span data-ttu-id="2cac4-251">**Figura 4-14**.</span><span class="sxs-lookup"><span data-stu-id="2cac4-251">**Figure 4-14**.</span></span> <span data-ttu-id="2cac4-252">Cola de Service Bus</span><span class="sxs-lookup"><span data-stu-id="2cac4-252">Service Bus queue</span></span>

<span data-ttu-id="2cac4-253">En la figura anterior, observe la relación punto a punto.</span><span class="sxs-lookup"><span data-stu-id="2cac4-253">In the previous figure, note the point-to-point relationship.</span></span> <span data-ttu-id="2cac4-254">Dos instancias del mismo proveedor están encolando mensajes en una sola cola de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="2cac4-254">Two instances of the same provider are enqueuing messages into a single Service Bus queue.</span></span> <span data-ttu-id="2cac4-255">Cada mensaje es consumido por solo una de las tres instancias de consumidor a la derecha.</span><span class="sxs-lookup"><span data-stu-id="2cac4-255">Each message is consumed by only one of three consumer instances on the right.</span></span> <span data-ttu-id="2cac4-256">A continuación, analizamos cómo implementar la mensajería donde diferentes consumidores pueden estar interesados en el mismo mensaje.</span><span class="sxs-lookup"><span data-stu-id="2cac4-256">Next, we discuss how to implement messaging where different consumers may all be interested the same message.</span></span>

## <a name="events"></a><span data-ttu-id="2cac4-257">Eventos</span><span class="sxs-lookup"><span data-stu-id="2cac4-257">Events</span></span>

<span data-ttu-id="2cac4-258">La cola de mensajes es una forma eficaz de implementar la comunicación en la que un productor puede enviar un mensaje de forma asincrónica a un consumidor.</span><span class="sxs-lookup"><span data-stu-id="2cac4-258">Message queuing is an effective way to implement communication where a producer can asynchronously send a consumer a message.</span></span> <span data-ttu-id="2cac4-259">Sin embargo, ¿qué sucede cuando *muchos consumidores diferentes* están interesados en el mismo mensaje?</span><span class="sxs-lookup"><span data-stu-id="2cac4-259">However, what happens when *many different consumers* are interested in the same message?</span></span> <span data-ttu-id="2cac4-260">Una cola de mensajes dedicada para cada consumidor no escalaría bien y se volvería difícil de administrar.</span><span class="sxs-lookup"><span data-stu-id="2cac4-260">A dedicated message queue for each consumer wouldn't scale well and would become difficult to manage.</span></span>

<span data-ttu-id="2cac4-261">Para abordar este escenario, pasamos al tercer tipo de interacción de mensaje, el *evento*.</span><span class="sxs-lookup"><span data-stu-id="2cac4-261">To address this scenario, we move to the third type of message interaction, the *event*.</span></span> <span data-ttu-id="2cac4-262">Un microservicio anuncia que se ha producido una acción.</span><span class="sxs-lookup"><span data-stu-id="2cac4-262">One microservice announces that an action had occurred.</span></span> <span data-ttu-id="2cac4-263">Otros microservicios, si están interesados, reaccionan a la acción o al evento.</span><span class="sxs-lookup"><span data-stu-id="2cac4-263">Other microservices, if interested, react to the action, or event.</span></span>

<span data-ttu-id="2cac4-264">Los eventos son un proceso de dos pasos.</span><span class="sxs-lookup"><span data-stu-id="2cac4-264">Eventing is a two-step process.</span></span> <span data-ttu-id="2cac4-265">Para un cambio de estado determinado, un microservicio publica un evento en un agente de mensajes, lo que lo hace disponible para cualquier otro microservicio interesado.</span><span class="sxs-lookup"><span data-stu-id="2cac4-265">For a given state change, a microservice publishes an event to a message broker, making it available to any other interested microservice.</span></span> <span data-ttu-id="2cac4-266">El microservicio interesado se notifica suscribiéndose al evento en el agente de mensajes.</span><span class="sxs-lookup"><span data-stu-id="2cac4-266">The interested microservice is notified by subscribing to the event in the message broker.</span></span> <span data-ttu-id="2cac4-267">Utilice el patrón [Publicar/Suscribir](https://docs.microsoft.com/azure/architecture/patterns/publisher-subscriber) se utiliza para implementar la [comunicación basada en eventos.](https://docs.microsoft.com/dotnet/standard/microservices-architecture/multi-container-microservice-net-applications/integration-event-based-microservice-communications)</span><span class="sxs-lookup"><span data-stu-id="2cac4-267">You use the [Publish/Subscribe](https://docs.microsoft.com/azure/architecture/patterns/publisher-subscriber) pattern to implement [event-based communication](https://docs.microsoft.com/dotnet/standard/microservices-architecture/multi-container-microservice-net-applications/integration-event-based-microservice-communications).</span></span>

<span data-ttu-id="2cac4-268">En la figura 4-15 se muestra un microservicio de cesta de la compra que publica un evento con otros dos microservicios que se suscriben a él.</span><span class="sxs-lookup"><span data-stu-id="2cac4-268">Figure 4-15 shows a shopping basket microservice publishing an event with two other microservices subscribing to it.</span></span>

![Mensajería controlada por eventos](./media/event-driven-messaging.png)

<span data-ttu-id="2cac4-270">**Figura 4-15**.</span><span class="sxs-lookup"><span data-stu-id="2cac4-270">**Figure 4-15**.</span></span> <span data-ttu-id="2cac4-271">Mensajería controlada por eventos</span><span class="sxs-lookup"><span data-stu-id="2cac4-271">Event-Driven messaging</span></span>

<span data-ttu-id="2cac4-272">Observe el componente de bus de *eventos* que se encuentra en el centro del canal de comunicación.</span><span class="sxs-lookup"><span data-stu-id="2cac4-272">Note the *event bus* component that sits in the middle of the communication channel.</span></span> <span data-ttu-id="2cac4-273">Es una clase personalizada que encapsula el agente de mensajes y lo desacopla de la aplicación subyacente.</span><span class="sxs-lookup"><span data-stu-id="2cac4-273">It's a custom class that encapsulates the message broker and decouples it from the underlying application.</span></span> <span data-ttu-id="2cac4-274">Los microservicios de pedidos e inventario operan el evento de forma independiente sin tener conocimiento el uno del otro, ni el microservicio de la cesta de la compra.</span><span class="sxs-lookup"><span data-stu-id="2cac4-274">The ordering and inventory microservices independently operate the event with no knowledge of each other, nor the shopping basket microservice.</span></span> <span data-ttu-id="2cac4-275">Cuando el evento registrado se publica en el bus de eventos, actúan sobre él.</span><span class="sxs-lookup"><span data-stu-id="2cac4-275">When the registered event is published to the event bus, they act upon it.</span></span>

<span data-ttu-id="2cac4-276">Con eventos, pasamos de la tecnología de cola a *los temas.*</span><span class="sxs-lookup"><span data-stu-id="2cac4-276">With eventing, we move from queuing technology to *topics*.</span></span> <span data-ttu-id="2cac4-277">Un [tema](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions) es similar a una cola, pero admite un patrón de mensajería de uno a varios.</span><span class="sxs-lookup"><span data-stu-id="2cac4-277">A [topic](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions) is similar to a queue, but supports a one-to-many messaging pattern.</span></span> <span data-ttu-id="2cac4-278">Un microservicio publica un mensaje.</span><span class="sxs-lookup"><span data-stu-id="2cac4-278">One microservice publishes a message.</span></span> <span data-ttu-id="2cac4-279">Varios microservicios de suscripción pueden elegir recibir y actuar según ese mensaje.</span><span class="sxs-lookup"><span data-stu-id="2cac4-279">Multiple subscribing microservices can choose to receive and act upon that message.</span></span> <span data-ttu-id="2cac4-280">La Figura 4-16 muestra una arquitectura de tema.</span><span class="sxs-lookup"><span data-stu-id="2cac4-280">Figure 4-16 shows a topic architecture.</span></span>

![Arquitectura de temas](./media/topic-architecture.png)

<span data-ttu-id="2cac4-282">**Figura 4-16**.</span><span class="sxs-lookup"><span data-stu-id="2cac4-282">**Figure 4-16**.</span></span> <span data-ttu-id="2cac4-283">Arquitectura de temas</span><span class="sxs-lookup"><span data-stu-id="2cac4-283">Topic architecture</span></span>

<span data-ttu-id="2cac4-284">En la figura anterior, los editores envían mensajes al tema.</span><span class="sxs-lookup"><span data-stu-id="2cac4-284">In the previous figure, publishers send messages to the topic.</span></span> <span data-ttu-id="2cac4-285">Al final, los suscriptores reciben mensajes de suscripciones.</span><span class="sxs-lookup"><span data-stu-id="2cac4-285">At the end, subscribers receive messages from subscriptions.</span></span> <span data-ttu-id="2cac4-286">En el medio, el tema reenvía los mensajes a las suscripciones en función de un conjunto de *reglas,* que se muestran en cuadros azules oscuros.</span><span class="sxs-lookup"><span data-stu-id="2cac4-286">In the middle, the topic forwards messages to subscriptions based on a set of *rules*, shown in dark blue boxes.</span></span> <span data-ttu-id="2cac4-287">Las reglas actúan como un filtro que reenvía mensajes específicos a una suscripción.</span><span class="sxs-lookup"><span data-stu-id="2cac4-287">Rules act as a filter that forward specific messages to a subscription.</span></span> <span data-ttu-id="2cac4-288">Aquí, se enviaría un evento "CreateOrder" a la Suscripción \#1 y a la Suscripción \#3, pero no a la Suscripción \#2.</span><span class="sxs-lookup"><span data-stu-id="2cac4-288">Here, a "CreateOrder" event would be sent to Subscription \#1 and Subscription \#3, but not to Subscription \#2.</span></span> <span data-ttu-id="2cac4-289">Se enviará un evento "OrderCompleted" a la Suscripción \#2 y a la Suscripción \#3.</span><span class="sxs-lookup"><span data-stu-id="2cac4-289">An "OrderCompleted" event would be sent to Subscription \#2 and Subscription \#3.</span></span>

<span data-ttu-id="2cac4-290">La nube de Azure admite dos servicios de temas diferentes: Temas de Azure Service Bus y Azure EventGrid.</span><span class="sxs-lookup"><span data-stu-id="2cac4-290">The Azure cloud supports two different topic services: Azure Service Bus Topics and Azure EventGrid.</span></span>

### <a name="azure-service-bus-topics"></a><span data-ttu-id="2cac4-291">Azure Service Bus Topics</span><span class="sxs-lookup"><span data-stu-id="2cac4-291">Azure Service Bus Topics</span></span>

<span data-ttu-id="2cac4-292">En la parte superior del mismo modelo de mensajes de intermediario robusto de las colas de Azure Service Bus se encuentran Temas de [Azure Service Bus.](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions)</span><span class="sxs-lookup"><span data-stu-id="2cac4-292">Sitting on top of the same robust brokered message model of Azure Service Bus queues are [Azure Service Bus Topics](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions).</span></span> <span data-ttu-id="2cac4-293">Un tema puede recibir mensajes de varios editores independientes y enviar mensajes a hasta 2.000 suscriptores.</span><span class="sxs-lookup"><span data-stu-id="2cac4-293">A topic can receive messages from multiple independent publishers and send messages to up to 2,000 subscribers.</span></span> <span data-ttu-id="2cac4-294">Las suscripciones se pueden agregar o quitar dinámicamente en tiempo de ejecución sin detener el sistema ni volver a crear el tema.</span><span class="sxs-lookup"><span data-stu-id="2cac4-294">Subscriptions can be dynamically added or removed at runtime without stopping the system or recreating the topic.</span></span>

<span data-ttu-id="2cac4-295">Muchas características avanzadas de las colas de Azure Service Bus también están disponibles para temas, como Detección de [duplicados](https://docs.microsoft.com/azure/service-bus-messaging/duplicate-detection) y [Compatibilidad con transacciones.](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-transactions)</span><span class="sxs-lookup"><span data-stu-id="2cac4-295">Many advanced features from Azure Service Bus queues are also available for topics, including [Duplicate Detection](https://docs.microsoft.com/azure/service-bus-messaging/duplicate-detection) and [Transaction support](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-transactions).</span></span> <span data-ttu-id="2cac4-296">De forma predeterminada, los temas de Service Bus se controlan mediante un único agente de mensajes y se almacenan en un único almacén de mensajes.</span><span class="sxs-lookup"><span data-stu-id="2cac4-296">By default, Service Bus topics are handled by a single message broker and stored in a single message store.</span></span> <span data-ttu-id="2cac4-297">Sin más, [Service Bus Partitioning](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-partitioning) escala un tema al distribuirlo entre muchos agentes de mensajes y almacenes de mensajes.</span><span class="sxs-lookup"><span data-stu-id="2cac4-297">But, [Service Bus Partitioning](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-partitioning) scales a topic by spreading it across many message brokers and message stores.</span></span>

<span data-ttu-id="2cac4-298">[Entrega de mensajes programada](https://docs.microsoft.com/azure/service-bus-messaging/message-sequencing) etiqueta un mensaje con una hora específica para el procesamiento.</span><span class="sxs-lookup"><span data-stu-id="2cac4-298">[Scheduled Message Delivery](https://docs.microsoft.com/azure/service-bus-messaging/message-sequencing) tags a message with a specific time for processing.</span></span> <span data-ttu-id="2cac4-299">El mensaje no aparecerá en el tema antes de esa hora.</span><span class="sxs-lookup"><span data-stu-id="2cac4-299">The message won't appear in the topic before that time.</span></span> <span data-ttu-id="2cac4-300">[Aplazamiento de](https://docs.microsoft.com/azure/service-bus-messaging/message-deferral) mensajes le permite aplazar una recuperación de un mensaje a un momento posterior.</span><span class="sxs-lookup"><span data-stu-id="2cac4-300">[Message Deferral](https://docs.microsoft.com/azure/service-bus-messaging/message-deferral) enables you to defer a retrieval of a message to a later time.</span></span> <span data-ttu-id="2cac4-301">Ambos se utilizan normalmente en escenarios de procesamiento de flujo de trabajo donde las operaciones se procesan en un orden determinado.</span><span class="sxs-lookup"><span data-stu-id="2cac4-301">Both are commonly used in workflow processing scenarios where operations are processed in a particular order.</span></span> <span data-ttu-id="2cac4-302">Puede posponer el procesamiento de los mensajes recibidos hasta que se haya completado el trabajo anterior.</span><span class="sxs-lookup"><span data-stu-id="2cac4-302">You can postpone processing of received messages until prior work has been completed.</span></span>

<span data-ttu-id="2cac4-303">Los temas de Service Bus son una tecnología sólida y probada para permitir la comunicación de publicación/suscripción en sus sistemas nativos de la nube.</span><span class="sxs-lookup"><span data-stu-id="2cac4-303">Service Bus topics are a robust and proven technology for enabling publish/subscribe communication in your cloud-native systems.</span></span>

### <a name="azure-event-grid"></a><span data-ttu-id="2cac4-304">Azure Event Grid</span><span class="sxs-lookup"><span data-stu-id="2cac4-304">Azure Event Grid</span></span>

<span data-ttu-id="2cac4-305">Aunque Azure Service Bus es un agente de mensajería probado en batalla con un conjunto completo de características empresariales, [Azure Event Grid](https://docs.microsoft.com/azure/event-grid/overview) es el nuevo niño del bloque.</span><span class="sxs-lookup"><span data-stu-id="2cac4-305">While Azure Service Bus is a battle-tested messaging broker with a full set of enterprise features, [Azure Event Grid](https://docs.microsoft.com/azure/event-grid/overview) is the new kid on the block.</span></span>

<span data-ttu-id="2cac4-306">A primera vista, Event Grid puede parecerse a otro sistema de mensajería basado en temas.</span><span class="sxs-lookup"><span data-stu-id="2cac4-306">At first glance, Event Grid may look like just another topic-based messaging system.</span></span> <span data-ttu-id="2cac4-307">Sin embargo, es diferente en muchos sentidos.</span><span class="sxs-lookup"><span data-stu-id="2cac4-307">However, it's different in many ways.</span></span> <span data-ttu-id="2cac4-308">Centrado en cargas de trabajo controladas por eventos, permite el procesamiento de eventos en tiempo real, la integración profunda de Azure y una plataforma abierta, todo en infraestructura sin servidor.</span><span class="sxs-lookup"><span data-stu-id="2cac4-308">Focused on event-driven workloads, it enables real-time event processing, deep Azure integration, and an open-platform - all on serverless infrastructure.</span></span> <span data-ttu-id="2cac4-309">Está diseñado para aplicaciones nativas de la nube y sin servidor contemporáneas</span><span class="sxs-lookup"><span data-stu-id="2cac4-309">It's designed for contemporary cloud-native and serverless applications</span></span>

<span data-ttu-id="2cac4-310">Como backplane o *canalización*de eventos centralizados, Event Grid reacciona a eventos dentro de los recursos de Azure y desde sus propios servicios.</span><span class="sxs-lookup"><span data-stu-id="2cac4-310">As a centralized *eventing backplane*, or pipe, Event Grid reacts to events inside Azure resources and from your own services.</span></span>

<span data-ttu-id="2cac4-311">Las notificaciones de eventos se publican en un tema de Event Grid, que, a su vez, enruta cada evento a una suscripción.</span><span class="sxs-lookup"><span data-stu-id="2cac4-311">Event notifications are published to an Event Grid Topic, which, in turn, routes each event to a subscription.</span></span> <span data-ttu-id="2cac4-312">Los suscriptores se asignan a suscripciones y consumen los eventos.</span><span class="sxs-lookup"><span data-stu-id="2cac4-312">Subscribers map to subscriptions and consume the events.</span></span> <span data-ttu-id="2cac4-313">Al igual que Service Bus, Event Grid admite un modelo de *suscriptor filtrado* donde una suscripción establece una regla para los eventos que desea recibir.</span><span class="sxs-lookup"><span data-stu-id="2cac4-313">Like Service Bus, Event Grid supports a *filtered subscriber model* where a subscription sets rule for the events it wishes to receive.</span></span> <span data-ttu-id="2cac4-314">Event Grid proporciona un rendimiento rápido con una garantía de 10 millones de eventos por segundo que permite la entrega casi en tiempo real, mucho más de lo que Azure Service Bus puede generar.</span><span class="sxs-lookup"><span data-stu-id="2cac4-314">Event Grid provides fast throughput with a guarantee of 10 million events per second enabling near real-time delivery - far more than what Azure Service Bus can generate.</span></span>

<span data-ttu-id="2cac4-315">Un punto dulce para Event Grid es su profunda integración en el tejido de la infraestructura de Azure.</span><span class="sxs-lookup"><span data-stu-id="2cac4-315">A sweet spot for Event Grid is its deep integration into the fabric of Azure infrastructure.</span></span> <span data-ttu-id="2cac4-316">Un recurso de Azure, como Cosmos DB, puede publicar eventos integrados directamente en otros recursos de Azure interesados, sin necesidad de código personalizado.</span><span class="sxs-lookup"><span data-stu-id="2cac4-316">An Azure resource, such as Cosmos DB, can publish built-in events directly to other interested Azure resources - without the need for custom code.</span></span> <span data-ttu-id="2cac4-317">Event Grid puede publicar eventos desde una suscripción de Azure, un grupo de recursos o un servicio, lo que proporciona a los desarrolladores un control detallado sobre el ciclo de vida de los recursos en la nube.</span><span class="sxs-lookup"><span data-stu-id="2cac4-317">Event Grid can publish events from an Azure Subscription, Resource Group, or Service, giving developers fine-grained control over the lifecycle of cloud resources.</span></span> <span data-ttu-id="2cac4-318">Sin embargo, Event Grid no se limita a Azure., Event Grid is't limited to Azure.</span><span class="sxs-lookup"><span data-stu-id="2cac4-318">However, Event Grid isn't limited to Azure.</span></span> <span data-ttu-id="2cac4-319">Es una plataforma abierta que puede consumir eventos HTTP personalizados publicados desde aplicaciones o servicios de terceros y enrutar eventos a suscriptores externos.</span><span class="sxs-lookup"><span data-stu-id="2cac4-319">It's an open platform that can consume custom HTTP events published from applications or third-party services and route events to external subscribers.</span></span>

<span data-ttu-id="2cac4-320">Al publicar y suscribirse a eventos nativos desde recursos de Azure, no se requiere codificación.</span><span class="sxs-lookup"><span data-stu-id="2cac4-320">When publishing and subscribing to native events from Azure resources, no coding is required.</span></span> <span data-ttu-id="2cac4-321">Con una configuración sencilla, puede integrar eventos de un recurso de Azure a otro aprovechando la plomería integrada para temas y suscripciones.</span><span class="sxs-lookup"><span data-stu-id="2cac4-321">With simple configuration, you can integrate events from one Azure resource to another leveraging built-in plumbing for Topics and Subscriptions.</span></span> <span data-ttu-id="2cac4-322">La Figura 4-17 muestra la anatomía de Event Grid.</span><span class="sxs-lookup"><span data-stu-id="2cac4-322">Figure 4-17 shows the anatomy of Event Grid.</span></span>

![Anatomía de Event Grid](./media/event-grid-anatomy.png)

<span data-ttu-id="2cac4-324">**Figura 4-17**.</span><span class="sxs-lookup"><span data-stu-id="2cac4-324">**Figure 4-17**.</span></span> <span data-ttu-id="2cac4-325">Anatomía de Event Grid</span><span class="sxs-lookup"><span data-stu-id="2cac4-325">Event Grid anatomy</span></span>

<span data-ttu-id="2cac4-326">Una diferencia importante entre EventGrid y Service Bus es el *patrón*de intercambio de mensajes subyacente.</span><span class="sxs-lookup"><span data-stu-id="2cac4-326">A major difference between EventGrid and Service Bus is the underlying *message exchange pattern*.</span></span>

<span data-ttu-id="2cac4-327">Service Bus implementa un modelo de *extracción* de estilo anterior en el que el suscriptor de nivel inferior sondea activamente la suscripción de tema para los mensajes nuevos.</span><span class="sxs-lookup"><span data-stu-id="2cac4-327">Service Bus implements an older style *pull model* in which the downstream subscriber actively polls the topic subscription for new messages.</span></span> <span data-ttu-id="2cac4-328">En el lado positivo, este enfoque da al suscriptor el control total del ritmo al que procesa los mensajes.</span><span class="sxs-lookup"><span data-stu-id="2cac4-328">On the upside, this approach gives the subscriber full control of the pace at which it processes messages.</span></span> <span data-ttu-id="2cac4-329">Controla cuándo y cuántos mensajes procesar en un momento dado.</span><span class="sxs-lookup"><span data-stu-id="2cac4-329">It controls when and how many messages to process at any given time.</span></span> <span data-ttu-id="2cac4-330">Los mensajes no leídos permanecen en la suscripción hasta que se procesan.</span><span class="sxs-lookup"><span data-stu-id="2cac4-330">Unread messages remain in the subscription until processed.</span></span> <span data-ttu-id="2cac4-331">Una deficiencia significativa es la latencia entre el momento en que se genera el evento y la operación de sondeo que extrae ese mensaje al suscriptor para su procesamiento.</span><span class="sxs-lookup"><span data-stu-id="2cac4-331">A significant shortcoming is the latency between the time the event is generated and the polling operation that pulls that message to the subscriber for processing.</span></span> <span data-ttu-id="2cac4-332">Además, la sobrecarga del sondeo constante para el próximo evento consume recursos y dinero.</span><span class="sxs-lookup"><span data-stu-id="2cac4-332">Also, the overhead of constant polling for the next event consumes resources and money.</span></span>

<span data-ttu-id="2cac4-333">EventGrid, sin embargo, es diferente.</span><span class="sxs-lookup"><span data-stu-id="2cac4-333">EventGrid, however, is different.</span></span> <span data-ttu-id="2cac4-334">Implementa un modelo de *inserción* en el que los eventos se envían a los EventHandlers tal como se reciben, lo que proporciona una entrega de eventos casi en tiempo real.</span><span class="sxs-lookup"><span data-stu-id="2cac4-334">It implements a *push model* in which events are sent to the EventHandlers as received, giving near real-time event delivery.</span></span> <span data-ttu-id="2cac4-335">También reduce el costo, ya que el servicio se desencadena solo cuando es necesario consumir un evento, no continuamente como con el sondeo.</span><span class="sxs-lookup"><span data-stu-id="2cac4-335">It also reduces cost as the service is triggered only when it's needed to consume an event – not continually as with polling.</span></span> <span data-ttu-id="2cac4-336">Dicho esto, un controlador de eventos debe controlar la carga entrante y proporcionar mecanismos de limitación para protegerse de verse abrumado.</span><span class="sxs-lookup"><span data-stu-id="2cac4-336">That said, an event handler must handle the incoming load and provide throttling mechanisms to protect itself from becoming overwhelmed.</span></span> <span data-ttu-id="2cac4-337">Muchos servicios de Azure que consumen estos eventos, como Azure Functions y Logic Apps, proporcionan capacidades de escalado automático para controlar el aumento de las cargas.</span><span class="sxs-lookup"><span data-stu-id="2cac4-337">Many Azure services that consume these events, such as Azure Functions and Logic Apps provide automatic autoscaling capabilities to handle increased loads.</span></span>  

<span data-ttu-id="2cac4-338">Event Grid es un servicio en la nube sin servidor totalmente administrado.</span><span class="sxs-lookup"><span data-stu-id="2cac4-338">Event Grid is a fully managed serverless cloud service.</span></span> <span data-ttu-id="2cac4-339">Se escala dinámicamente en función de su tráfico y le cobra solo por su uso real, no por la capacidad precomprada.</span><span class="sxs-lookup"><span data-stu-id="2cac4-339">It dynamically scales based on your traffic and charges you only for your actual usage, not pre-purchased capacity.</span></span> <span data-ttu-id="2cac4-340">Las primeras 100.000 operaciones al mes son gratuitas: las operaciones que se definen como entrada de eventos (notificaciones de eventos entrantes), intentos de entrega de suscripciones, llamadas de administración y filtrado por sujeto.</span><span class="sxs-lookup"><span data-stu-id="2cac4-340">The first 100,000 operations per month are free – operations being defined as event ingress (incoming event notifications), subscription delivery attempts, management calls, and filtering by subject.</span></span> <span data-ttu-id="2cac4-341">Con una disponibilidad del 99,99 %, EventGrid garantiza la entrega de un evento en un período de 24 horas, con funcionalidad de reintento integrada para una entrega sin éxito.</span><span class="sxs-lookup"><span data-stu-id="2cac4-341">With 99.99% availability, EventGrid guarantees the delivery of an event within a 24-hour period, with built-in retry functionality for unsuccessful delivery.</span></span> <span data-ttu-id="2cac4-342">Los mensajes no entregados se pueden mover a una cola de "letra muerta" para su resolución.</span><span class="sxs-lookup"><span data-stu-id="2cac4-342">Undelivered messages can be moved to a "dead-letter" queue for resolution.</span></span>  <span data-ttu-id="2cac4-343">A diferencia de Azure Service Bus, Event Grid está optimizado para un rendimiento rápido y no admite características como mensajería ordenada, transacciones y sesiones.</span><span class="sxs-lookup"><span data-stu-id="2cac4-343">Unlike Azure Service Bus, Event Grid is tuned for fast performance and doesn't support features like ordered messaging, transactions, and sessions.</span></span>

### <a name="streaming-messages-in-the-azure-cloud"></a><span data-ttu-id="2cac4-344">Transmisión de mensajes en la nube de Azure</span><span class="sxs-lookup"><span data-stu-id="2cac4-344">Streaming messages in the Azure cloud</span></span>

<span data-ttu-id="2cac4-345">Azure Service Bus y Event Grid proporcionan una excelente compatibilidad para las aplicaciones que exponen eventos únicos y discretos, como si se ha insertado un nuevo documento en Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="2cac4-345">Azure Service Bus and Event Grid provide great support for applications that expose single, discrete events like a new document has been inserted into a Cosmos DB.</span></span> <span data-ttu-id="2cac4-346">Pero, ¿qué sucede si el sistema nativo de la nube necesita procesar una *secuencia de eventos relacionados?*</span><span class="sxs-lookup"><span data-stu-id="2cac4-346">But, what if your cloud-native system needs to process a *stream of related events*?</span></span> <span data-ttu-id="2cac4-347">Las secuencias de eventos son más [complejas.](https://docs.microsoft.com/archive/msdn-magazine/2015/february/microsoft-azure-the-rise-of-event-stream-oriented-systems)</span><span class="sxs-lookup"><span data-stu-id="2cac4-347">[Event streams](https://docs.microsoft.com/archive/msdn-magazine/2015/february/microsoft-azure-the-rise-of-event-stream-oriented-systems) are more complex.</span></span> <span data-ttu-id="2cac4-348">Normalmente están ordenados en el tiempo, interrelacionados y deben procesarse como un grupo.</span><span class="sxs-lookup"><span data-stu-id="2cac4-348">They're typically time-ordered, interrelated, and must be processed as a group.</span></span>

<span data-ttu-id="2cac4-349">[Azure Event Hub](https://azure.microsoft.com/services/event-hubs/) es una plataforma de streaming de datos y un servicio de ingesta de eventos que recopila, transforma y almacena eventos.</span><span class="sxs-lookup"><span data-stu-id="2cac4-349">[Azure Event Hub](https://azure.microsoft.com/services/event-hubs/) is a data streaming platform and event ingestion service that collects, transforms, and stores events.</span></span> <span data-ttu-id="2cac4-350">Está ajustado para capturar datos de streaming, como notificaciones de eventos continuas emitidas desde un contexto de telemetría.</span><span class="sxs-lookup"><span data-stu-id="2cac4-350">It's fine-tuned to capture streaming data, such as continuous event notifications emitted from a telemetry context.</span></span> <span data-ttu-id="2cac4-351">El servicio es altamente escalable y puede almacenar y [procesar millones de eventos por segundo.](https://docs.microsoft.com/azure/event-hubs/event-hubs-about)</span><span class="sxs-lookup"><span data-stu-id="2cac4-351">The service is highly scalable and can store and [process millions of events per second](https://docs.microsoft.com/azure/event-hubs/event-hubs-about).</span></span> <span data-ttu-id="2cac4-352">Se muestra en la Figura 4-18, a menudo es una puerta principal para una tubería de eventos, desacoplando la corriente de ingesta del consumo de eventos.</span><span class="sxs-lookup"><span data-stu-id="2cac4-352">Shown in Figure 4-18, it's often a front door for an event pipeline, decoupling ingest stream from event consumption.</span></span>

![Centro de eventos de Azure](./media/azure-event-hub.png)

<span data-ttu-id="2cac4-354">**Figura 4-18**.</span><span class="sxs-lookup"><span data-stu-id="2cac4-354">**Figure 4-18**.</span></span> <span data-ttu-id="2cac4-355">Centro de eventos de Azure</span><span class="sxs-lookup"><span data-stu-id="2cac4-355">Azure Event Hub</span></span>

<span data-ttu-id="2cac4-356">Event Hub admite baja latencia y retención de tiempo configurable.</span><span class="sxs-lookup"><span data-stu-id="2cac4-356">Event Hub supports low latency and configurable time retention.</span></span> <span data-ttu-id="2cac4-357">A diferencia de las colas y los temas, event Hubs mantienen los datos de eventos después de que un consumidor los haya leído.</span><span class="sxs-lookup"><span data-stu-id="2cac4-357">Unlike queues and topics, Event Hubs keep event data after it's been read by a consumer.</span></span> <span data-ttu-id="2cac4-358">Esta característica permite que otros servicios analíticos de datos, tanto internos como externos, reproduzcan los datos para su posterior análisis.</span><span class="sxs-lookup"><span data-stu-id="2cac4-358">This feature enables other data analytic services, both internal and external, to replay the data for further analysis.</span></span> <span data-ttu-id="2cac4-359">Los eventos almacenados en el centro de eventos solo se eliminan al expirar el período de retención, que es un día de forma predeterminada, pero configurable.</span><span class="sxs-lookup"><span data-stu-id="2cac4-359">Events stored in event hub are only deleted upon expiration of the retention period, which is one day by default, but configurable.</span></span>

<span data-ttu-id="2cac4-360">Event Hub admite protocolos de publicación de eventos comunes, incluidos HTTPS y AMQP.</span><span class="sxs-lookup"><span data-stu-id="2cac4-360">Event Hub supports common event publishing protocols including HTTPS and AMQP.</span></span> <span data-ttu-id="2cac4-361">También es compatible con Kafka 1.0.</span><span class="sxs-lookup"><span data-stu-id="2cac4-361">It also supports Kafka 1.0.</span></span> <span data-ttu-id="2cac4-362">[Las aplicaciones kafka existentes pueden comunicarse con Event Hub](https://docs.microsoft.com/azure/event-hubs/event-hubs-for-kafka-ecosystem-overview) mediante el protocolo Kafka que proporciona una alternativa a la administración de clústeres kafka grandes.</span><span class="sxs-lookup"><span data-stu-id="2cac4-362">[Existing Kafka applications can communicate with Event Hub](https://docs.microsoft.com/azure/event-hubs/event-hubs-for-kafka-ecosystem-overview) using the Kafka protocol providing an alternative to managing large Kafka clusters.</span></span> <span data-ttu-id="2cac4-363">Muchos sistemas nativos de nube de código abierto adoptan Kafka.</span><span class="sxs-lookup"><span data-stu-id="2cac4-363">Many open-source cloud-native systems embrace Kafka.</span></span>

<span data-ttu-id="2cac4-364">Event Hubs implementa el streaming de mensajes a través de un modelo de [consumidor con particiones](https://docs.microsoft.com/azure/event-hubs/event-hubs-features) en el que cada consumidor solo lee un subconjunto o partición específico de la secuencia de mensajes.</span><span class="sxs-lookup"><span data-stu-id="2cac4-364">Event Hubs implements message streaming through a [partitioned consumer model](https://docs.microsoft.com/azure/event-hubs/event-hubs-features) in which each consumer only reads a specific subset, or partition, of the message stream.</span></span> <span data-ttu-id="2cac4-365">Este patrón permite una gran escala horizontal para procesamiento de eventos y proporciona otras características centradas en secuencias que no están disponibles en colas y temas.</span><span class="sxs-lookup"><span data-stu-id="2cac4-365">This pattern enables tremendous horizontal scale for event processing and provides other stream-focused features that are unavailable in queues and topics.</span></span> <span data-ttu-id="2cac4-366">Una partición es una secuencia ordenada de eventos que se mantiene en un centro de eventos.</span><span class="sxs-lookup"><span data-stu-id="2cac4-366">A partition is an ordered sequence of events that is held in an event hub.</span></span> <span data-ttu-id="2cac4-367">A medida que llegan los eventos más recientes, se agregan al final de esta secuencia.</span><span class="sxs-lookup"><span data-stu-id="2cac4-367">As newer events arrive, they're added to the end of this sequence.</span></span><span data-ttu-id="2cac4-368">La figura 4-19 muestra la creación de particiones en un centro de eventos.</span><span class="sxs-lookup"><span data-stu-id="2cac4-368"> Figure 4-19 shows partitioning in an Event Hub.</span></span>

![Partición del centro de eventos](./media/event-hub-partitioning.png)

<span data-ttu-id="2cac4-370">**Figura 4-19**.</span><span class="sxs-lookup"><span data-stu-id="2cac4-370">**Figure 4-19**.</span></span> <span data-ttu-id="2cac4-371">Partición del centro de eventos</span><span class="sxs-lookup"><span data-stu-id="2cac4-371">Event Hub partitioning</span></span>

<span data-ttu-id="2cac4-372">En lugar de leer desde el mismo recurso, cada grupo de consumidores lee en un subconjunto o partición de la secuencia de mensajes.</span><span class="sxs-lookup"><span data-stu-id="2cac4-372">Instead of reading from the same resource, each consumer group reads across a subset, or partition, of the message stream.</span></span>

<span data-ttu-id="2cac4-373">Para las aplicaciones nativas de la nube que deben transmitir un gran número de eventos, Azure Event Hub puede ser una solución sólida y asequible.</span><span class="sxs-lookup"><span data-stu-id="2cac4-373">For cloud-native applications that must stream large numbers of events, Azure Event Hub can be a robust and affordable solution.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="2cac4-374">[Anterior](front-end-communication.md)
>[Siguiente](rest-grpc.md)</span><span class="sxs-lookup"><span data-stu-id="2cac4-374">[Previous](front-end-communication.md)
[Next](rest-grpc.md)</span></span>
