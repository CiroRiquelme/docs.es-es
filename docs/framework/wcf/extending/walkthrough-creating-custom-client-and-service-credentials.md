---
title: 'Tutorial: Crear credenciales de cliente y servicio personalizadas'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 2b5ba5c3-0c6c-48e9-9e46-54acaec443ba
ms.openlocfilehash: ddd9f03e26f7a8345f1070715e4877c533c361fb
ms.sourcegitcommit: 59e36e65ac81cdd094a5a84617625b2a0ff3506e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/27/2020
ms.locfileid: "80345266"
---
# <a name="walkthrough-creating-custom-client-and-service-credentials"></a><span data-ttu-id="20c75-102">Tutorial: Crear credenciales de cliente y servicio personalizadas</span><span class="sxs-lookup"><span data-stu-id="20c75-102">Walkthrough: Creating Custom Client and Service Credentials</span></span>

<span data-ttu-id="20c75-103">En este tema se muestra cómo implementar credenciales de cliente y servicio personalizadas y cómo utilizar las credenciales personalizadas desde el código de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="20c75-103">This topic shows how to implement custom client and service credentials and how to use custom credentials from application code.</span></span>

## <a name="credentials-extensibility-classes"></a><span data-ttu-id="20c75-104">Clases de extensibilidad de credenciales</span><span class="sxs-lookup"><span data-stu-id="20c75-104">Credentials Extensibility Classes</span></span>

<span data-ttu-id="20c75-105">Las <xref:System.ServiceModel.Description.ClientCredentials> <xref:System.ServiceModel.Description.ServiceCredentials> clases y son los puntos de entrada principales a la extensibilidad de seguridad de Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="20c75-105">The <xref:System.ServiceModel.Description.ClientCredentials> and <xref:System.ServiceModel.Description.ServiceCredentials> classes are the main entry points to the Windows Communication Foundation (WCF) security extensibility.</span></span> <span data-ttu-id="20c75-106">Estas clases de credenciales proporcionan las API que permiten al código de la aplicación establecer información de las credenciales y convertir los tipos de credenciales en tokens de seguridad.</span><span class="sxs-lookup"><span data-stu-id="20c75-106">These credentials classes provide the APIs that enable application code to set credentials information and to convert credential types into security tokens.</span></span> <span data-ttu-id="20c75-107">(*Los tokens* de seguridad son el formulario utilizado para transmitir información de credenciales dentro de mensajes SOAP.) Las responsabilidades de estas clases de credenciales se pueden dividir en dos áreas:</span><span class="sxs-lookup"><span data-stu-id="20c75-107">(*Security tokens* are the form used to transmit credential information inside SOAP messages.) The responsibilities of these credentials classes can be divided into two areas:</span></span>

- <span data-ttu-id="20c75-108">Proporcione las API para que las aplicaciones establezcan la información de las credenciales.</span><span class="sxs-lookup"><span data-stu-id="20c75-108">Provide the APIs for applications to set credentials information.</span></span>

- <span data-ttu-id="20c75-109">Haga las funciones de un generador para las implementaciones de <xref:System.IdentityModel.Selectors.SecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="20c75-109">Perform as a factory for <xref:System.IdentityModel.Selectors.SecurityTokenManager> implementations.</span></span>

<span data-ttu-id="20c75-110">Las implementaciones predeterminadas proporcionadas en WCF admiten los tipos de credenciales proporcionados por el sistema y crean un administrador de tokens de seguridad que sea capaz de controlar esos tipos de credenciales.</span><span class="sxs-lookup"><span data-stu-id="20c75-110">The default implementations provided in WCF support the system-provided credential types and create a security token manager that is capable of handling those credentials types.</span></span>

## <a name="reasons-to-customize"></a><span data-ttu-id="20c75-111">Razones para personalizar</span><span class="sxs-lookup"><span data-stu-id="20c75-111">Reasons to Customize</span></span>

<span data-ttu-id="20c75-112">Hay varias razones para personalizar las clases de credenciales de cliente o servicio.</span><span class="sxs-lookup"><span data-stu-id="20c75-112">There are multiple reasons for customizing either client or service credential classes.</span></span> <span data-ttu-id="20c75-113">En primer lugar es el requisito de cambiar el comportamiento de seguridad de WCF predeterminado con respecto al control de tipos de credenciales proporcionados por el sistema, especialmente por las siguientes razones:</span><span class="sxs-lookup"><span data-stu-id="20c75-113">Foremost is the requirement to change the default WCF security behavior with regard to handling system-provided credential types, especially for the following reasons:</span></span>

- <span data-ttu-id="20c75-114">Cambios que no son posibles mediante otros puntos de extensibilidad.</span><span class="sxs-lookup"><span data-stu-id="20c75-114">Changes that are not possible using other extensibility points.</span></span>

- <span data-ttu-id="20c75-115">Agregar nuevos tipos de credenciales.</span><span class="sxs-lookup"><span data-stu-id="20c75-115">Adding new credential types.</span></span>

- <span data-ttu-id="20c75-116">Agregar nuevos tipos de tokens de seguridad personalizados.</span><span class="sxs-lookup"><span data-stu-id="20c75-116">Adding new custom security token types.</span></span>

<span data-ttu-id="20c75-117">En este tema se describe cómo implementar credenciales de cliente y servicio personalizadas y cómo utilizarlas desde el código de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="20c75-117">This topic describes how to implement custom client and service credentials and how to use them from application code.</span></span>

## <a name="first-in-a-series"></a><span data-ttu-id="20c75-118">Primero en una serie</span><span class="sxs-lookup"><span data-stu-id="20c75-118">First in a Series</span></span>

<span data-ttu-id="20c75-119">Crear una clase de credenciales personalizadas es solo el primer paso, porque la razón para personalizar las credenciales es cambiar el comportamiento de WCF con respecto al aprovisionamiento de credenciales, la serialización de tokens de seguridad o la autenticación.</span><span class="sxs-lookup"><span data-stu-id="20c75-119">Creating a custom credentials class is only the first step, because the reason for customizing credentials is to change WCF behavior regarding credentials provisioning, security token serialization, or authentication.</span></span> <span data-ttu-id="20c75-120">Otros temas en esta sección describen cómo crear serializadores y autenticadores personalizados.</span><span class="sxs-lookup"><span data-stu-id="20c75-120">Other topics in this section describe how to create custom serializers and authenticators.</span></span> <span data-ttu-id="20c75-121">En este aspecto, crear la clase de credenciales personalizada es el primer tema de la serie.</span><span class="sxs-lookup"><span data-stu-id="20c75-121">In this regard, creating custom credential class is the first topic in the series.</span></span> <span data-ttu-id="20c75-122">Las acciones subsiguientes (crear serializadores y autenticadores personalizados) sólo se pueden hacer después de crear las credenciales personalizadas.</span><span class="sxs-lookup"><span data-stu-id="20c75-122">Subsequent actions (creating custom serializers and authenticators) can be done only after creating custom credentials.</span></span> <span data-ttu-id="20c75-123">Entre los temas adicionales que se generan a partir de este tema se incluyen:</span><span class="sxs-lookup"><span data-stu-id="20c75-123">Additional topics that build upon this topic include:</span></span>

- [<span data-ttu-id="20c75-124">Procedimiento para crear un proveedor de tokens de seguridad personalizado</span><span class="sxs-lookup"><span data-stu-id="20c75-124">How to: Create a Custom Security Token Provider</span></span>](how-to-create-a-custom-security-token-provider.md)

- [<span data-ttu-id="20c75-125">Procedimiento para crear un autenticador de tokens de seguridad personalizado</span><span class="sxs-lookup"><span data-stu-id="20c75-125">How to: Create a Custom Security Token Authenticator</span></span>](how-to-create-a-custom-security-token-authenticator.md)

- <span data-ttu-id="20c75-126">[Cómo: Crear un token personalizado](how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="20c75-126">[How to: Create a Custom Token](how-to-create-a-custom-token.md).</span></span>

## <a name="procedures"></a><span data-ttu-id="20c75-127">Procedimientos</span><span class="sxs-lookup"><span data-stu-id="20c75-127">Procedures</span></span>

#### <a name="to-implement-custom-client-credentials"></a><span data-ttu-id="20c75-128">Para implementar credenciales de cliente personalizadas</span><span class="sxs-lookup"><span data-stu-id="20c75-128">To implement custom client credentials</span></span>

1. <span data-ttu-id="20c75-129">Defina una clase nueva derivada de la clase <xref:System.ServiceModel.Description.ClientCredentials>.</span><span class="sxs-lookup"><span data-stu-id="20c75-129">Define a new class derived from the <xref:System.ServiceModel.Description.ClientCredentials> class.</span></span>

2. <span data-ttu-id="20c75-130">Opcional.</span><span class="sxs-lookup"><span data-stu-id="20c75-130">Optional.</span></span> <span data-ttu-id="20c75-131">Agregue nuevos métodos o propiedades para los nuevos tipos de credenciales.</span><span class="sxs-lookup"><span data-stu-id="20c75-131">Add new methods or properties for new credential types.</span></span> <span data-ttu-id="20c75-132">Si no agrega nuevos tipos de credencial, no realice este paso.</span><span class="sxs-lookup"><span data-stu-id="20c75-132">If you do not add new credential types, skip this step.</span></span> <span data-ttu-id="20c75-133">En el ejemplo siguiente se agrega una propiedad `CreditCardNumber`.</span><span class="sxs-lookup"><span data-stu-id="20c75-133">The following example adds a `CreditCardNumber` property.</span></span>

3. <span data-ttu-id="20c75-134">Invalide el método <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> .</span><span class="sxs-lookup"><span data-stu-id="20c75-134">Override the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method.</span></span> <span data-ttu-id="20c75-135">La infraestructura de seguridad WCF llama automáticamente a este método cuando se usa la credencial de cliente personalizada.</span><span class="sxs-lookup"><span data-stu-id="20c75-135">This method is automatically called by WCF security infrastructure when the custom client credential is used.</span></span> <span data-ttu-id="20c75-136">Este método es responsable de crear y devolver una instancia de una implementación de la clase <xref:System.IdentityModel.Selectors.SecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="20c75-136">This method is responsible for creating and returning an instance of an implementation of the <xref:System.IdentityModel.Selectors.SecurityTokenManager> class.</span></span>

    > [!IMPORTANT]
    > <span data-ttu-id="20c75-137">Es importante tener en cuenta que el método <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> se invalida para crear un administrador de tokens de seguridad personalizado.</span><span class="sxs-lookup"><span data-stu-id="20c75-137">It is important to note that the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method is overridden to create a custom security token manager.</span></span> <span data-ttu-id="20c75-138">El administrador de tokens de seguridad, derivado de <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>, debe devolver un proveedor de tokens de seguridad personalizado, derivado de <xref:System.IdentityModel.Selectors.SecurityTokenProvider>, para crear el token de seguridad propiamente dicho.</span><span class="sxs-lookup"><span data-stu-id="20c75-138">The security token manager, derived from <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>, must return a custom security token provider, derived from <xref:System.IdentityModel.Selectors.SecurityTokenProvider>, to create the actual security token.</span></span> <span data-ttu-id="20c75-139">Si no sigue este patrón para crear los tokens de seguridad, la aplicación puede tener un funcionamiento incorrecto al almacenar los objetos <xref:System.ServiceModel.ChannelFactory> en la memoria caché (que es el comportamiento predeterminado para los servidores proxy de cliente de WCF), lo que puede producir un ataque de elevación de privilegios.</span><span class="sxs-lookup"><span data-stu-id="20c75-139">If you do not follow this pattern for creating security tokens, your application may function incorrectly when <xref:System.ServiceModel.ChannelFactory> objects are cached (which is the default behavior for WCF client proxies), potentially resulting in an elevation of privilege attack.</span></span> <span data-ttu-id="20c75-140">El objeto de credencial personalizado se almacena en memoria caché como parte de la clase <xref:System.ServiceModel.ChannelFactory>.</span><span class="sxs-lookup"><span data-stu-id="20c75-140">The custom credential object is cached as part of the <xref:System.ServiceModel.ChannelFactory>.</span></span> <span data-ttu-id="20c75-141">Sin embargo, la clase <xref:System.IdentityModel.Selectors.SecurityTokenManager> personalizada se crea en cada invocación, lo que mitiga la amenaza de seguridad siempre que la lógica de creación de tokens se sitúe en la clase <xref:System.IdentityModel.Selectors.SecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="20c75-141">However, the custom <xref:System.IdentityModel.Selectors.SecurityTokenManager> is created on every invocation, which mitigates the security threat as long as the token creation logic is placed in the <xref:System.IdentityModel.Selectors.SecurityTokenManager>.</span></span>

4. <span data-ttu-id="20c75-142">Invalide el método <xref:System.ServiceModel.Description.ClientCredentials.CloneCore%2A> .</span><span class="sxs-lookup"><span data-stu-id="20c75-142">Override the <xref:System.ServiceModel.Description.ClientCredentials.CloneCore%2A> method.</span></span>

    [!code-csharp[c_CustomCredentials#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#1)]
    [!code-vb[c_CustomCredentials#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#1)]

#### <a name="to-implement-a-custom-client-security-token-manager"></a><span data-ttu-id="20c75-143">Para implementar un administrador de tokens de seguridad de cliente personalizados</span><span class="sxs-lookup"><span data-stu-id="20c75-143">To implement a custom client security token manager</span></span>

1. <span data-ttu-id="20c75-144">Defina una clase nueva derivada a partir de <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="20c75-144">Define a new class derived from <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.</span></span>

2. <span data-ttu-id="20c75-145">Opcional.</span><span class="sxs-lookup"><span data-stu-id="20c75-145">Optional.</span></span> <span data-ttu-id="20c75-146">Invalide el método <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%28System.IdentityModel.Selectors.SecurityTokenRequirement%29> si se debe crear una implementación de <xref:System.IdentityModel.Selectors.SecurityTokenProvider> personalizada.</span><span class="sxs-lookup"><span data-stu-id="20c75-146">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%28System.IdentityModel.Selectors.SecurityTokenRequirement%29> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenProvider> implementation must be created.</span></span> <span data-ttu-id="20c75-147">Para obtener más información acerca de los proveedores de tokens de seguridad personalizados, vea [Cómo: crear un proveedor](how-to-create-a-custom-security-token-provider.md)de tokens de seguridad personalizado .</span><span class="sxs-lookup"><span data-stu-id="20c75-147">For more information about custom security token providers, see [How to: Create a Custom Security Token Provider](how-to-create-a-custom-security-token-provider.md).</span></span>

3. <span data-ttu-id="20c75-148">Opcional.</span><span class="sxs-lookup"><span data-stu-id="20c75-148">Optional.</span></span> <span data-ttu-id="20c75-149">Invalide el método <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%28System.IdentityModel.Selectors.SecurityTokenRequirement%2CSystem.IdentityModel.Selectors.SecurityTokenResolver%40%29> si se debe crear una implementación de <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> personalizada.</span><span class="sxs-lookup"><span data-stu-id="20c75-149">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%28System.IdentityModel.Selectors.SecurityTokenRequirement%2CSystem.IdentityModel.Selectors.SecurityTokenResolver%40%29> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> implementation must be created.</span></span> <span data-ttu-id="20c75-150">Para obtener más información acerca de los autenticadores de tokens de seguridad personalizados, consulte [Cómo: crear un autenticador](how-to-create-a-custom-security-token-authenticator.md)de token de seguridad personalizado .</span><span class="sxs-lookup"><span data-stu-id="20c75-150">For more information about custom security token authenticators, see [How to: Create a Custom Security Token Authenticator](how-to-create-a-custom-security-token-authenticator.md).</span></span>

4. <span data-ttu-id="20c75-151">Opcional.</span><span class="sxs-lookup"><span data-stu-id="20c75-151">Optional.</span></span> <span data-ttu-id="20c75-152">Invalide el método <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%2A> si se debe crear un <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> personalizado.</span><span class="sxs-lookup"><span data-stu-id="20c75-152">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%2A> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> must be created.</span></span> <span data-ttu-id="20c75-153">Para obtener más información acerca de los tokens de seguridad personalizados y los serializadores de tokens de seguridad personalizados, vea [Cómo: crear un token personalizado](how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="20c75-153">For more information about custom security tokens and custom security token serializers, see [How to: Create a Custom Token](how-to-create-a-custom-token.md).</span></span>

    [!code-csharp[c_CustomCredentials#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#2)]
    [!code-vb[c_CustomCredentials#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#2)]

#### <a name="to-use-a-custom-client-credentials-from-application-code"></a><span data-ttu-id="20c75-154">Para usar credenciales de cliente personalizadas a partir del código de la aplicación</span><span class="sxs-lookup"><span data-stu-id="20c75-154">To use a custom client credentials from application code</span></span>

1. <span data-ttu-id="20c75-155">Cree una instancia del cliente generado que representa la interfaz de servicio, o cree una instancia del <xref:System.ServiceModel.ChannelFactory> que señale a un servicio con el que desee comunicarse.</span><span class="sxs-lookup"><span data-stu-id="20c75-155">Either create an instance of the generated client that represents the service interface, or create an instance of the <xref:System.ServiceModel.ChannelFactory> pointing to a service you want to communicate with.</span></span>

2. <span data-ttu-id="20c75-156">Elimine el comportamiento de credenciales de cliente proporcionadas por el sistema de la colección <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A>, a la que se puede tener acceso mediante la propiedad <xref:System.ServiceModel.ChannelFactory.Endpoint%2A>.</span><span class="sxs-lookup"><span data-stu-id="20c75-156">Remove the system-provided client credentials behavior from the <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A> collection, which can be accessed through the <xref:System.ServiceModel.ChannelFactory.Endpoint%2A> property.</span></span>

3. <span data-ttu-id="20c75-157">Cree una nueva instancia de una clase de credenciales de cliente personalizada y agréguela a la colección <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A>, a la que se puede tener acceso mediante la propiedad <xref:System.ServiceModel.ChannelFactory.Endpoint%2A>.</span><span class="sxs-lookup"><span data-stu-id="20c75-157">Create a new instance of a custom client credentials class and add it to the <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A> collection, which can be accessed through the <xref:System.ServiceModel.ChannelFactory.Endpoint%2A> property.</span></span>

    [!code-csharp[c_CustomCredentials#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#3)]
    [!code-vb[c_CustomCredentials#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#3)]

<span data-ttu-id="20c75-158">El procedimiento anterior muestra cómo usar las credenciales de cliente del código de aplicación.</span><span class="sxs-lookup"><span data-stu-id="20c75-158">The previous procedure shows how to use client credentials from application code.</span></span> <span data-ttu-id="20c75-159">Las credenciales de WCF también se pueden configurar mediante el archivo de configuración de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="20c75-159">WCF credentials can also be configured using the application configuration file.</span></span> <span data-ttu-id="20c75-160">A menudo, es preferible utilizar la configuración de la aplicación en lugar de emplear codificación de forma rígida, porque permite modificar los parámetros de la aplicación sin tener que modificar la fuente, recompilar y reimplementar.</span><span class="sxs-lookup"><span data-stu-id="20c75-160">Using application configuration is often preferable to hard-coding because it enables modification of application parameters without having to modify the source, recompiling, and redeployment.</span></span>

<span data-ttu-id="20c75-161">El siguiente procedimiento describe cómo proporcionar compatibilidad para la configuración de credenciales personalizadas.</span><span class="sxs-lookup"><span data-stu-id="20c75-161">The next procedure describes how to provide support for configuration of custom credentials.</span></span>

#### <a name="creating-a-configuration-handler-for-custom-client-credentials"></a><span data-ttu-id="20c75-162">Creación de un controlador de configuración para las credenciales de cliente personalizadas</span><span class="sxs-lookup"><span data-stu-id="20c75-162">Creating a configuration handler for custom client credentials</span></span>

1. <span data-ttu-id="20c75-163">Defina una clase nueva derivada a partir de <xref:System.ServiceModel.Configuration.ClientCredentialsElement>.</span><span class="sxs-lookup"><span data-stu-id="20c75-163">Define a new class derived from <xref:System.ServiceModel.Configuration.ClientCredentialsElement>.</span></span>

2. <span data-ttu-id="20c75-164">Opcional.</span><span class="sxs-lookup"><span data-stu-id="20c75-164">Optional.</span></span> <span data-ttu-id="20c75-165">Agregue propiedades para todos los parámetros de configuración adicionales que desee exponer a través de la configuración de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="20c75-165">Add properties for all additional configuration parameters that you want to expose through application configuration.</span></span> <span data-ttu-id="20c75-166">El siguiente ejemplo agrega una propiedad denominada `CreditCardNumber`.</span><span class="sxs-lookup"><span data-stu-id="20c75-166">The example below adds one property named `CreditCardNumber`.</span></span>

3. <span data-ttu-id="20c75-167">Invalide la propiedad <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.BehaviorType%2A> para devolver el tipo de la clase de credenciales de cliente personalizadas creado con el elemento de configuración.</span><span class="sxs-lookup"><span data-stu-id="20c75-167">Override the <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.BehaviorType%2A> property to return the type of the custom client credentials class created with the configuration element.</span></span>

4. <span data-ttu-id="20c75-168">Invalide el método <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.CreateBehavior%2A> .</span><span class="sxs-lookup"><span data-stu-id="20c75-168">Override the <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.CreateBehavior%2A> method.</span></span> <span data-ttu-id="20c75-169">El método es responsable de crear y devolver una instancia de la clase de credenciales personalizadas basándose en los ajustes cargados desde el archivo de configuración.</span><span class="sxs-lookup"><span data-stu-id="20c75-169">The method is responsible for creating and returning an instance of the custom credential class based on the settings loaded from the configuration file.</span></span> <span data-ttu-id="20c75-170">Llame al método <xref:System.ServiceModel.Configuration.ClientCredentialsElement.ApplyConfiguration%28System.ServiceModel.Description.ClientCredentials%29> base desde este método para recuperar los ajustes de credenciales proporcionados por el sistema cargados en su instancia de credenciales de cliente personalizadas.</span><span class="sxs-lookup"><span data-stu-id="20c75-170">Call the base <xref:System.ServiceModel.Configuration.ClientCredentialsElement.ApplyConfiguration%28System.ServiceModel.Description.ClientCredentials%29> method from this method to retrieve the system-provided credentials settings loaded into your custom client credentials instance.</span></span>

5. <span data-ttu-id="20c75-171">Opcional.</span><span class="sxs-lookup"><span data-stu-id="20c75-171">Optional.</span></span> <span data-ttu-id="20c75-172">Si agregó propiedades adicionales en el paso 2, ha de invalidar la propiedad <xref:System.Configuration.ConfigurationElement.Properties%2A> para registrar su configuración adicional para que el marco de configuración las reconozca.</span><span class="sxs-lookup"><span data-stu-id="20c75-172">If you added additional properties in step 2, you need to override the <xref:System.Configuration.ConfigurationElement.Properties%2A> property in order to register your additional configuration settings for the configuration framework to recognize them.</span></span> <span data-ttu-id="20c75-173">Combine sus propiedades con las propiedades de clase base para permitir que los ajustes proporcionados por el sistema se configuren a través de este elemento de configuración de credenciales de cliente personalizadas.</span><span class="sxs-lookup"><span data-stu-id="20c75-173">Combine your properties with the base class properties to allow the system-provided settings to be configured through this custom client credentials configuration element.</span></span>

    [!code-csharp[c_CustomCredentials#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#7)]
    [!code-vb[c_CustomCredentials#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#7)]

<span data-ttu-id="20c75-174">Una vez que tenga la clase de controlador de configuración, se puede integrar en el marco de configuración de WCF.</span><span class="sxs-lookup"><span data-stu-id="20c75-174">Once you have the configuration handler class, it can be integrated into the WCF configuration framework.</span></span> <span data-ttu-id="20c75-175">Eso permite que las credenciales de cliente personalizadas se usen en los elementos de comportamiento de extremo de cliente, tal y como se muestra en el siguiente procedimiento.</span><span class="sxs-lookup"><span data-stu-id="20c75-175">That enables the custom client credentials to be used in the client endpoint behavior elements, as shown in the next procedure.</span></span>

#### <a name="to-register-and-use-a-custom-client-credentials-configuration-handler-in-the-application-configuration"></a><span data-ttu-id="20c75-176">Para registrar y usar un controlador de configuración de credenciales de cliente personalizadas en la configuración de la aplicación</span><span class="sxs-lookup"><span data-stu-id="20c75-176">To register and use a custom client credentials configuration handler in the application configuration</span></span>

1. <span data-ttu-id="20c75-177">Agregue un `extensions` elemento> `behaviorExtensions` <y un elemento> <al archivo de configuración.</span><span class="sxs-lookup"><span data-stu-id="20c75-177">Add an <`extensions`> element and a <`behaviorExtensions`> element to the configuration file.</span></span>

2. <span data-ttu-id="20c75-178">Agregue un `add` elemento <`behaviorExtensions`> al elemento `name` <> y establezca el atributo en un valor adecuado.</span><span class="sxs-lookup"><span data-stu-id="20c75-178">Add an <`add`> element to the <`behaviorExtensions`> element and set the `name` attribute to an appropriate value.</span></span>

3. <span data-ttu-id="20c75-179">Establezca el atributo `type` en el nombre de tipo completo.</span><span class="sxs-lookup"><span data-stu-id="20c75-179">Set the `type` attribute to the fully-qualified type name.</span></span> <span data-ttu-id="20c75-180">Incluya también el nombre de ensamblado y otros atributos de ensamblado.</span><span class="sxs-lookup"><span data-stu-id="20c75-180">Also include the assembly name and other assembly attributes.</span></span>

    ```xml
    <system.serviceModel>
      <extensions>
        <behaviorExtensions>
          <add name="myClientCredentials" type="Microsoft.ServiceModel.Samples.MyClientCredentialsConfigHandler, CustomCredentials, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
        </behaviorExtensions>
      </extensions>
    </system.serviceModel>
    ```

4. <span data-ttu-id="20c75-181">Después de registrar el controlador de configuración, el elemento de credenciales personalizadas `clientCredentials` se puede usar dentro del mismo archivo de configuración en lugar del elemento> <proporcionado por el sistema.</span><span class="sxs-lookup"><span data-stu-id="20c75-181">After registering your configuration handler, the custom credentials element can be used inside the same configuration file instead of the system-provided <`clientCredentials`> element.</span></span> <span data-ttu-id="20c75-182">Puede utilizar las propiedades proporcionadas por el sistema y cualquier propiedad nueva que haya agregado a su implementación del controlador de configuración.</span><span class="sxs-lookup"><span data-stu-id="20c75-182">You can use both the system-provided properties and any new properties that you have added to your configuration handler implementation.</span></span> <span data-ttu-id="20c75-183">El siguiente ejemplo establece el valor de una propiedad personalizada mediante el atributo `creditCardNumber`.</span><span class="sxs-lookup"><span data-stu-id="20c75-183">The following example sets the value of a custom property using the `creditCardNumber` attribute.</span></span>

    ```xml
    <behaviors>
      <endpointBehaviors>
        <behavior name="myClientCredentialsBehavior">
          <myClientCredentials creditCardNumber="123-123-123"/>
        </behavior>
      </endpointBehaviors>
    </behaviors>
    ```

#### <a name="to-implement-custom-service-credentials"></a><span data-ttu-id="20c75-184">Para implementar credenciales de servicio personalizadas</span><span class="sxs-lookup"><span data-stu-id="20c75-184">To implement custom service credentials</span></span>

1. <span data-ttu-id="20c75-185">Defina una clase nueva derivada a partir de <xref:System.ServiceModel.Description.ServiceCredentials>.</span><span class="sxs-lookup"><span data-stu-id="20c75-185">Define a new class derived from <xref:System.ServiceModel.Description.ServiceCredentials>.</span></span>

2. <span data-ttu-id="20c75-186">Opcional.</span><span class="sxs-lookup"><span data-stu-id="20c75-186">Optional.</span></span> <span data-ttu-id="20c75-187">Agregue nuevas propiedades para proporcionar API para los nuevos valores de credenciales que se están agregando.</span><span class="sxs-lookup"><span data-stu-id="20c75-187">Add new properties to provide APIs for new credential values that are being added.</span></span> <span data-ttu-id="20c75-188">Si no agrega nuevos valores de credenciales, no realice este paso.</span><span class="sxs-lookup"><span data-stu-id="20c75-188">If you do not add new credential values, skip this step.</span></span> <span data-ttu-id="20c75-189">En el siguiente ejemplo se agrega una propiedad `AdditionalCertificate`.</span><span class="sxs-lookup"><span data-stu-id="20c75-189">The following example adds an `AdditionalCertificate` property.</span></span>

3. <span data-ttu-id="20c75-190">Invalide el método <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> .</span><span class="sxs-lookup"><span data-stu-id="20c75-190">Override the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method.</span></span> <span data-ttu-id="20c75-191">La infraestructura WCF llama automáticamente a este método cuando se usa la credencial de cliente personalizada.</span><span class="sxs-lookup"><span data-stu-id="20c75-191">This method is automatically called by the WCF infrastructure when the custom client credential is used.</span></span> <span data-ttu-id="20c75-192">El método es responsable de crear y devolver una instancia de una implementación de la clase <xref:System.IdentityModel.Selectors.SecurityTokenManager>(descrita en el siguiente procedimiento).</span><span class="sxs-lookup"><span data-stu-id="20c75-192">The method is responsible for creating and returning an instance of an implementation of the <xref:System.IdentityModel.Selectors.SecurityTokenManager> class (described in the next procedure).</span></span>

4. <span data-ttu-id="20c75-193">Opcional.</span><span class="sxs-lookup"><span data-stu-id="20c75-193">Optional.</span></span> <span data-ttu-id="20c75-194">Invalide el método <xref:System.ServiceModel.Description.ServiceCredentials.CloneCore%2A> .</span><span class="sxs-lookup"><span data-stu-id="20c75-194">Override the <xref:System.ServiceModel.Description.ServiceCredentials.CloneCore%2A> method.</span></span> <span data-ttu-id="20c75-195">Esto sólo se requiere si se agregan nuevas propiedades o campos internos a la implementación de credenciales de cliente personalizadas.</span><span class="sxs-lookup"><span data-stu-id="20c75-195">This is required only if adding new properties or internal fields to the custom client credentials implementation.</span></span>

    [!code-csharp[c_CustomCredentials#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#4)]
    [!code-vb[c_CustomCredentials#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#4)]

#### <a name="to-implement-a-custom-service-security-token-manager"></a><span data-ttu-id="20c75-196">Para implementar un administrador de tokens de seguridad de servicio personalizados</span><span class="sxs-lookup"><span data-stu-id="20c75-196">To implement a custom service security token manager</span></span>

1. <span data-ttu-id="20c75-197">Defina una clase nueva derivada de la clase <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="20c75-197">Define a new class derived from the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class.</span></span>

2. <span data-ttu-id="20c75-198">Opcional.</span><span class="sxs-lookup"><span data-stu-id="20c75-198">Optional.</span></span> <span data-ttu-id="20c75-199">Invalide el método <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%2A> si se debe crear una implementación de <xref:System.IdentityModel.Selectors.SecurityTokenProvider> personalizada.</span><span class="sxs-lookup"><span data-stu-id="20c75-199">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%2A> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenProvider> implementation must be created.</span></span> <span data-ttu-id="20c75-200">Para obtener más información acerca de los proveedores de tokens de seguridad personalizados, vea [Cómo: crear un proveedor](how-to-create-a-custom-security-token-provider.md)de tokens de seguridad personalizado .</span><span class="sxs-lookup"><span data-stu-id="20c75-200">For more information about custom security token providers, see [How to: Create a Custom Security Token Provider](how-to-create-a-custom-security-token-provider.md).</span></span>

3. <span data-ttu-id="20c75-201">Opcional.</span><span class="sxs-lookup"><span data-stu-id="20c75-201">Optional.</span></span> <span data-ttu-id="20c75-202">Invalide el método <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> si se debe crear una implementación de <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> personalizada.</span><span class="sxs-lookup"><span data-stu-id="20c75-202">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> implementation must be created.</span></span> <span data-ttu-id="20c75-203">Para obtener más información acerca de los autenticadores de tokens de seguridad personalizados, consulte [Cómo: crear un](how-to-create-a-custom-security-token-authenticator.md) autenticador de token de seguridad personalizado tema.</span><span class="sxs-lookup"><span data-stu-id="20c75-203">For more information about custom security token authenticators, see [How to: Create a Custom Security Token Authenticator](how-to-create-a-custom-security-token-authenticator.md) topic.</span></span>

4. <span data-ttu-id="20c75-204">Opcional.</span><span class="sxs-lookup"><span data-stu-id="20c75-204">Optional.</span></span> <span data-ttu-id="20c75-205">Invalide el método <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%28System.IdentityModel.Selectors.SecurityTokenVersion%29> si se debe crear un <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> personalizado.</span><span class="sxs-lookup"><span data-stu-id="20c75-205">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%28System.IdentityModel.Selectors.SecurityTokenVersion%29> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> must be created.</span></span> <span data-ttu-id="20c75-206">Para obtener más información acerca de los tokens de seguridad personalizados y los serializadores de tokens de seguridad personalizados, vea [Cómo: crear un token personalizado](how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="20c75-206">For more information about custom security tokens and custom security token serializers, see [How to: Create a Custom Token](how-to-create-a-custom-token.md).</span></span>

    [!code-csharp[c_CustomCredentials#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#5)]
    [!code-vb[c_CustomCredentials#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#5)]

#### <a name="to-use-custom-service-credentials-from-application-code"></a><span data-ttu-id="20c75-207">Para usar credenciales de servicio personalizadas a partir del código de la aplicación</span><span class="sxs-lookup"><span data-stu-id="20c75-207">To use custom service credentials from application code</span></span>

1. <span data-ttu-id="20c75-208">Creación de una instancia de <xref:System.ServiceModel.ServiceHost>.</span><span class="sxs-lookup"><span data-stu-id="20c75-208">Create an instance of the <xref:System.ServiceModel.ServiceHost>.</span></span>

2. <span data-ttu-id="20c75-209">Elimine el comportamiento de las credenciales de servicio proporcionadas por el sistema desde la colección <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A>.</span><span class="sxs-lookup"><span data-stu-id="20c75-209">Remove the system-provided service credentials behavior from the <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A> collection.</span></span>

3. <span data-ttu-id="20c75-210">Cree una nueva instancia de la clase de credenciales de servicio personalizadas y agréguela a la colección <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A>.</span><span class="sxs-lookup"><span data-stu-id="20c75-210">Create a new instance of the custom service credentials class and add it to the <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A> collection.</span></span>

    [!code-csharp[c_CustomCredentials#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#6)]
    [!code-vb[c_CustomCredentials#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#6)]

<span data-ttu-id="20c75-211">Agregue soporte para la configuración mediante los`To create a configuration handler for custom client credentials`pasos`To register and use a custom client credentials configuration handler in the application configuration`descritos anteriormente en los procedimientos " " y " ." La única diferencia es <xref:System.ServiceModel.Configuration.ServiceCredentialsElement> usar la <xref:System.ServiceModel.Configuration.ClientCredentialsElement> clase en lugar de la clase como clase base para el controlador de configuración.</span><span class="sxs-lookup"><span data-stu-id="20c75-211">Add support for configuration using the steps described previously in the procedures "`To create a configuration handler for custom client credentials`" and "`To register and use a custom client credentials configuration handler in the application configuration`." The only difference is to use the <xref:System.ServiceModel.Configuration.ServiceCredentialsElement> class instead of the <xref:System.ServiceModel.Configuration.ClientCredentialsElement> class as a base class for the configuration handler.</span></span> <span data-ttu-id="20c75-212">El elemento de credencial de servicio personalizado puede utilizarse después dondequiera que se utilice el elemento `<serviceCredentials>` proporcionado por el sistema.</span><span class="sxs-lookup"><span data-stu-id="20c75-212">The custom service credential element can then be used wherever the system-provided `<serviceCredentials>` element is used.</span></span>

## <a name="see-also"></a><span data-ttu-id="20c75-213">Vea también</span><span class="sxs-lookup"><span data-stu-id="20c75-213">See also</span></span>

- <xref:System.ServiceModel.Description.ClientCredentials>
- <xref:System.ServiceModel.Description.ServiceCredentials>
- <xref:System.ServiceModel.Security.SecurityCredentialsManager>
- <xref:System.IdentityModel.Selectors.SecurityTokenManager>
- <xref:System.ServiceModel.Configuration.ClientCredentialsElement>
- <xref:System.ServiceModel.Configuration.ServiceCredentialsElement>
- [<span data-ttu-id="20c75-214">Procedimiento para crear un proveedor de tokens de seguridad personalizado</span><span class="sxs-lookup"><span data-stu-id="20c75-214">How to: Create a Custom Security Token Provider</span></span>](how-to-create-a-custom-security-token-provider.md)
- [<span data-ttu-id="20c75-215">Procedimiento para crear un autenticador de tokens de seguridad personalizado</span><span class="sxs-lookup"><span data-stu-id="20c75-215">How to: Create a Custom Security Token Authenticator</span></span>](how-to-create-a-custom-security-token-authenticator.md)
- [<span data-ttu-id="20c75-216">Procedimiento para crear un token personalizado</span><span class="sxs-lookup"><span data-stu-id="20c75-216">How to: Create a Custom Token</span></span>](how-to-create-a-custom-token.md)
