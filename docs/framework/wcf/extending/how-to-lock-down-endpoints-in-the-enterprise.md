---
title: Cómo bloquear extremos en la empresa
ms.date: 03/30/2017
ms.assetid: 1b7eaab7-da60-4cf7-9d6a-ec02709cf75d
ms.openlocfilehash: 35b9a1dbebce48823799689a581033d0483c3984
ms.sourcegitcommit: 7e2128d4a4c45b4274bea3b8e5760d4694569ca1
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/14/2020
ms.locfileid: "75937677"
---
# <a name="how-to-lock-down-endpoints-in-the-enterprise"></a><span data-ttu-id="59561-102">Cómo bloquear extremos en la empresa</span><span class="sxs-lookup"><span data-stu-id="59561-102">How to: Lock Down Endpoints in the Enterprise</span></span>

<span data-ttu-id="59561-103">Las grandes empresas requieren a menudo que las aplicaciones se desarrollen conforme a las directivas de seguridad de la empresa.</span><span class="sxs-lookup"><span data-stu-id="59561-103">Large enterprises often require that applications are developed in compliance with enterprise security policies.</span></span> <span data-ttu-id="59561-104">En el siguiente tema se describe cómo desarrollar e instalar un validador de punto de conexión de cliente que se puede utilizar para validar todas las aplicaciones cliente de Windows Communication Foundation (WCF) instaladas en los equipos.</span><span class="sxs-lookup"><span data-stu-id="59561-104">The following topic discusses how to develop and install a client endpoint validator that can be used to validate all Windows Communication Foundation (WCF) client applications installed on computers.</span></span>

<span data-ttu-id="59561-105">En este caso, el validador es un validador de cliente porque este comportamiento de extremo se agrega a la sección Client [\<commonBehaviors >](../../configure-apps/file-schema/wcf/commonbehaviors.md) en el archivo Machine. config.</span><span class="sxs-lookup"><span data-stu-id="59561-105">In this case, the validator is a client validator because this endpoint behavior is added to the client [\<commonBehaviors>](../../configure-apps/file-schema/wcf/commonbehaviors.md) section in the machine.config file.</span></span> <span data-ttu-id="59561-106">WCF carga los comportamientos de extremo comunes solo para las aplicaciones cliente y carga los comportamientos de servicio comunes solo para las aplicaciones de servicio.</span><span class="sxs-lookup"><span data-stu-id="59561-106">WCF loads common endpoint behaviors only for client applications and loads common service behaviors only for service applications.</span></span> <span data-ttu-id="59561-107">Para instalar el mismo validador para las aplicaciones servicio, el validador debe ser un comportamiento de servicio.</span><span class="sxs-lookup"><span data-stu-id="59561-107">To install this same validator for service applications, the validator must be a service behavior.</span></span> <span data-ttu-id="59561-108">Para obtener más información, vea la sección [\<commonBehaviors >](../../configure-apps/file-schema/wcf/commonbehaviors.md) .</span><span class="sxs-lookup"><span data-stu-id="59561-108">For more information, see the [\<commonBehaviors>](../../configure-apps/file-schema/wcf/commonbehaviors.md) section.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="59561-109">Los comportamientos de servicio o de extremo que no están marcados con el atributo <xref:System.Security.AllowPartiallyTrustedCallersAttribute> (APTCA) que se agregan a la sección [\<commonBehaviors >](../../configure-apps/file-schema/wcf/commonbehaviors.md) de un archivo de configuración no se ejecutan cuando la aplicación se ejecuta en un entorno de confianza parcial y no se produce ninguna excepción cuando esto ocurre.</span><span class="sxs-lookup"><span data-stu-id="59561-109">Service or endpoint behaviors not marked with the <xref:System.Security.AllowPartiallyTrustedCallersAttribute> attribute (APTCA) that are added to the [\<commonBehaviors>](../../configure-apps/file-schema/wcf/commonbehaviors.md) section of a configuration file are not run when the application runs in a partial trust environment, and no exception is thrown when this occurs.</span></span> <span data-ttu-id="59561-110">Para forzar la ejecución de los comportamientos habituales, como los validadores, es necesario:</span><span class="sxs-lookup"><span data-stu-id="59561-110">To enforce the running of common behaviors such as validators, you must either:</span></span>
>
> - <span data-ttu-id="59561-111">Marque el comportamiento común con el <xref:System.Security.AllowPartiallyTrustedCallersAttribute> atributo para que pueda ejecutarse cuando se implemente como una aplicación de confianza parcial.</span><span class="sxs-lookup"><span data-stu-id="59561-111">Mark your common behavior with the <xref:System.Security.AllowPartiallyTrustedCallersAttribute> attribute so that it can run when deployed as a Partial Trust application.</span></span> <span data-ttu-id="59561-112">Tenga en cuenta que puede establecerse una entrada de registro en el equipo para evitar que se ejecuten los ensamblados marcados con APTCA.</span><span class="sxs-lookup"><span data-stu-id="59561-112">Note that a registry entry can be set on the computer to prevent APTCA-marked assemblies from running..</span></span>
>
> - <span data-ttu-id="59561-113">Asegúrese de que si la aplicación se implementa como una aplicación de plena confianza que los usuarios no pueden modificar la configuración de seguridad de acceso del código para ejecutar la aplicación en un entorno de confianza parcial.</span><span class="sxs-lookup"><span data-stu-id="59561-113">Ensure that if the application is deployed as a fully-trusted application that users cannot modify the code-access security settings to run the application in a Partial Trust environment.</span></span> <span data-ttu-id="59561-114">De poder hacerlo, el validador personalizado no se ejecutaría y no se iniciaría ninguna excepción.</span><span class="sxs-lookup"><span data-stu-id="59561-114">If they can do so, the custom validator does not run and no exception is thrown.</span></span> <span data-ttu-id="59561-115">Para asegurarse de que esto es así, consulte la opción `levelfinal` mediante la herramienta de la [Directiva de seguridad de acceso del código (Caspol. exe)](../../tools/caspol-exe-code-access-security-policy-tool.md).</span><span class="sxs-lookup"><span data-stu-id="59561-115">For one way to ensure this, see the `levelfinal` option using [Code Access Security Policy Tool (Caspol.exe)](../../tools/caspol-exe-code-access-security-policy-tool.md).</span></span>
>
> <span data-ttu-id="59561-116">Para obtener más información, consulte [procedimientos recomendados de confianza parcial](../feature-details/partial-trust-best-practices.md) y [escenarios de implementación admitidos](../feature-details/supported-deployment-scenarios.md).</span><span class="sxs-lookup"><span data-stu-id="59561-116">For more information, see [Partial Trust Best Practices](../feature-details/partial-trust-best-practices.md) and [Supported Deployment Scenarios](../feature-details/supported-deployment-scenarios.md).</span></span>

### <a name="to-create-the-endpoint-validator"></a><span data-ttu-id="59561-117">Para crear el validador de punto de conexión</span><span class="sxs-lookup"><span data-stu-id="59561-117">To create the endpoint validator</span></span>

1. <span data-ttu-id="59561-118">Cree un <xref:System.ServiceModel.Description.IEndpointBehavior> con los pasos de validación que desee en el método <xref:System.ServiceModel.Description.IEndpointBehavior.Validate%2A>.</span><span class="sxs-lookup"><span data-stu-id="59561-118">Create an <xref:System.ServiceModel.Description.IEndpointBehavior> with the desired validation steps in the <xref:System.ServiceModel.Description.IEndpointBehavior.Validate%2A> method.</span></span> <span data-ttu-id="59561-119">El siguiente código proporciona un ejemplo.</span><span class="sxs-lookup"><span data-stu-id="59561-119">The following code provides an example.</span></span> <span data-ttu-id="59561-120">(El `InternetClientValidatorBehavior` se toma del ejemplo de [validación de seguridad](../samples/security-validation.md) ).</span><span class="sxs-lookup"><span data-stu-id="59561-120">(The `InternetClientValidatorBehavior` is taken from the [Security Validation](../samples/security-validation.md) sample.)</span></span>

    [!code-csharp[LockdownValidation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/internetclientvalidatorbehavior.cs#2)]

2. <span data-ttu-id="59561-121">Cree un nuevo <xref:System.ServiceModel.Configuration.BehaviorExtensionElement> que registre el validador de punto de conexión creado en el paso 1.</span><span class="sxs-lookup"><span data-stu-id="59561-121">Create new <xref:System.ServiceModel.Configuration.BehaviorExtensionElement> that registers the endpoint validator created in step 1.</span></span> <span data-ttu-id="59561-122">El ejemplo de código siguiente muestra cómo hacerlo.</span><span class="sxs-lookup"><span data-stu-id="59561-122">The following code example shows this.</span></span> <span data-ttu-id="59561-123">(El código original de este ejemplo está en el ejemplo de [validación de seguridad](../samples/security-validation.md) ).</span><span class="sxs-lookup"><span data-stu-id="59561-123">(The original code for this example is in the [Security Validation](../samples/security-validation.md) sample.)</span></span>

    [!code-csharp[LockdownValidation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/internetclientvalidatorelement.cs#3)]

3. <span data-ttu-id="59561-124">Asegúrese de que el ensamblado compilado se firma con un nombre seguro.</span><span class="sxs-lookup"><span data-stu-id="59561-124">Make sure the compiled assembly is signed with a strong name.</span></span> <span data-ttu-id="59561-125">Para obtener más información, consulte la [herramienta de nombre seguro (SN). EXE)](../../tools/sn-exe-strong-name-tool.md) y los comandos del compilador para su lenguaje.</span><span class="sxs-lookup"><span data-stu-id="59561-125">For details, see the [Strong Name Tool (SN.EXE)](../../tools/sn-exe-strong-name-tool.md) and the compiler commands for your language.</span></span>

### <a name="to-install-the-validator-into-the-target-computer"></a><span data-ttu-id="59561-126">Para instalar el validador en el equipo de destino</span><span class="sxs-lookup"><span data-stu-id="59561-126">To install the validator into the target computer</span></span>

1. <span data-ttu-id="59561-127">Instale el validador del punto de conexión mediante el mecanismo adecuado.</span><span class="sxs-lookup"><span data-stu-id="59561-127">Install the endpoint validator using the appropriate mechanism.</span></span> <span data-ttu-id="59561-128">En una empresa, esto puede hacerse utilizando la directiva de grupo y Systems Management Server (SMS).</span><span class="sxs-lookup"><span data-stu-id="59561-128">In an enterprise, this can be using Group Policy and Systems Management Server (SMS).</span></span>

2. <span data-ttu-id="59561-129">Instale el ensamblado con nombre seguro en la caché global de ensamblados con [Gacutil. exe (herramienta de caché global de ensamblados)](../../tools/gacutil-exe-gac-tool.md).</span><span class="sxs-lookup"><span data-stu-id="59561-129">Install the strongly-named assembly into the global assembly cache using the [Gacutil.exe (Global Assembly Cache Tool)](../../tools/gacutil-exe-gac-tool.md).</span></span>

3. <span data-ttu-id="59561-130">Utilice los tipos de espacio de nombres de <xref:System.Configuration?displayProperty=nameWithType> para:</span><span class="sxs-lookup"><span data-stu-id="59561-130">Use the <xref:System.Configuration?displayProperty=nameWithType> namespace types to:</span></span>

    1. <span data-ttu-id="59561-131">Agregue la extensión a la sección [\<behaviorExtensions >](../../configure-apps/file-schema/wcf/behaviorextensions.md) con un nombre de tipo completo y bloquee el elemento.</span><span class="sxs-lookup"><span data-stu-id="59561-131">Add the extension to the [\<behaviorExtensions>](../../configure-apps/file-schema/wcf/behaviorextensions.md) section using a fully-qualified type name and lock the element.</span></span>

         [!code-csharp[LockdownValidation#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/hostapplication.cs#5)]

    2. <span data-ttu-id="59561-132">Agregue el elemento de comportamiento a la propiedad `EndpointBehaviors` de la sección [\<commonBehaviors >](../../configure-apps/file-schema/wcf/commonbehaviors.md) y bloquee el elemento.</span><span class="sxs-lookup"><span data-stu-id="59561-132">Add the behavior element to the `EndpointBehaviors` property of the [\<commonBehaviors>](../../configure-apps/file-schema/wcf/commonbehaviors.md) section and lock the element.</span></span> <span data-ttu-id="59561-133">(Para instalar el validador en el servicio, el validador debe ser un <xref:System.ServiceModel.Description.IServiceBehavior> y agregarlo a la propiedad `ServiceBehaviors`). En el ejemplo de código siguiente se muestra la configuración correcta después de los pasos a.</span><span class="sxs-lookup"><span data-stu-id="59561-133">(To install the validator on the service, the validator must be an <xref:System.ServiceModel.Description.IServiceBehavior> and added to the `ServiceBehaviors` property.) The following code example shows the proper configuration after steps a.</span></span> <span data-ttu-id="59561-134">y b., con la única excepción de que no hay ningún nombre seguro.</span><span class="sxs-lookup"><span data-stu-id="59561-134">and b., with the sole exception that there is no strong name.</span></span>

        [!code-csharp[LockdownValidation#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/hostapplication.cs#6)]

    3. <span data-ttu-id="59561-135">Guarde el archivo machine.config.</span><span class="sxs-lookup"><span data-stu-id="59561-135">Save the machine.config file.</span></span> <span data-ttu-id="59561-136">El ejemplo de código siguiente realiza todas las tareas en el paso 3 pero guarda localmente una copia del archivo machine.config modificado.</span><span class="sxs-lookup"><span data-stu-id="59561-136">The following code example performs all the tasks in step 3 but saves a copy of the modified machine.config file locally.</span></span>

        [!code-csharp[LockdownValidation#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/hostapplication.cs#7)]

## <a name="example"></a><span data-ttu-id="59561-137">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="59561-137">Example</span></span>

<span data-ttu-id="59561-138">El ejemplo de código siguiente muestra cómo agregar un comportamiento común al archivo machine.config y guardar una copia en el disco.</span><span class="sxs-lookup"><span data-stu-id="59561-138">The following code example shows how to add a common behavior to the machine.config file and save a copy to the disk.</span></span> <span data-ttu-id="59561-139">El `InternetClientValidatorBehavior` se toma del ejemplo de [validación de seguridad](../samples/security-validation.md) .</span><span class="sxs-lookup"><span data-stu-id="59561-139">The `InternetClientValidatorBehavior` is taken from the [Security Validation](../samples/security-validation.md) sample.</span></span>

[!code-csharp[LockdownValidation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/hostapplication.cs#1)]

## <a name="net-framework-security"></a><span data-ttu-id="59561-140">Seguridad de .NET Framework</span><span class="sxs-lookup"><span data-stu-id="59561-140">.NET Framework Security</span></span>

<span data-ttu-id="59561-141">También puede querer cifrar los elementos del archivo de configuración.</span><span class="sxs-lookup"><span data-stu-id="59561-141">You may also want to encrypt the configuration file elements.</span></span> <span data-ttu-id="59561-142">Para obtener más información, vea la sección Vea también.</span><span class="sxs-lookup"><span data-stu-id="59561-142">For more information, see the See Also section.</span></span>

## <a name="see-also"></a><span data-ttu-id="59561-143">Vea también</span><span class="sxs-lookup"><span data-stu-id="59561-143">See also</span></span>

- <span data-ttu-id="59561-144">[Cifrar los elementos del archivo de configuración mediante DPAPI](https://docs.microsoft.com/previous-versions/msp-n-p/ff647398(v=pandp.10))</span><span class="sxs-lookup"><span data-stu-id="59561-144">[Encrypting configuration file elements using DPAPI](https://docs.microsoft.com/previous-versions/msp-n-p/ff647398(v=pandp.10))</span></span>
- <span data-ttu-id="59561-145">[Cifrar los elementos del archivo de configuración mediante RSA](https://docs.microsoft.com/previous-versions/msp-n-p/ff650304(v=pandp.10))</span><span class="sxs-lookup"><span data-stu-id="59561-145">[Encrypting configuration file elements using RSA](https://docs.microsoft.com/previous-versions/msp-n-p/ff650304(v=pandp.10))</span></span>
